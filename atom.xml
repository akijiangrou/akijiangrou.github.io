<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Aki酱肉&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/62088f4826c6588a219e16c60438a449</icon>
  <subtitle>never say never</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://akijiangrou.github.io/"/>
  <updated>2020-10-12T06:12:58.506Z</updated>
  <id>https://akijiangrou.github.io/</id>
  
  <author>
    <name>Jessica</name>
    <email>chunxiao5316@126.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>用户体验-尼尔森原则</title>
    <link href="https://akijiangrou.github.io/2020/10/12/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C-%E5%B0%BC%E5%B0%94%E6%A3%AE%E5%8E%9F%E5%88%99/"/>
    <id>https://akijiangrou.github.io/2020/10/12/用户体验-尼尔森原则/</id>
    <published>2020-10-12T05:36:41.000Z</published>
    <updated>2020-10-12T06:12:58.506Z</updated>
    
    <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>毕业于哥本哈根的人机交互学博士尼尔森，提出十大可用性原则，用来评价用户体验的好坏。</p><h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><h2 id="系统状态的可见性"><a href="#系统状态的可见性" class="headerlink" title="系统状态的可见性"></a>系统状态的可见性</h2><p>系统应通过在合理时间内的适当反馈，向用过户通知正在发生的事情或者当前的状态</p><ul><li>（1）合理时间</li><li>（2）适当反馈</li></ul><p>详细说明一下：</p><ul><li>菜单tab记录是否明显？菜单Tab可以让用户知道自己当前在哪个位置，否则他们就会在我们的产品里迷路。</li><li>标题栏是否明确？文章的标题是一篇文章的招牌，而标题栏就是一个页面的招牌，一个页面如果连标题栏都没有，或者标题栏和内容不符，那用户体验也是极差的。</li><li>数据加载是否有进度提醒？<br>也就是要告诉用户他操作之后处于什么状态了，操作是否成功，不能让用户干等。</li></ul><h2 id="系统与现实世界的匹配"><a href="#系统与现实世界的匹配" class="headerlink" title="系统与现实世界的匹配"></a>系统与现实世界的匹配</h2><p>使用用户熟悉的语言、单词、短语、图形，而不是系统导向的术语。</p><ul><li>（1）使用目标用户的语言</li><li>（2）模拟现实世界的对象</li></ul><p>比如计算器，指南针，性别标识等，最好用用户熟知的形状。</p><h2 id="操作可逆，可控"><a href="#操作可逆，可控" class="headerlink" title="操作可逆，可控"></a>操作可逆，可控</h2><p>用户在误操作时，应提供取消和重做的功能</p><ul><li>（1）可撤销/返回</li><li>（2）不可逆的操作要给用户提示</li></ul><h2 id="一致性和标准化"><a href="#一致性和标准化" class="headerlink" title="一致性和标准化"></a>一致性和标准化</h2><p>设计者应遵循一致性原则，统一标准能确保用户理解各个元素，并知道在哪里寻找哪些功能。</p><ul><li>（1）和用户的使用习惯保持一致</li><li>（2）产品规范化</li></ul><p>比如整个项目中的返回按钮图标保持一致，位置保持一致；文件类型的图标形状一致等等。</p><h2 id="防错原则"><a href="#防错原则" class="headerlink" title="防错原则"></a>防错原则</h2><p>需要提供建议、利用约束来防止无意识错误</p><p>（1）范围限制<br>（2）提供提示</p><p>详细一点：</p><ul><li>在容易犯错的重要操作是否有二次确认？比如取消订单，比如删除记录等等。</li><li>在做出删除等不可恢复的操作之前，有没有文字提示？</li></ul><h2 id="确认而不是记忆"><a href="#确认而不是记忆" class="headerlink" title="确认而不是记忆"></a>确认而不是记忆</h2><p>尽可能减少用户的记忆负担，向用户显示他们可以识别的内容，而不是自己记忆和填写。</p><ul><li>（1）让用户选择而不是输入</li><li>（2）自动读取、记录信息，减少操作路径</li><li>（3）内容可预期，减少用户操作路径，防止来回跳转</li></ul><h2 id="灵活性和使用效率"><a href="#灵活性和使用效率" class="headerlink" title="灵活性和使用效率"></a>灵活性和使用效率</h2><p>好的产品需要同时兼顾新用户和资深用户的需求。</p><ul><li>（1）提供快捷入口</li><li>（2）允许用户重复操作</li><li>（3）提供默认选项</li></ul><p>还有其他点： </p><ul><li>加载速度够不够快？</li><li>用起来是不是能快速上手？</li><li>功能有没有过于复杂不好理解？</li><li>所有能点击的地方，指向性是否明确？有没有让用户迟疑的点击事件？</li><li>最重要的是，你的中级用户都明白如何使用吗？</li></ul><h2 id="简约设计"><a href="#简约设计" class="headerlink" title="简约设计"></a>简约设计</h2><p>不要包含不相关或低频次的信息/操作。</p><ul><li>（1）建立清晰的视觉层次</li><li>（2）降低页面的干扰</li></ul><h2 id="帮助用户识别、诊断和修复错误"><a href="#帮助用户识别、诊断和修复错误" class="headerlink" title="帮助用户识别、诊断和修复错误"></a>帮助用户识别、诊断和修复错误</h2><p>错误消息应以简单的语言表示，准确指出问题，并提出解决方案。</p><ul><li>（1）错误提示要直观</li><li>（2）提供解决方案</li></ul><h2 id="提供帮助文档"><a href="#提供帮助文档" class="headerlink" title="提供帮助文档"></a>提供帮助文档</h2><p>帮助性内容有一次性提示、常驻提示和帮助文档。</p><ul><li>（1）一次性提示</li><li>（2）常驻提示</li><li>（3）帮助文档</li></ul><ul><li>简单的功能是否不需要文档就能看懂？</li><li>陌生的功能是否有新手引导？</li><li>困难的共是否有帮助中心？</li><li>复杂的问是否有帮助文档？</li><li>客服电话贴上了吗？</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;毕业于哥本哈根的人机交互学博士尼尔森，提出十大可用性原则，用来评价用户体验的好坏。&lt;/p&gt;
&lt;h1 id=&quot;内容&quot;&gt;&lt;a href=&quot;#内容
      
    
    </summary>
    
    
      <category term="用户体验" scheme="https://akijiangrou.github.io/tags/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C/"/>
    
      <category term="尼尔森原则" scheme="https://akijiangrou.github.io/tags/%E5%B0%BC%E5%B0%94%E6%A3%AE%E5%8E%9F%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>vuecli3之ES版本支持情况</title>
    <link href="https://akijiangrou.github.io/2020/08/18/vuecli%E4%B9%8Bes6789%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5/"/>
    <id>https://akijiangrou.github.io/2020/08/18/vuecli之es6789支持情况/</id>
    <published>2020-08-18T02:56:19.000Z</published>
    <updated>2020-08-18T08:15:06.781Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vue-cli3中能不能随便用新的ES版本语法？"><a href="#vue-cli3中能不能随便用新的ES版本语法？" class="headerlink" title="vue-cli3中能不能随便用新的ES版本语法？"></a>vue-cli3中能不能随便用新的ES版本语法？</h1><p>这么问，肯定是不行，那为什么不行，我们今天就来仔细研究下。</p><h2 id="从vue-cli3配置入手"><a href="#从vue-cli3配置入手" class="headerlink" title="从vue-cli3配置入手"></a>从vue-cli3配置入手</h2><p>vue-cli3中的babel配置如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = &#123;</span><br><span class="line">  presets: [<span class="string">"@vue/app"</span>]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>可以看到 vue-cli3 用的是自己封装的@vue/app,我们在 node_modules 找到@vue/app 的 package.json <code>[@vue/babel-preset-app]</code></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="./pic1.png" alt="截图" title>                </div>                <div class="image-caption">截图</div>            </figure><p>上面两个比较重要的：<strong>@babel/preset-env</strong> 和 <strong>core-js</strong></p><h2 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel/preset-env"></a>@babel/preset-env</h2><blockquote><p>@babel/preset-env is a smart preset that allows you to use the latest JavaScript without needing to micromanage which syntax transforms (and optionally, browser polyfills) are needed by your target environment(s). This both makes your life easier and JavaScript bundles smaller!</p></blockquote><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>根据你支持的环境自动决定适合你的Babel插件</p><h3 id="历史"><a href="#历史" class="headerlink" title="历史"></a><strong>历史</strong></h3><p>最初，为了让开发者能够尽早用上新的JS特性，babel团队开发了<code>babel-preset-latest</code>。这个preset比较特殊，它是多个preset的集合(es2015+)，并且随着ECMA规范的更新更增加它的内容。比如，当前(2018.06.02)，它包含的preset包括：es2017、es1016、es2015。到了明年，可能它包含的preset就包括：es2018、es2017、es2016、es2015。随着时间的推移，<code>babel-preset-latest</code> 包含的插件越来越多，这带来了如下问题：  </p><ul><li>加载的插件越来越多，编译速度会越来越慢；</li><li>随着用户浏览器的升级，ECMA规范的支持逐步完善，编译至低版本规范的必要性在减少（比如ES6 -&gt; ES5），多余的转换不单降低执行效率，还浪费带宽。  </li></ul><p>因为上述问题的存在，babel官方推出了<code>babel-preset-env</code>插件。它可以根据开发者的配置，按需加载插件。配置项大致包括：  </p><ul><li>需要支持的平台：比如node、浏览器等。</li><li>需要支持的平台的版本：比如支持<a href="mailto:node@6.1" target="_blank" rel="noopener">node@6.1</a>等。<br>默认配置的情况下，它跟 <code>babel-preset-latest</code> 是等同的，会加载从<code>es2015</code>开始的所有<code>preset</code>。</li></ul><h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a><strong>配置方法</strong></h3><ul><li>.babelrc 配个默认值</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;  <span class="attr">"presets"</span>: [ <span class="string">"env"</span> ]&#125;</span><br></pre></td></tr></table></figure><p>假设在如上配置下，有个文件：<code>index.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p><p>采用 babel-preset-env，默认配置下，输出的转换结果如下:  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _ref = _asyncToGenerator( <span class="comment">/*#__PURE__*/</span>regeneratorRuntime.mark(<span class="function"><span class="keyword">function</span> <span class="title">_callee</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">_callee$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="number">1</span>) &#123;        <span class="keyword">switch</span> (_context.prev = _context.next) &#123;          <span class="keyword">case</span> <span class="number">0</span>:          <span class="keyword">case</span> <span class="string">"end"</span>:            <span class="keyword">return</span> _context.stop();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, _callee, <span class="keyword">this</span>);</span><br><span class="line">  &#125;));  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _ref.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;();<span class="function"><span class="keyword">function</span> <span class="title">_asyncToGenerator</span>(<span class="params">fn</span>) </span>&#123; <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">var</span> gen = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123; <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">key, arg</span>) </span>&#123; <span class="keyword">try</span> &#123; <span class="keyword">var</span> info = gen[key](arg); <span class="keyword">var</span> value = info.value; &#125; <span class="keyword">catch</span> (error) &#123; reject(error); <span class="keyword">return</span>; &#125; <span class="keyword">if</span> (info.done) &#123; resolve(value); &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(value).then(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123; step(<span class="string">"next"</span>, value); &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; step(<span class="string">"throw"</span>, err); &#125;); &#125; &#125; <span class="keyword">return</span> step(<span class="string">"next"</span>); &#125;); &#125;; &#125;</span><br></pre></td></tr></table></figure><p>如果我们的代码是打算跑在<a href="mailto:node@8.9.3" target="_blank" rel="noopener">node@8.9.3</a>版本上，那上面的兼容代码就有点多余了，因为<a href="mailto:node@8.9.3" target="_blank" rel="noopener">node@8.9.3</a>已经支持了async/await。那我们可以修改<code>.babelrc</code>:  </p><ul><li>支持node版本的配置  </li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [ <span class="string">"env"</span>, &#123;<span class="attr">"targets"</span>: &#123;<span class="attr">"node"</span>: <span class="string">"8.9.3"</span>&#125; &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果执行 <code>npm bin/babel index.js</code>，则转换结果如下，几乎没有变化，因为node最新版本支持 async/await，因此不需要额外的兼容代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>支持浏览器相关的配置<br>比如，我们需要支持 IE8+、chrome62+，那么可以这样配置：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>, &#123; <span class="attr">"targets"</span>: &#123;<span class="attr">"browsers"</span>: [ <span class="string">"ie &gt;= 8"</span>, <span class="string">"chrome &gt;= 62"</span> ]&#125; &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对浏览器版本范围的配置，<code>babel-preset-env</code> 借助了 <code>browserslist</code> 这个库，更多的配置可以自行探究。</p><ul><li><p>配置项： <strong>useBuiltIns</strong><br>提供”usage” | “entry” | false 三个配置项,默认值为 false；这个配置项用来决定<code>@babel/preset-env</code>如何处理 <code>polyfills</code>；当使用 usage 或 entry 配置项时,<code>@babel-preset-env</code> 将直接(entry)引用(或按需(usage)引入)<code>core-js</code> 模块,这意味着 <code>core-js</code> 将对文件本身进行解析。</p></li><li><p>配置项： <strong>corejs</strong><br>2, 3 or { version: 2 | 3, proposals: boolean }, defaults to 2.可选2，3，默认为2。</p></li></ul><h3 id="vue-cli3中的配置情况"><a href="#vue-cli3中的配置情况" class="headerlink" title="vue-cli3中的配置情况"></a>vue-cli3中的配置情况</h3><p>再看<code>@vue/babel-preset-app</code>，重要部分：<br>可知，vue-cli 使用的 vue-preset-app 封装了@babel/preset-env`, corejs没做配置,所以为默认值 2</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">useBuiltIns:</span> <span class="string">'usage'</span>;</span><br><span class="line"><span class="string">corejs:</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><h2 id="core-js"><a href="#core-js" class="headerlink" title="core-js"></a>core-js</h2><p>core-js 是 babel 转码的核心包,它使用 es5 API实现了一些 ECMAScript 到 2019 年的 polyfills,并且提供按需加载,且使用它不污染全局名称空间。</p><p>再来看core-js。vue-cli3安装的是2.6.9 （从node_modules里看到的具体安装版本 <code>npm ls | grep core-js</code>）。</p><p>再来<code>github</code> 查看<a href="https://github.com/zloirock/core-js/tree/v2.6.9" target="_blank" rel="noopener"><code>core-js</code></a>的内容，切到相应版本后，es5，es6都支持了；es7部分支持了。</p><p>async， await，flatten等等都支持了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;vue-cli3中能不能随便用新的ES版本语法？&quot;&gt;&lt;a href=&quot;#vue-cli3中能不能随便用新的ES版本语法？&quot; class=&quot;headerlink&quot; title=&quot;vue-cli3中能不能随便用新的ES版本语法？&quot;&gt;&lt;/a&gt;vue-cli3中能不能随便
      
    
    </summary>
    
    
      <category term="vue-cli3.0" scheme="https://akijiangrou.github.io/tags/vue-cli3-0/"/>
    
      <category term="babel" scheme="https://akijiangrou.github.io/tags/babel/"/>
    
      <category term="兼容性" scheme="https://akijiangrou.github.io/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>ES2015-2020</title>
    <link href="https://akijiangrou.github.io/2020/03/24/ES2015-2020/"/>
    <id>https://akijiangrou.github.io/2020/03/24/ES2015-2020/</id>
    <published>2020-03-24T02:33:00.000Z</published>
    <updated>2020-03-24T04:00:50.876Z</updated>
    
    <content type="html"><![CDATA[<p>ES6 是ECMA 为 Javascript制定的第6个标准版本。每年六月正式发布，并作为当年的而正式版本。从2015年开始，每年都发一个新的版本。到2020年已经发行了6个了。ES7 (ES2016)。。。。依次类推。所以有人把ES6(ECMA2015)之后的统称为ES6，按这种方法ES6目前涵盖了：ES2015、ES2016、ES2017、ES2018、ES2019、ES2020。  </p><h2 id="ES2015"><a href="#ES2015" class="headerlink" title="ES2015"></a>ES2015</h2><p>这个版本更新的内容特别多，超级大版本。如下图，本文中所有图片都摘自<a href="https://zhuanlan.zhihu.com/p/87699079" target="_blank" rel="noopener">知乎</a><br><img src="./es2015.jpg"></p><p>重点：</p><ul><li>let， const</li><li>箭头函数</li><li>解构赋值</li><li>作用域</li><li>Symbol</li><li>Set，Map</li><li>Proxy， Reflect</li><li>Class</li><li>Module</li><li>promise</li><li>generator<br>还有每个类型的功能拓展。属于一个超级大的变更。</li></ul><h2 id="ES2016"><a href="#ES2016" class="headerlink" title="ES2016"></a>ES2016</h2><p>这次就多了两个功能：  </p><ul><li>数值扩展： 添加了 ** 求幂</li><li>数组扩展：arr.includes()，可以判断arr.includes([NaN]) </li></ul><h2 id="ES2017"><a href="#ES2017" class="headerlink" title="ES2017"></a>ES2017</h2><p>摘自知乎：<br><img src="./es2017.jpg"></p><ul><li>String.prototype.padStart/String.prototype.padEnd</li></ul><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">'es8</span><span class="symbol">'.padStart</span>(<span class="name">2</span>)<span class="comment">;          // 'es8'，如果长度小于原字符串，返回原字符串</span></span><br><span class="line"><span class="symbol">'es8</span><span class="symbol">'.padStart</span>(<span class="name">5</span>)<span class="comment">;          // '  es8'</span></span><br><span class="line"><span class="symbol">'es8</span><span class="symbol">'.padStart</span>(<span class="name">7</span>, <span class="symbol">'0</span>')<span class="comment">;     // '0000es8'</span></span><br></pre></td></tr></table></figure><ul><li><p>Object.values / Object.entries</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 示例</span><br><span class="line">const obj = &#123; x: <span class="string">'xxx'</span>, y: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="symbol">Object</span>.entries(obj); // [[<span class="string">'x'</span>, <span class="string">'xxx'</span>], [<span class="string">'y'</span>, <span class="number">1</span>]]</span><br><span class="line">const obj = [<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'8'</span>];</span><br><span class="line"><span class="symbol">Object</span>.entries(obj); // [[<span class="string">'0'</span>, <span class="string">'e'</span>], [<span class="string">'1'</span>, <span class="string">'s'</span>], [<span class="string">'2'</span>, <span class="string">'8'</span>]]</span><br><span class="line">const obj = &#123; <span class="number">10</span>: <span class="string">'xxx'</span>, <span class="number">1</span>: <span class="string">'yyy'</span>, <span class="number">3</span>: <span class="string">'zzz'</span> &#125;;</span><br><span class="line"><span class="symbol">Object</span>.entries(obj); // [[<span class="string">'1'</span>, <span class="string">'yyy'</span>], [<span class="string">'3'</span>, <span class="string">'zzz'</span>], [<span class="string">'10'</span>: <span class="string">'xxx'</span>]]</span><br><span class="line"><span class="symbol">Object</span>.entries(<span class="string">'es8'</span>); // [[<span class="string">'0'</span>, <span class="string">'e'</span>], [<span class="string">'1'</span>, <span class="string">'s'</span>], [<span class="string">'2'</span>, <span class="string">'8'</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 示例</span><br><span class="line">const obj = &#123; x: <span class="string">'xxx'</span>, y: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="symbol">Object</span>.values(obj); // [<span class="string">'xxx'</span>, <span class="number">1</span>]</span><br><span class="line">const obj = [<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'8'</span>]; // same as &#123; <span class="number">0</span>: <span class="string">'e'</span>, <span class="number">1</span>: <span class="string">'s'</span>, <span class="number">2</span>: <span class="string">'8'</span> &#125;;</span><br><span class="line"><span class="symbol">Object</span>.values(obj); // [<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'8'</span>]</span><br><span class="line">// when we use numeric keys, the values returned in a numerical </span><br><span class="line">// order according to the keys</span><br><span class="line">const obj = &#123; <span class="number">10</span>: <span class="string">'xxx'</span>, <span class="number">1</span>: <span class="string">'yyy'</span>, <span class="number">3</span>: <span class="string">'zzz'</span> &#125;;</span><br><span class="line"><span class="symbol">Object</span>.values(obj); // [<span class="string">'yyy'</span>, <span class="string">'zzz'</span>, <span class="string">'xxx'</span>]</span><br><span class="line"><span class="symbol">Object</span>.values(<span class="string">'es8'</span>); // [<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'8'</span>]</span><br></pre></td></tr></table></figure></li><li><p>Object.getOwnPropertyDescriptors<br>该函数返回指定对象（参数）的所有自身属性描述符。所谓自身属性描述符就是在对象自身内定义，不是通过原型链继承来的属性。</p></li><li><p>函数参数列表和调用中的尾逗号<br>ES8 允许在函数定义或者函数调用时，最后一个参数之后存在一个结尾逗号而不报 SyntaxError 的错误。</p></li><li><p>Async/Await<br>封装的generator，promise的终极用法。  </p></li><li><p>共享内存和原子操作<br>由全局对象SharedArrayBuffer和Atomics实现，将数据存储在一块共享内存空间中，这些数据可在JS主线程和web-worker线程之间共享</p></li></ul><h2 id="ES2018"><a href="#ES2018" class="headerlink" title="ES2018"></a>ES2018</h2><ul><li>字符串扩展：遇到不合法的字符串转义返回undefined。可从raw上获取原字符串。</li><li>对象扩展…  </li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; __proto__: Object.getPrototypeOf(obj1), ...obj1 &#125;  <span class="comment">// 克隆对象</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; ...obj1, ...obj2 &#125;  <span class="comment">// 合并对象</span></span><br><span class="line">&#123; ...<span class="string">"hello"</span> &#125; <span class="comment">// 转换字符串为对象</span></span><br><span class="line">&#123; ...[<span class="number">1</span>, <span class="number">2</span>] &#125; <span class="comment">// 转换数组为对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; x, ...rest/spread &#125; = &#123; x: <span class="number">1</span>, y: <span class="number">2</span>, z: <span class="number">3</span> &#125; <span class="comment">// 与对象解构赋值结合,(不能复制继承自原型对象的属性)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; x: <span class="number">1</span>, ...&#123; x: <span class="number">2</span> &#125; &#125; <span class="comment">// 修改现有对象部分属性</span></span><br></pre></td></tr></table></figure><ul><li><p>正则扩展</p><ul><li>dotAll：是否设置s修饰符  </li><li>后行断言：x只有在y后才匹配  </li><li>后行否定断言：x只有不在y后才匹配  </li><li>Unicode属性转义：匹配符合Unicode某种属性的所有字符  </li><li>正向匹配：\p{PropRule}  </li><li>反向匹配：\P{PropRule}  </li><li>限制：\p{…}和\P{…}只对Unicode字符有效，使用时需加上u修饰符  </li><li>具名组匹配：为每组匹配指定名字(?<groupname>)<br>形式：str.exec().groups.GroupName<br>解构赋值替换<br>声明：const time = “2017-09-11”、const regexp = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u</day></month></year></groupname></li></ul></li><li><p>Async 优化</p></li></ul><h2 id="ES2019"><a href="#ES2019" class="headerlink" title="ES2019"></a>ES2019</h2><p><img src="./es2019.png" width="600px"></p><ul><li>String.trimStart() &amp; String.trimEnd()</li></ul><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> = <span class="string">' ES2019! Yay! '</span><span class="comment">;</span></span><br><span class="line"><span class="built_in">string</span>.trimStart()<span class="comment">;</span></span><br><span class="line">// <span class="string">"ES2019! Yay! "</span></span><br><span class="line"><span class="built_in">string</span>.trimEnd()<span class="comment">;</span></span><br><span class="line">// <span class="string">" ES2019! Yay!"</span></span><br></pre></td></tr></table></figure><ul><li>Object.fromEntries();<br>把数组形式的key-value转成object。</li></ul><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> entries = [ [‘foo’, ‘bar’] ];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">object</span> = <span class="keyword">Object</span>.fromEntries(entries);</span><br><span class="line"><span class="comment">// &#123; foo: ‘bar’ &#125;</span></span><br></pre></td></tr></table></figure><ul><li>Array.flat() Array.flatMap()<br>flat(level)，这里的level可以指定展平到哪个层级。  </li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[1,</span> <span class="number">2</span><span class="string">,</span> <span class="string">[3,</span> <span class="number">4</span><span class="string">,</span> <span class="string">[5,</span> <span class="number">6</span><span class="string">]]].flat(2);</span></span><br><span class="line"><span class="string">//</span> <span class="string">[</span> <span class="number">1</span><span class="string">,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">,</span> <span class="number">4</span><span class="string">,</span> <span class="number">5</span><span class="string">,</span> <span class="number">6</span> <span class="string">]</span></span><br><span class="line"><span class="string">[1,</span> <span class="number">2</span><span class="string">,</span> <span class="string">[3,</span> <span class="number">4</span><span class="string">,</span> <span class="string">[5,</span> <span class="number">6</span><span class="string">]]].flat(1);</span></span><br><span class="line"><span class="string">//</span> <span class="string">[</span> <span class="number">1</span><span class="string">,</span> <span class="number">2</span><span class="string">,</span> <span class="number">3</span><span class="string">,</span> <span class="number">4</span><span class="string">,</span> <span class="string">[5,</span> <span class="number">6</span><span class="string">]</span> <span class="string">]</span></span><br></pre></td></tr></table></figure><p>flatMap，就是先flat再map</p><ul><li>try，catch 。catch参数可选了。如下也是可以的。 </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isValidJSON = <span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">JSON</span>.parse(json);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><p>Symbol.description<br>给symbol加个描述的属性。</p></li><li><p>JSON superset<br>部分JSON.parse 不在报错了。之前如果JSON字符串中包含有行分隔符(\u2028) 和段落分隔符(\u2029)，那么在解析过程中会报错。  </p></li><li><p>sort 更加稳定</p></li><li><p>Function.prototype.toString()<br>将返回更完整的内容了。</p></li></ul><h2 id="ES2020"><a href="#ES2020" class="headerlink" title="ES2020"></a>ES2020</h2><ul><li>Promise.allSettled<br>都知道 Promise.all 具有并发执行异步任务的能力。但它的最大问题就是如果其中某个任务出现异常(reject)，所有任务都会挂掉，Promise直接进入 reject 状态。<br>我们需要一种机制，如果并发任务中，无论一个任务正常或者异常，都会返回对应的的状态（fulfilled 或者 rejected）与结果（业务value 或者 拒因 reason），在 then 里面通过 filter 来过滤出想要的业务逻辑结果，这就能最大限度的保障业务当前状态的可访问性，而 Promise.allSettled 就是解决这问题的。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.allSettled([</span><br><span class="line">    <span class="built_in">Promise</span>.reject(&#123;<span class="attr">code</span>: <span class="number">500</span>, <span class="attr">msg</span>: <span class="string">'服务异常'</span>&#125;),</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">list</span>: []&#125;),</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">list</span>: []&#125;)</span><br><span class="line">])</span><br><span class="line">.then(<span class="function">(<span class="params">ret</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        0: &#123;status: "rejected", reason: &#123;…&#125;&#125;</span></span><br><span class="line"><span class="comment">        1: &#123;status: "fulfilled", value: &#123;…&#125;&#125;</span></span><br><span class="line"><span class="comment">        2: &#123;status: "fulfilled", value: &#123;…&#125;&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 过滤掉 rejected 状态，尽可能多的保证页面区域数据渲染</span></span><br><span class="line">    RenderContent(ret.filter(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> el.status !== <span class="string">'rejected'</span>;</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>可选链<br>可让我们在查询具有多层级的对象时，不再需要进行冗余的各种前置校验。</li></ul><p>日常开发中，我们经常会遇到这种查询 </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var name =<span class="built_in"> user </span>&amp;&amp; user.<span class="builtin-name">info</span> &amp;&amp; user.info.name;</span><br></pre></td></tr></table></figure><p>用可选链：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">var name</span> = user<span class="meta">?.info?</span>.name;</span><br><span class="line"><span class="attribute">var age</span> = user<span class="meta">?.info?.getAge?</span>.();</span><br></pre></td></tr></table></figure><p>可选链中的 ? 表示如果问号左边表达式有值, 就会继续查询问号后面的字段。根据上面可以看出，用可选链可以大量简化类似繁琐的前置校验操作，而且更安全。</p><ul><li>空值合并运算符  </li></ul><p>原来的写法：<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">level</span> =  <span class="keyword">user</span>.data.<span class="keyword">level</span> || <span class="string">'暂无等级'</span>; // 如果levle是<span class="number">0</span>，也显示暂无等级，是不对的。</span><br><span class="line"></span><br><span class="line">// 完整的写法</span><br><span class="line">var <span class="keyword">level</span> = <span class="keyword">user</span>.<span class="keyword">level</span> !== undefined &amp;&amp; <span class="keyword">user</span>.<span class="keyword">level</span> !== <span class="keyword">null</span></span><br><span class="line">  ? <span class="keyword">user</span>.<span class="keyword">level</span></span><br><span class="line">  : <span class="string">'暂无等级'</span>;</span><br></pre></td></tr></table></figure></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> &#123;</span><br><span class="line"><span class="regexp">//</span>   <span class="string">"level"</span>: <span class="number">0</span>   </span><br><span class="line"><span class="regexp">//</span> &#125;</span><br><span class="line">var level = user.level ?? <span class="string">'暂无等级'</span>; <span class="regexp">//</span> level -&gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> &#123;</span><br><span class="line"><span class="regexp">//</span>   <span class="string">"an_other_field"</span>: <span class="number">0</span>   </span><br><span class="line"><span class="regexp">//</span> &#125;</span><br><span class="line">var level = user.level ?? <span class="string">'暂无等级'</span>; <span class="regexp">//</span> level -&gt; <span class="string">'暂无等级'</span></span><br></pre></td></tr></table></figure><p>空值合并运算符 与 可选链 相结合，可以很轻松处理多级查询并赋予默认值问题。  </p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">var level</span> = user.data<span class="meta">?.level ??</span> <span class="string">'暂无等级'</span>;</span><br></pre></td></tr></table></figure><ul><li>按需引用 </li></ul><p>webpack已经支持了。  </p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">el.onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">import</span>(`/path/current-logic.js`)</span><br><span class="line">    .<span class="keyword">then</span>(<span class="function"><span class="params">(<span class="built_in">module</span>)</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">module</span>.doSomthing();</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">(err)</span> =&gt;</span> &#123;</span><br><span class="line">        // <span class="built_in">load</span> <span class="built_in">error</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>globalThis<br>过去获取全局对象，可通过一个全局函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getGlobal = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">'undefined'</span>) &#123; <span class="keyword">return</span> self; &#125; </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span>) &#123; <span class="keyword">return</span> <span class="built_in">window</span>; &#125; </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> global !== <span class="string">'undefined'</span>) &#123; <span class="keyword">return</span> global; &#125; </span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'unable to locate global object'</span>); </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> globals = getGlobal(); </span><br><span class="line"></span><br><span class="line"><span class="comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis</span></span><br></pre></td></tr></table></figure><p>而 globalThis 目的就是提供一种标准化方式访问全局对象，有了 globalThis 后，你可以在任意上下文，任意时刻都能获取到全局对象。</p><ul><li>bigInt<br>Js 中 Number类型只能安全的表示-(2^53-1)至 2^53-1 范的值，即Number.MIN_SAFE_INTEGER 至Number.MAX_SAFE_INTEGER，超出这ES2020提供一种新的数据类型：BigInt。 使用 BigInt 有两种方式：  </li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在整数字面量后面加n。</span></span><br><span class="line"><span class="keyword">var</span> bigIntNum = <span class="number">9007199254740993</span>n;</span><br><span class="line"><span class="comment">// 使用 BigInt 函数。</span></span><br><span class="line"><span class="keyword">var</span> bigIntNum = BigInt(<span class="number">9007199254740</span>);</span><br><span class="line"><span class="keyword">var</span> anOtherBigIntNum = BigInt(<span class="string">'9007199254740993'</span>);</span><br></pre></td></tr></table></figure><ul><li>String.prototype.matchAll<br>合并了遍历与match  </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ES6 是ECMA 为 Javascript制定的第6个标准版本。每年六月正式发布，并作为当年的而正式版本。从2015年开始，每年都发一个新的版本。到2020年已经发行了6个了。ES7 (ES2016)。。。。依次类推。所以有人把ES6(ECMA2015)之后的统称为ES6
      
    
    </summary>
    
    
      <category term="javascript" scheme="https://akijiangrou.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>flutter学习记录一</title>
    <link href="https://akijiangrou.github.io/2020/01/08/flutter%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%E4%B8%80/"/>
    <id>https://akijiangrou.github.io/2020/01/08/flutter学习记录一/</id>
    <published>2020-01-08T01:41:26.000Z</published>
    <updated>2020-03-24T02:30:16.443Z</updated>
    
    <content type="html"><![CDATA[<p>最近想弄客户端，对于前端以及目前趋势来说，RN，Weex，flutter都比较友好。而google大神弄的flutter越来越火热，越来越成熟，所以赶紧学起来吧（虽然已经说了大半年了）。</p><h1 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h1><p>Flutter是谷歌的移动UI框架，可以快速在iOS和Android上构建高质量的原生用户界面。  </p><ul><li>具有跨平台开发特性，支持IOS、Android、Web三端。</li><li>热重载特性大大提高了开发效率</li><li>自绘UI引擎和编译成原生代码的方式，使得系统的运行时的高性能成为了可能</li><li>使用Dart语言，目前已经支持同时编译成Web端代码，</li></ul><h1 id="移动端跨平台技术对比"><a href="#移动端跨平台技术对比" class="headerlink" title="移动端跨平台技术对比"></a>移动端跨平台技术对比</h1><h2 id="H5-原生APP"><a href="#H5-原生APP" class="headerlink" title="H5+原生APP"></a>H5+原生APP</h2><p>APP中提供一个Webview使用H5页面的Http直连。APP和H5可以相互独立开发，JS使用Bridge与原生进行数据通信，显示界面依赖Webview的浏览器渲染。 但是带来的问题也很明显，因为是需要远程直连，那么初次打开H5页面，会有瞬间的白屏，并且Webview本身会有至少几十M的内存消耗</p><p>作为前端开发人员，在H5方式可以使用SPA单页面、懒加载、离线H5等各种前端优化手段进行性能优化，以使得H5的表现更接近原生。但是首次加载的瞬间白屏，桥协议通信效率低下。</p><h2 id="RN-amp-Weex"><a href="#RN-amp-Weex" class="headerlink" title="RN&amp;Weex"></a>RN&amp;Weex</h2><p>使用原生去解析RN、Weex的显示配置。显示层、逻辑层都直接与原生数据通信，不使用浏览器，性能提升了一大截。但是，每次遇到显示的变更，JS都还会通过Bridge和原生转一道再做渲染的调整，所以Bridge就最后成为了性能的瓶颈。在实际项目中，特别是做一些大量复杂动画处理的时候，由于渲染部分需要频繁通信，性能问题突出。</p><h2 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h2><p>Flutter代码编译完成以后，直接就是原生代码，并且使用自绘UI引擎原生方式做渲染。Flutter依赖一个Skia 2D图形化引擎。Skia也是Android平台和Chrome的底层渲染引擎，所以性能方面完全不用担心。因为使用Dart做AOT编译成原生，自然也比使用解释性的JS在V8引擎中执行性能更快，并且因为去掉Bridge，没有了繁琐的数据通信和交互，性能就更前进了一步。</p><p>以上摘自<a href="https://zhuanlan.zhihu.com/p/90836859?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=78552464621568" target="_blank" rel="noopener">腾讯的一篇文章</a></p><h1 id="Dart"><a href="#Dart" class="headerlink" title="Dart"></a>Dart</h1><p>提到Flutter不得不提Dart。对于前端同学比较容易上手。如果单纯学习语言，可以使用网站的Dartpad进行代码编写与运行。<br><a href="https://dart.dev/samples" target="_blank" rel="noopener">Dart官方网站</a></p><h1 id="hello-world-Flutter"><a href="#hello-world-Flutter" class="headerlink" title="hello world - Flutter"></a>hello world - Flutter</h1><p>安装过程，参考<a href="https://flutter.dev/docs/get-started/install/macos" target="_blank" rel="noopener">官网</a>，还挺全的。</p><p>按官网操作，起一个hello world。然后我们开始看看结构。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="./pic1.png" alt="Alt text" title="Flutter结构图">                </div>                <div class="image-caption">Flutter结构图</div>            </figure></p><ul><li><p>入口主文件： main.dart<br>main函数，runApp(xxx)<br>Widget =&gt; MaterialApp =&gt; Scaffold =&gt; title ,body   </p><p>scaffold 可以理解成html，里面有各种标签可以用。</p></li><li><p>pubspec.yaml 项目配置文件</p></li></ul><h2 id="重要组件"><a href="#重要组件" class="headerlink" title="重要组件"></a>重要组件</h2><ul><li><strong>Widget</strong><br>一切都是widget。常用的如下：  </li></ul><ol><li><p>TEXT  </p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Text</span>(</span><br><span class="line">  <span class="string">"Hello world"</span>,</span><br><span class="line">  <span class="attribute">style</span>: TextStyle(</span><br><span class="line">    <span class="attribute">fontSize</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attribute">fontWeight</span>: FontWeight.bold,</span><br><span class="line">    <span class="attribute">color</span>:Color(<span class="number">0</span>xFF0000ff)</span><br><span class="line">  )</span><br><span class="line">),</span><br></pre></td></tr></table></figure></li><li><p>BUTTON  </p></li></ol><ul><li>RaisedButton: 凸起的按钮</li><li>FlatButton：扁平化按钮</li><li>OutlineButton：带边框按钮</li><li>IconButton：带图标按钮</li></ul><p><code>onPressed</code>  – 相对于click<br><code>child</code> 可以放入其他widgit，常用Text<br><code>color</code> 颜色<br><code>icon</code>  图标，自带图标库，Icon(Icons.add)</p><ol start="3"><li><p>CONTAINER<br>相当于html里的div。padding，margin，transform，width，height。。。。</p></li><li><p>IMAGE</p></li></ol><ul><li><p>网络图片</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">child:</span>Image(</span><br><span class="line"><span class="symbol">  image:</span> NetworkImage(<span class="string">"https://mat1.gtimg.com/pingjs/ext2020/qqindex2018/dist/img/qq_logo_2x.png"</span>),</span><br><span class="line"><span class="symbol">  width:</span> <span class="number">200.0</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>本地图片</p></li></ul><ol><li><p>先在pubspec.yaml 中引入文件：  </p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">assets:</span> </span><br><span class="line">  - assets<span class="meta-keyword">/images/</span>logo.png</span><br></pre></td></tr></table></figure></li><li><p>使用时</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">child:</span> Image(</span><br><span class="line"><span class="symbol">  image:</span> AssetImage(<span class="string">"assets/images/logo.png"</span>),</span><br><span class="line"><span class="symbol">  width:</span> <span class="number">200.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><ul><li><p>ROW &amp; COLUMN &amp; CENTER  行布局、列布局、居中布局<br>row, column 中用children，center用child</p></li><li><p>Align角定位<br>flutter里，必须依赖Align 这个定位的Widget  </p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Align(</span><br><span class="line">  alignment: Alignment.bottomRight,</span><br><span class="line">  child<span class="symbol">:Text</span>(<span class="string">"Hello Align "</span>,style<span class="symbol">:TextStyle</span>(<span class="name">fontSize</span>: <span class="number">20</span>,color: Colors.white)),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li><li><p>绝对定位，Stack&amp;Positioned  </p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">child:</span>Stack(</span><br><span class="line"><span class="symbol">  children:</span> <span class="params">&lt;Widget&gt;</span>[</span><br><span class="line">    Image.network(<span class="string">"https://ossweb-img.qq.com/upload/adw/image/20191022/627bdf586e0de8a29d5a48b86700a790.jpeg"</span>),</span><br><span class="line">    Positioned(</span><br><span class="line"><span class="symbol">      top:</span> <span class="number">20</span>,</span><br><span class="line"><span class="symbol">      right:</span> <span class="number">10</span>,</span><br><span class="line"><span class="symbol">      child:</span>Image.asset(<span class="string">"assets/images/logo.png"</span>,width:<span class="number">200.0</span>)</span><br><span class="line">    )</span><br><span class="line">  ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>flutter 内已经封装了HttpClient库，dart:io。原生的用着比较麻烦。推荐使用Dio。需要先在pubspec.yaml中添加。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">flutter:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">    <span class="attr">json_annotation:</span> <span class="string">^2.0.0</span></span><br><span class="line">    <span class="attr">dio:</span> <span class="number">2.1</span><span class="number">.16</span></span><br></pre></td></tr></table></figure></p><p>代码示例：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"></span><br><span class="line">Future _getByDio() <span class="keyword">async</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 接口地址</span></span><br><span class="line">      <span class="keyword">const</span> url=<span class="string">"https://www.demo.com/api"</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//定义 Dio实例</span></span><br><span class="line">      BaseOptions options = <span class="keyword">new</span> BaseOptions(</span><br><span class="line">        baseUrl: <span class="string">"https://www.xx.com/api"</span>,</span><br><span class="line">        connectTimeout: <span class="number">5000</span>,</span><br><span class="line">        receiveTimeout: <span class="number">3000</span>,</span><br><span class="line">      );</span><br><span class="line">      Dio dio = <span class="keyword">new</span> Dio(options);</span><br><span class="line">      <span class="comment">//获取dio返回的Response</span></span><br><span class="line">      Response response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(url);</span><br><span class="line">      <span class="comment">//返回值转化为JSON</span></span><br><span class="line">      <span class="keyword">var</span> json=jsonDecode(response.data);</span><br><span class="line">      <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近想弄客户端，对于前端以及目前趋势来说，RN，Weex，flutter都比较友好。而google大神弄的flutter越来越火热，越来越成熟，所以赶紧学起来吧（虽然已经说了大半年了）。&lt;/p&gt;
&lt;h1 id=&quot;是什么&quot;&gt;&lt;a href=&quot;#是什么&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="flutter" scheme="https://akijiangrou.github.io/tags/flutter/"/>
    
  </entry>
  
  <entry>
    <title>animation笔记</title>
    <link href="https://akijiangrou.github.io/2019/11/14/animation%E7%AC%94%E8%AE%B0/"/>
    <id>https://akijiangrou.github.io/2019/11/14/animation笔记/</id>
    <published>2019-11-14T11:16:25.000Z</published>
    <updated>2019-11-15T12:05:58.848Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>通过<code>css3</code>为dom元素添加动效</p></blockquote><h1 id="属性列表"><a href="#属性列表" class="headerlink" title="属性列表"></a>属性列表</h1><table><thead><tr><th>值</th><th>说明</th></tr></thead><tbody><tr><td>animation-name</td><td>指定要绑定到选择器的关键帧的名称</td></tr><tr><td>animation-duration</td><td>动画指定需要多少秒或毫秒完成</td></tr><tr><td>animation-timing-function</td><td>设置动画将如何完成一个周期</td></tr><tr><td>animation-delay</td><td>设置动画在启动前的延迟间隔。</td></tr><tr><td>animation-iteration-count</td><td>定义动画的播放次数。</td></tr><tr><td>animation-direction</td><td>指定是否应该轮流反向播放动画。</td></tr><tr><td>animation-fill-mode</td><td>规定当动画完成时，或当动画有一个延迟未开始播放前，要应用到元素的样式。</td></tr><tr><td>animation-play-state</td><td>指定动画是否正在运行或已暂停。</td></tr><tr><td>initial</td><td>设置属性为其默认值。</td></tr><tr><td>inherit</td><td>从父元素继承属性。</td></tr></tbody></table><h2 id="animation-name"><a href="#animation-name" class="headerlink" title="animation-name"></a>animation-name</h2><p>指定<code>keyframes</code>的名字，用<code>,</code>分隔多个动画。写错了，则不应用。<br><code>keyframes</code>的用法如下：  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">keyframes</span> bounce &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  25% &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  75% &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">75px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ball</span> &#123;</span><br><span class="line">  <span class="attribute">animation-name</span>: bounce, ab;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">2s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此，就将<code>bounce</code>与<code>ab</code>动画绑到了<code>ball</code>这个<code>class</code>上了。</p><h2 id="animation-duration"><a href="#animation-duration" class="headerlink" title="animation-duration"></a>animation-duration</h2><p>单位为秒，或者毫秒。</p><h2 id="animation-timing-function"><a href="#animation-timing-function" class="headerlink" title="animation-timing-function"></a>animation-timing-function</h2><p>速度曲线定义动画从一套 CSS 样式变为另一套所用的时间，使变化更为平滑。<br>也可以为多个，用 <code>,</code>分隔</p><ul><li>ease，默认。动画以低速开始，然后加快，在结束前变慢。</li><li>linear，动画从头到尾的速度是相同的</li><li>ease-in， 动画以低速开始。</li><li>ease-out，动画以低速结束。</li><li>ease-in-out，动画以低速开始和结束。</li><li>cubic-bezier(n,n,n,n)，在 cubic-bezier 函数中自己的值。可能的值是从 0 到 1 的数值。</li></ul><h2 id="animation-delay"><a href="#animation-delay" class="headerlink" title="animation-delay"></a>animation-delay</h2><p>秒或毫秒计。0s是该属性的默认值，代表动画在应用到元素上后立即开始执行。否则，该属性的值代表动画样式应用到元素上后到开始执行前的时间长度；</p><h2 id="animation-iteration-count"><a href="#animation-iteration-count" class="headerlink" title="animation-iteration-count"></a>animation-iteration-count</h2><p>动画播放的次数，默认值为1。如果指定了多个值，每次播放动画时，将使用列表中的下一个值，在使用最后一个值后循环回第一个值。可以写<code>infinite</code></p><h2 id="animation-direction"><a href="#animation-direction" class="headerlink" title="animation-direction"></a>animation-direction</h2><p>指示动画是否反向播放</p><ul><li>normal，默认值，每个动画循环结束，动画重置到起点重新开始。</li><li>alternate，动画交替反向运行，反向运行时，动画按步后退，同时，带时间功能的函数也反向，比如，ease-in 在反向时成为ease-out。计数取决于开始时是奇数迭代还是偶数迭代</li><li>reverse，反向运行动画，每周期结束动画由尾到头运行。</li><li>alternate-reverse，反向开始运行，开始交替。动画第一次运行时是反向的，然后下一次是正向，后面依次循环。决定奇数次或偶数次的计数从1开始。</li></ul><h2 id="animation-fill-mode"><a href="#animation-fill-mode" class="headerlink" title="animation-fill-mode"></a>animation-fill-mode</h2><p>当动画完成时，或当动画有一个延迟未开始播放时，要应用到元素的样式。</p><p>默认情况下，CSS 动画在第一个关键帧播放完之前不会影响元素的样式，在最后一个关键帧完成后停止影响元素样式。animation-fill-mode 属性可重写该行为。</p><p>可选参数如下：</p><ul><li>none： 默认值。动画在动画执行之前和之后不会应用任何样式到目标元素</li><li>forwards：在动画结束后，动画将应用该属性值</li><li>backwards：动画将应用在 <code>animation-delay</code> 定义期间启动动画的第一次迭代的关键帧中定义的属性值。当<code>animation-direction</code> 为<code>normal</code> 或者 <code>alternate</code> 时的from值；和<code>animation-direction</code>为 <code>reverse</code>或 <code>alternate-reverse</code>。</li><li>both：包含<code>forwards</code>与<code>backwards</code></li><li>initial，inherit</li></ul><h2 id="animation-play-state"><a href="#animation-play-state" class="headerlink" title="animation-play-state"></a>animation-play-state</h2><p>可选参数：<code>paused</code>, <code>running</code><br>可以在其他样式中，加上这个参数后，比如点击按钮，那么就可以暂停当前的动画样式，如果点击取消后，则动画可以继续进行。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;通过&lt;code&gt;css3&lt;/code&gt;为dom元素添加动效&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;属性列表&quot;&gt;&lt;a href=&quot;#属性列表&quot; class=&quot;headerlink&quot; title=&quot;属性列表&quot;&gt;&lt;/a&gt;属性列表&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term="animation" scheme="https://akijiangrou.github.io/tags/animation/"/>
    
      <category term="css3" scheme="https://akijiangrou.github.io/tags/css3/"/>
    
  </entry>
  
  <entry>
    <title>weex学习</title>
    <link href="https://akijiangrou.github.io/2019/11/14/weex%E5%AD%A6%E4%B9%A0/"/>
    <id>https://akijiangrou.github.io/2019/11/14/weex学习/</id>
    <published>2019-11-14T11:16:13.000Z</published>
    <updated>2019-11-14T11:16:13.676Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>curl-学习记录</title>
    <link href="https://akijiangrou.github.io/2019/11/13/curl-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <id>https://akijiangrou.github.io/2019/11/13/curl-学习记录/</id>
    <published>2019-11-13T07:51:28.000Z</published>
    <updated>2019-11-13T09:12:23.053Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>cURL是一个利用URL语法在命令行下工作的文件传输工具，1997年首次发行。它支持文件上传和下载，所以是综合传输工具，但按传统，习惯称cURL为下载工具。</p><h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>支持多种协议，下面主要介绍几个网站开发常用的命令。</p><h2 id="1-查看网页源码"><a href="#1-查看网页源码" class="headerlink" title="1 查看网页源码"></a>1 查看网页源码</h2><p>直接在curl命令后加上网址，就可以看到网页源码。    </p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p><img src="./1.png" width="70%" alt="curl www.sina.com">  </p><h2 id="2-保存网页"><a href="#2-保存网页" class="headerlink" title="2 保存网页"></a>2 保存网页</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-o</span> <span class="selector-tag">output</span><span class="selector-class">.txt</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>会将页面内容存储在<code>output.txt</code>中。</p><h2 id="3-自动跳转"><a href="#3-自动跳转" class="headerlink" title="3 自动跳转"></a>3 自动跳转</h2><p>对于一些301的网站，可以使用 <code>-L</code> 进行跳转，找到最终页面。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-L</span> <span class="selector-tag">-o</span> <span class="selector-tag">output</span><span class="selector-class">.html</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure></p><p>结果会自动跳转到<a href="http://www.sina.com.cn" target="_blank" rel="noopener">www.sina.com.cn</a></p><p>验证可通过输出到 <code>output.txt</code> 中查看</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-o</span> <span class="selector-tag">output</span><span class="selector-class">.txt</span> <span class="selector-tag">-L</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><h2 id="4-显示header信息"><a href="#4-显示header信息" class="headerlink" title="4 显示header信息"></a>4 显示header信息</h2><p><code>-i</code> 可以显示<code>http response</code>的 header信息，以及结果。示例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-i</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>结果如下：<br><img src="./2.png" width="80%"></p><h2 id="5-显示通信过程"><a href="#5-显示通信过程" class="headerlink" title="5 显示通信过程"></a>5 显示通信过程</h2><p><code>-v</code> 可以显示http通信的整个过程，包括请求头，响应头与结果。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">-v</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>结果如下：<br><img src="./3.png" width="80%"></p><p>如果想查看更细节通信过程，包括字节包，可以使用：  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">--trace</span> <span class="selector-tag">output</span><span class="selector-class">.txt</span> <span class="selector-tag">www</span><span class="selector-class">.sina</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>查看output.txt即可。  </p><h2 id="6-请求添加信息"><a href="#6-请求添加信息" class="headerlink" title="6 请求添加信息"></a>6 请求添加信息</h2><h3 id="增加header信息"><a href="#增加header信息" class="headerlink" title="增加header信息"></a>增加header信息</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --header <span class="string">"Content-Type:application/json"</span> <span class="string">http:</span><span class="comment">//example.com</span></span><br></pre></td></tr></table></figure><p><code>--header</code> 或者 <code>-H</code></p><h3 id="增加cookie"><a href="#增加cookie" class="headerlink" title="增加cookie"></a>增加cookie</h3><p>–cookie 或者 -b 都可以，也可以发送一个文件里的内容。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl --cookie <span class="string">"name=xxx"</span> -<span class="selector-tag">b</span> <span class="string">"foo=bar"</span> www<span class="selector-class">.example</span>.com</span><br></pre></td></tr></table></figure></p><p>读取cookie写入文件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -c cookies.txt <span class="string">https:</span><span class="comment">//www.google.com</span></span><br></pre></td></tr></table></figure><p>在cookies.txt中就可以看到cookie。</p><h3 id="增加user-agent信息"><a href="#增加user-agent信息" class="headerlink" title="增加user-agent信息"></a>增加user-agent信息</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -A <span class="string">"Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A293 Safari/6531.22.7"</span> www.sina.com</span><br></pre></td></tr></table></figure><h3 id="发送get请求"><a href="#发送get请求" class="headerlink" title="发送get请求"></a>发送get请求</h3><p><code>-G</code>参数用来构造 URL 的查询字符串。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -G -d <span class="string">'q=kitties'</span> -d <span class="string">'count=20'</span> http<span class="variable">s:</span>//google.<span class="keyword">com</span>/<span class="built_in">search</span></span><br></pre></td></tr></table></figure><p>上面命令会发出一个 <code>GET</code> 请求，实际请求的 <code>URL</code> 为<a href="https://google.com/search?q=kitties&amp;count=20。" target="_blank" rel="noopener">https://google.com/search?q=kitties&amp;count=20。</a> 如果不加<code>-G</code>则会发出post请求。如果数据需要<code>URL</code>编码，可以结合<code>--data--urlencode</code>参数。</p><h3 id="发送post请求的数据体"><a href="#发送post请求的数据体" class="headerlink" title="发送post请求的数据体"></a>发送post请求的数据体</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d<span class="string">'login=emma＆password=123'</span>-X POST <span class="string">https:</span><span class="comment">//google.com/login</span></span><br></pre></td></tr></table></figure><p>使用<code>-d</code>参数以后，HTTP 请求会自动加上标头 <code>Content-Type : application/x-www-form-urlencoded</code></p><h3 id="上传二进制文件"><a href="#上传二进制文件" class="headerlink" title="上传二进制文件"></a>上传二进制文件</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -F <span class="string">'file=<span class="variable">@photo</span>.png;type=image/png'</span> www.sina.com</span><br></pre></td></tr></table></figure><p>上传的<code>photo.png</code> 文件， 上面命令会给 <code>HTTP</code> 请求加上标头<code>Content-Type: multipart/form-data</code></p><h3 id="限制http请求与响应的带宽，模拟慢网。"><a href="#限制http请求与响应的带宽，模拟慢网。" class="headerlink" title="限制http请求与响应的带宽，模拟慢网。"></a>限制http请求与响应的带宽，模拟慢网。</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">curl</span> <span class="selector-tag">--limit-rate</span> 200<span class="selector-tag">k</span> <span class="selector-tag">www</span><span class="selector-class">.baidu</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>上面命令将带宽限制在每秒 200K 字节。</p><p>其实有了这个，完全就可以在命令行模拟请求发送了，不需要postman了。~~~</p><p>更多参考：<br><a href="https://catonmat.net/cookbooks/curl" target="_blank" rel="noopener">curl cookbook</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;cURL是一个利用URL语法在命令行下工作的文件传输工具，1997年首次发行。它支持文件上传和下载，所以是综合传输工具，但按传统，习惯称cU
      
    
    </summary>
    
    
      <category term="curl" scheme="https://akijiangrou.github.io/tags/curl/"/>
    
      <category term="http" scheme="https://akijiangrou.github.io/tags/http/"/>
    
      <category term="command line" scheme="https://akijiangrou.github.io/tags/command-line/"/>
    
  </entry>
  
  <entry>
    <title>vue-cli3之部分配置</title>
    <link href="https://akijiangrou.github.io/2019/11/10/vue-cli3%E4%B9%8B%E9%83%A8%E5%88%86%E9%85%8D%E7%BD%AE/"/>
    <id>https://akijiangrou.github.io/2019/11/10/vue-cli3之部分配置/</id>
    <published>2019-11-10T12:29:07.000Z</published>
    <updated>2019-11-15T12:06:14.670Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近开始弄<code>vue</code>了，通过<code>vue-cli3</code> 我们可以快速生成使用 <code>vue</code>的单页应用。但是<code>vue-cli3</code>将<code>babel</code>，<code>webpack</code>等配置信息都封装起来了，很多配置不知道怎么改了。 下面写一些有用的配置。</p></blockquote><h2 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h2>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  publicPath: <span class="string">'./'</span>, <span class="comment">// 基本路径</span></span><br><span class="line">  outputDir: <span class="string">'dist'</span>, <span class="comment">// 输出文件目录</span></span><br><span class="line">  lintOnSave: <span class="literal">false</span>, <span class="comment">// eslint-loader 是否在保存的时候检查</span></span><br><span class="line">  <span class="comment">// see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span></span><br><span class="line">  <span class="comment">// webpack配置</span></span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.use_analyzer) &#123;</span><br><span class="line">      config</span><br><span class="line">        .plugin(<span class="string">"webpack-bundle-analyzer"</span>)</span><br><span class="line">        .use(<span class="built_in">require</span>(<span class="string">"webpack-bundle-analyzer"</span>).BundleAnalyzerPlugin); <span class="comment">// 加个包分析的工具，可以这样写。</span></span><br><span class="line">    &#125;</span><br><span class="line">    config.module</span><br><span class="line">      .rule(<span class="string">'vue'</span>)</span><br><span class="line">      .use(<span class="string">'vue-loader'</span>)</span><br><span class="line">      .loader(<span class="string">'vue-loader'</span>)</span><br><span class="line">      .tap(<span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 修改一些loader</span></span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  configureWebpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment">// 为生产环境修改配置...</span></span><br><span class="line">      config.mode = <span class="string">'production'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 为开发环境修改配置...</span></span><br><span class="line">      config.mode = <span class="string">'development'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">      <span class="comment">// 开发生产共同配置</span></span><br><span class="line">      resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">          <span class="string">'@'</span>: path.resolve(__dirname, <span class="string">'./src'</span>),</span><br><span class="line">          <span class="string">'@c'</span>: path.resolve(__dirname, <span class="string">'./src/components'</span>),</span><br><span class="line">          <span class="string">'@p'</span>: path.resolve(__dirname, <span class="string">'./src/pages'</span>)</span><br><span class="line">        &#125; <span class="comment">// 别名配置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  productionSourceMap: <span class="literal">false</span>, <span class="comment">// 生产环境是否生成 sourceMap 文件</span></span><br><span class="line">  <span class="comment">// css相关配置</span></span><br><span class="line">  css: &#123;</span><br><span class="line">    extract: <span class="literal">true</span>, <span class="comment">// 是否使用css分离插件 ExtractTextPlugin</span></span><br><span class="line">    sourceMap: <span class="literal">false</span>, <span class="comment">// 开启 CSS source maps?</span></span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      css: &#123;&#125;, <span class="comment">// 这里的选项会传递给 css-loader</span></span><br><span class="line">      postcss: &#123;&#125; <span class="comment">// 这里的选项会传递给 postcss-loader</span></span><br><span class="line">    &#125;, <span class="comment">// css预设器配置项 详见https://cli.vuejs.org/zh/config/#css-loaderoptions</span></span><br><span class="line">    modules: <span class="literal">false</span> <span class="comment">// 启用 CSS modules for all css / pre-processor files.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  pwa: &#123;&#125;, <span class="comment">// PWA 插件相关配置 see https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa</span></span><br><span class="line">  <span class="comment">// webpack-dev-server 相关配置</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    open: process.platform === <span class="string">'darwin'</span>,</span><br><span class="line">    host: <span class="string">'0.0.0.0'</span>, <span class="comment">// 允许外部ip访问</span></span><br><span class="line">    port: <span class="number">8022</span>, <span class="comment">// 端口</span></span><br><span class="line">    https: <span class="literal">false</span>, <span class="comment">// 启用https</span></span><br><span class="line">    overlay: &#123;</span><br><span class="line">      warnings: <span class="literal">true</span>,</span><br><span class="line">      errors: <span class="literal">true</span></span><br><span class="line">    &#125;, <span class="comment">// 错误、警告在页面弹出</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第三方插件配置</span></span><br><span class="line">  pluginOptions: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="关于开发环境的代理"><a href="#关于开发环境的代理" class="headerlink" title="关于开发环境的代理"></a>关于开发环境的代理</h3>  <figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">//</span> vue.config.js</span><br><span class="line"></span><br><span class="line">const path = require<span class="params">('path')</span>;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  <span class="string">//</span> other config;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">//</span> 假设请求地址：https:<span class="string">//www.jianshu.com/shakespeare/v2/notes/3529d2d1e2f9/book</span>。</span><br><span class="line">      <span class="string">//</span> 当我们在本地请求：localhost<span class="function">:8022</span>/testJianshu/3529d2d1e2f9/book 的时候，就会映射到 https:<span class="string">//www.jianshu.com/shakespeare/v2/notes/3529d2d1e2f9/book</span> </span><br><span class="line">      '<span class="string">/testJianshu</span>': &#123;</span><br><span class="line">        target: 'https:<span class="string">//www.jianshu.com</span>',</span><br><span class="line">        changeOrigin: <span class="literal">true</span>, <span class="string">//</span> 允许跨域请求</span><br><span class="line">        <span class="string">//</span> ws: <span class="literal">true</span>, <span class="string">//</span> 是否代理websockets</span><br><span class="line">        <span class="string">//</span> secure: <span class="literal">false</span>, <span class="string">//</span> 是否验证SSL Certs</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          '^<span class="string">/testJianshu</span>': '<span class="string">/shakespeare/v2/notes/</span>'</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="string">//</span> 代理转发配置，用于调试环境</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>关于上面的代理测试，我们随便在一个vue文件中，使用如下请求，即可验证：</p>  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  axios.<span class="keyword">get</span>(<span class="string">'/testJianshu/3529d2d1e2f9/book'</span>).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">'-----'</span>);</span><br><span class="line">    console.log(res.data); // 输出&#123;"notebook_id":<span class="number">25529189</span>,"notebook_name":"【前端】工程化","liked_by_user":<span class="keyword">false</span>&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="关于less全局变量的配置"><a href="#关于less全局变量的配置" class="headerlink" title="关于less全局变量的配置"></a>关于less全局变量的配置</h3><p>比如我们写了个less插件，想快速改变主题颜色，可以采用globalVars来实现</p>  <figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for： theme.js</span></span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  <span class="string">"@button-primary-bg-color"</span>: <span class="string">"yellow"</span>,</span><br><span class="line">  <span class="string">"@label-primary-color"</span>: <span class="string">"black"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  <span class="comment">// other config;</span></span><br><span class="line"><span class="symbol">  css:</span> &#123;</span><br><span class="line"><span class="symbol">    extract:</span> true, <span class="comment">// 是否使用css分离插件 ExtractTextPlugin</span></span><br><span class="line"><span class="symbol">    sourceMap:</span> false, <span class="comment">// 开启 CSS source maps</span></span><br><span class="line"><span class="symbol">    loaderOptions:</span> &#123;</span><br><span class="line"><span class="symbol">      less:</span> &#123;</span><br><span class="line"><span class="symbol">        modifyVars:</span> themeObj, <span class="comment">// 这里在theme.js文件中配置全局变量，这样会把主题颜色打包在项目中。</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生产环境去掉console-log"><a href="#生产环境去掉console-log" class="headerlink" title="生产环境去掉console.log"></a>生产环境去掉console.log</h3>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...</span><br><span class="line"> configureWebpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment">// 为生产环境修改配置...</span></span><br><span class="line">      config.mode = <span class="string">'production'</span></span><br><span class="line">      <span class="comment">// 将每个依赖包打包成单独的js文件</span></span><br><span class="line">      <span class="keyword">let</span> optimization = &#123;</span><br><span class="line">        ...</span><br><span class="line">        minimizer: [<span class="keyword">new</span> UglifyPlugin(&#123;</span><br><span class="line">          uglifyOptions: &#123;</span><br><span class="line">            compress: &#123;</span><br><span class="line">              warnings: <span class="literal">false</span>,</span><br><span class="line">              drop_console: <span class="literal">true</span>, <span class="comment">// console</span></span><br><span class="line">              drop_debugger: <span class="literal">false</span>,</span><br><span class="line">              pure_funcs: [<span class="string">'console.log'</span>] <span class="comment">// 移除console</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">        optimization</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 为开发环境修改配置...</span></span><br><span class="line">      config.mode = <span class="string">'development'</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="postcss-config-js"><a href="#postcss-config-js" class="headerlink" title="postcss.config.js"></a>postcss.config.js</h3><p>当我们在移动端，想完全适应屏幕，我们可以使用<code>postcss-px-to-viewport</code>插件，进行px到viewport的自动转换。转换后，会发现所有px都变为vw or vh。<br>我们可以如下配置：</p>  <figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line"><span class="symbol">  plugins:</span> &#123;</span><br><span class="line"><span class="symbol">    autoprefixer:</span> &#123;&#125;,</span><br><span class="line">    <span class="string">"postcss-px-to-viewport"</span>: &#123;</span><br><span class="line"><span class="symbol">      viewportWidth:</span> <span class="number">750</span>, <span class="comment">// 视窗的宽度，对应的是我们设计稿的宽度，一般是750</span></span><br><span class="line"><span class="symbol">      viewportHeight:</span> <span class="number">1334</span>, <span class="comment">// 视窗的高度，根据750设备的宽度来指定，一般指定1334，也可以不配置</span></span><br><span class="line"><span class="symbol">      unitPrecision:</span> <span class="number">4</span>, <span class="comment">// 指定`px`转换为视窗单位值的小数位数（很多时候无法整除）</span></span><br><span class="line"><span class="symbol">      viewportUnit:</span> <span class="string">"vw"</span>, <span class="comment">// 指定需要转换成的视窗单位，建议使用vw</span></span><br><span class="line"><span class="symbol">      exclude:</span> [/node_modules/, /src\<span class="meta-keyword">/components/</span>], <span class="comment">// 排除无需编译的文件夹</span></span><br><span class="line"><span class="symbol">      selectorBlackList:</span> [<span class="string">".ignore"</span>, <span class="string">".hairlines"</span>], <span class="comment">// 指定不转换为视窗单位的类，可以自定义，可以无限添加,建议定义一至两个通用的类名</span></span><br><span class="line"><span class="symbol">      minPixelValue:</span> <span class="number">1</span>, <span class="comment">// 小于或等于`1px`不转换为视窗单位，你也可以设置为你想要的值</span></span><br><span class="line"><span class="symbol">      mediaQuery:</span> false <span class="comment">// 允许在媒体查询中转换`px`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 不支持vw，vh的浏览器要加这个插件，进行兼容</span></span><br><span class="line">    <span class="string">"postcss-viewport-units"</span>: &#123;</span><br><span class="line">      <span class="comment">// 处理工具伪类和项目样式伪类的冲突问题</span></span><br><span class="line"><span class="symbol">      filterRule:</span> rule =&gt;</span><br><span class="line">        rule.selector.indexOf(<span class="string">"::after"</span>) === <span class="number">-1</span> &amp;&amp;</span><br><span class="line">        rule.selector.indexOf(<span class="string">"::before"</span>) === <span class="number">-1</span> &amp;&amp;</span><br><span class="line">        rule.selector.indexOf(<span class="string">":after"</span>) === <span class="number">-1</span> &amp;&amp;</span><br><span class="line">        rule.selector.indexOf(<span class="string">":before"</span>) === <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="关于babel-配置。"><a href="#关于babel-配置。" class="headerlink" title="关于babel 配置。"></a>关于babel 配置。</h3><p>如果有一些自己写的组件，或者没有转为es5 的组件，需要babel-loader进行转换。可以在webpack中加入：</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attribute">transpileDependencies</span>: ["cccc"],  // 通过 Babel 显式转译一个依赖，可以在这个选项中列出来。</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">// 或者：</span><br><span class="line">const path = require('path');</span><br><span class="line"></span><br><span class="line">function resolve(dir) &#123;</span><br><span class="line">  return path.join(__dirname, '.', dir);</span><br><span class="line">&#125;</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  ... // 其他配置</span><br><span class="line">  chainWebpack: config =&gt; &#123;</span><br><span class="line">    config.module.rule('compile')</span><br><span class="line">      .test(/\.js$/)</span><br><span class="line">      .include</span><br><span class="line">      .add(resolve('src'))</span><br><span class="line">      .add(resolve('node_modules/webpack-dev-server/client'))</span><br><span class="line">      .add(resolve('node_modules/cccc'))</span><br><span class="line">      .end()</span><br><span class="line">      .use('babel')</span><br><span class="line">      .loader('babel-loader')</span><br><span class="line">      .options(&#123;</span><br><span class="line">        presets: [</span><br><span class="line">          ['@babel/preset-env', &#123;</span><br><span class="line">            modules: false</span><br><span class="line">          &#125;]</span><br><span class="line">        ]</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 如上配置，会在整个loader后面加一个叫compile的loader</span><br></pre></td></tr></table></figure><p>关于babel 配置，vue-cli3 已经进行了很多封装。</p><p>写一些总结性的内容：<br>vue-cli3 封装的babel，其中</p><p>关于封装的@babel/preset-env，配置如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">useBuiltIns:</span> <span class="string">'usage'</span>;</span><br><span class="line"><span class="string">corejs:</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>@babel/preset-env 中依赖的core-js的版本为： <code>&quot;core-js&quot;: &quot;^2.6.5&quot;</code>，我查看了下我们的工程，core-js版本是2.6.9。来个题外话：</p><p>查看npm 库中，当前插件的版本：  </p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">view</span> core-js <span class="keyword">version</span>  <span class="comment">// 只看版本</span></span><br><span class="line">npm info core-js  <span class="comment">// 查看更多详细信息</span></span><br></pre></td></tr></table></figure><p>但是想查看本地安装的core-js版本，使用：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> ls core-js</span><br></pre></td></tr></table></figure><p>那么对于2.6.9都支持了哪些语法呢？也就是我们可以在vue-cli3工程中使用哪些es6，7的语法呢？参考2.6.9的<a href="https://github.com/zloirock/core-js/tree/v2.6.9" target="_blank" rel="noopener">readme</a>。</p><p>简单说一下：async，await，Object.assign，Set，Map，reflaction等等。</p><p>关于解释vue-cli3中的babel配置，以及相对于es678兼容性的问题，查看：<a href="https://segmentfault.com/a/1190000020392040?utm_source=tag-newest" target="_blank" rel="noopener">链接</a><br>这里写的很明白</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;最近开始弄&lt;code&gt;vue&lt;/code&gt;了，通过&lt;code&gt;vue-cli3&lt;/code&gt; 我们可以快速生成使用 &lt;code&gt;vue&lt;/code&gt;的单页应用。但是&lt;code&gt;vue-cli3&lt;/code&gt;将&lt;code&gt;babel&lt;/code&gt;，&lt;
      
    
    </summary>
    
    
      <category term="vuewebpack" scheme="https://akijiangrou.github.io/tags/vuewebpack/"/>
    
      <category term="vue-cli3" scheme="https://akijiangrou.github.io/tags/vue-cli3/"/>
    
      <category term="config" scheme="https://akijiangrou.github.io/tags/config/"/>
    
  </entry>
  
  <entry>
    <title>React滚动吸顶最佳实践</title>
    <link href="https://akijiangrou.github.io/2019/04/25/React%E6%BB%9A%E5%8A%A8%E5%90%B8%E9%A1%B6%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
    <id>https://akijiangrou.github.io/2019/04/25/React滚动吸顶最佳实践/</id>
    <published>2019-04-25T03:43:04.000Z</published>
    <updated>2019-05-09T12:59:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>普通的模块吸顶实现思路，就是clone一个滚动的元素，当元素快要滚出视口的时候，将clone的元素fix到顶部或者某个位置。<br>那么对于react组件，就可以使用两个同样组件，也是监听滚动事件，控制第二个组件的显示与否。例子如下</p><p>### </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;普通的模块吸顶实现思路，就是clone一个滚动的元素，当元素快要滚出视口的时候，将clone的元素fix到顶部或者某个位置。&lt;br&gt;那么对于
      
    
    </summary>
    
    
      <category term="React 滚动吸顶" scheme="https://akijiangrou.github.io/tags/React-%E6%BB%9A%E5%8A%A8%E5%90%B8%E9%A1%B6/"/>
    
  </entry>
  
  <entry>
    <title>经典欧洲行</title>
    <link href="https://akijiangrou.github.io/2018/10/12/%E7%BB%8F%E5%85%B8%E6%AC%A7%E6%B4%B2%E8%A1%8C/"/>
    <id>https://akijiangrou.github.io/2018/10/12/经典欧洲行/</id>
    <published>2018-10-12T03:41:15.000Z</published>
    <updated>2018-10-12T03:51:46.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="巴黎"><a href="#巴黎" class="headerlink" title="巴黎"></a>巴黎</h1><ul><li>酒店：铂尔曼巴黎埃菲尔酒店(铁塔旁边，很惬意，早餐非常棒)</li><li><p>景点：</p></li><li><p>第一天</p><ul><li><code>埃菲尔铁塔</code>  </li><li><code>凯旋门</code></li><li><code>香榭丽舍大街</code></li><li><code>协和广场</code></li><li><code>亚历山大三十桥</code> </li><li><code>巴黎歌剧院</code></li></ul></li><li><p>第二天</p><ul><li><code>卢浮宫</code></li><li><code>奥赛美术馆</code></li><li><code>巴黎圣母院</code></li><li><code>圣礼拜堂</code></li><li><code>化身咖啡馆</code></li><li><code>先贤寺</code>  名人堂</li></ul></li></ul><p>地图：<br><img src="./23141340zamz.jpg"></p><p>图片：<br><img src="./屏幕快照 2018-08-21 13.43.02.png"></p><hr><h1 id="因特拉肯"><a href="#因特拉肯" class="headerlink" title="因特拉肯"></a>因特拉肯</h1><ul><li>酒店：因特拉肯城市酒店（直接远眺少女峰，非常棒）</li><li>景点：闲逛就好</li></ul><h1 id="琉森（卢塞恩）"><a href="#琉森（卢塞恩）" class="headerlink" title="琉森（卢塞恩）"></a>琉森（卢塞恩）</h1><ul><li>景点：<ul><li>琉森湖</li><li>奢侈表一条街</li><li>垂死狮子</li><li>廊桥</li></ul></li></ul><hr><h1 id="佛罗伦萨"><a href="#佛罗伦萨" class="headerlink" title="佛罗伦萨"></a>佛罗伦萨</h1><ul><li>景点：<ul><li>百花大教堂</li><li>领主广场</li><li>维琪奥桥</li><li>米开朗叽萝广场 (最好傍晚，太晒了)</li></ul></li></ul><p><img src="./屏幕快照 2018-08-21 14.09.25.png">  </p><h1 id="米兰"><a href="#米兰" class="headerlink" title="米兰"></a>米兰</h1><ul><li>米兰大教堂</li><li>埃马努埃莱二世长廊</li></ul><h1 id="比萨"><a href="#比萨" class="headerlink" title="比萨"></a>比萨</h1><ul><li>比萨斜塔</li></ul><h1 id="威尼斯"><a href="#威尼斯" class="headerlink" title="威尼斯"></a>威尼斯</h1><ul><li>里亚托桥</li><li>叹息桥</li><li>玻璃岛</li></ul><p><img src="./屏幕快照 2018-08-21 15.11.15.png"></p><h1 id="罗马"><a href="#罗马" class="headerlink" title="罗马"></a>罗马</h1><ul><li>酒店：萨伏伊酒店（很古老的感觉，与前两个稍逊色）</li><li>景点：<ul><li>梵蒂冈</li><li>古罗马斗兽场</li><li>西班牙广场</li><li>少女喷泉</li></ul></li></ul><p><img src="./屏幕快照 2018-10-12 11.45.31.png"></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;巴黎&quot;&gt;&lt;a href=&quot;#巴黎&quot; class=&quot;headerlink&quot; title=&quot;巴黎&quot;&gt;&lt;/a&gt;巴黎&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;酒店：铂尔曼巴黎埃菲尔酒店(铁塔旁边，很惬意，早餐非常棒)&lt;/li&gt;
&lt;li&gt;&lt;p&gt;景点：&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第
      
    
    </summary>
    
    
      <category term="旅游攻略" scheme="https://akijiangrou.github.io/tags/%E6%97%85%E6%B8%B8%E6%94%BB%E7%95%A5/"/>
    
      <category term="欧洲" scheme="https://akijiangrou.github.io/tags/%E6%AC%A7%E6%B4%B2/"/>
    
  </entry>
  
  <entry>
    <title>基础知识查缺补漏-数据类型</title>
    <link href="https://akijiangrou.github.io/2018/01/04/%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/"/>
    <id>https://akijiangrou.github.io/2018/01/04/查缺补漏/</id>
    <published>2018-01-04T07:24:57.000Z</published>
    <updated>2018-01-04T08:04:55.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><ul><li>数组delete元素后，length不变。  </li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">delete a[<span class="number">1</span>] </span><br><span class="line">a; <span class="comment">// [1, empty, 3, 4, 5]</span></span><br><span class="line">a.length;  <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><ul><li>数组也可以加入键值，不过不计入长度，如果键值能够强制转化成十进制数字，则会当做数字索引来用。</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = [];</span><br><span class="line">b[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">b[<span class="string">'foo'</span>] = <span class="number">2</span>;</span><br><span class="line">b.length;  <span class="comment">// 1</span></span><br><span class="line">b.foo;     <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">b[<span class="string">'5'</span>] = <span class="number">5</span>;</span><br><span class="line">b.length;   <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><p>字符串和字符数组很像 ~~<br>差别：字符串不可变，字符数组是可变的。  </p><ul><li>可以用数组方法来处理字符串  </li></ul><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="string">'abcdefg'</span>;</span><br><span class="line"></span><br><span class="line">a.<span class="built_in">join</span>;  <span class="comment">// undefined;</span></span><br><span class="line">a.<span class="built_in">map</span>;   <span class="comment">// undefined;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">Array</span>.prototype.<span class="built_in">join</span>.call(a, <span class="string">'-'</span>);</span><br><span class="line">b;  <span class="comment">// "a-b-c-d-e-f-g"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">Array</span>.prototype.<span class="built_in">map</span>.call(a, v =&gt; v.toUpperCase() + <span class="string">','</span>).<span class="built_in">join</span>(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">c;  <span class="comment">// "A.B.C.D.E.F.G."   注意join，如果没有其实就是普通的字符串数组了。</span></span><br></pre></td></tr></table></figure><ul><li>部分数组函数，字符串不能用，比如reverse。<br>例子：实现字符串反转</li></ul><p>需要先将字符串打散成数组，然后操作。  </p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reverseStr = arr =&gt; arr.<span class="built_in">split</span>(<span class="string">""</span>).<span class="built_in">reverse</span>().<span class="built_in">join</span>(<span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>如果需要经常以字符数组的方式来处理字符串的话，倒不如直接使用数组，最后用join(“”)转换成字符串。  </p><h1 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h1><ul><li>指定有效数位显示位数 toPrecision(..)   都转化成相应位数的字符串  </li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const a = <span class="number">43.68</span>;</span><br><span class="line">a.<span class="keyword">to</span><span class="constructor">Precision(1)</span>   <span class="comment">// "4e+1"</span></span><br><span class="line">a.<span class="keyword">to</span><span class="constructor">Precision(2)</span>   <span class="comment">// "43"</span></span><br><span class="line">a.<span class="keyword">to</span><span class="constructor">Precision(3)</span>   <span class="comment">// "43.7"</span></span><br><span class="line">a.<span class="keyword">to</span><span class="constructor">Precision(5)</span>   <span class="comment">// "43.680"</span></span><br></pre></td></tr></table></figure><p>注意：如果用数字直接调用toFixed，toPrecision 等都要用（）抱起来，因为<code>.</code>会被认为是数字的一部分。</p><ul><li>二进制八进制表示法<br>0b11110011   //243<br>0o363        // 243</li></ul><p>最好用小写的  0[zero]b  或者  0o来表示。虽然大写也行，但是容易混淆</p><ul><li>较小数值比较<br>0.1 + 0.2 === 0.3    // 输出是false  </li></ul><p>二进制浮点数中的 0.1 和 0.2 并不是十分精确，它们相加的结果并非刚好等于 0.3，而是一个比较接近的数字 0.30000000000000004  </p><p>解决方法：设置一个误差范围值，机器精度2^-52, ES6中已经规定了这个常数，Number.EPSILON;</p><p> 自己写的判断：  </p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> numberClose = <span class="function">(<span class="params">s1,s2</span>) =&gt;</span> <span class="built_in">Math</span>.abs(s1-s2) &lt; <span class="built_in">Number</span>.EPSILON;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test </span></span><br><span class="line"> <span class="keyword">const</span> a = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line"> <span class="keyword">const</span> b = <span class="number">0.3</span>;</span><br><span class="line"> numberClose(a, b);  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li><p>整数的安全范围<br>2^53 - 1  9007199254740991   ES6：Number.MAX_SAFE_INTEGER<br>最小：-9007199254740991   定义为： Number. MIN_SAFE_INTEGER</p><p>检测整数：  </p></li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Number</span>.</span></span>is<span class="constructor">Integer(43)</span>  <span class="comment">// true</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Number</span>.</span></span>is<span class="constructor">Integer(43.0)</span>  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>  检测是否是安全的整数<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Number</span>.</span></span>is<span class="constructor">SafeInteger( Number.MAX_SAFE_INTEGER )</span>;  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><ul><li>特殊数值<br>NaN 是唯一一个不等于自身的值。  </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> === <span class="literal">null</span>  <span class="comment">// true</span></span><br><span class="line"><span class="literal">undefined</span> === <span class="literal">undefined</span>  <span class="comment">// true</span></span><br><span class="line"><span class="literal">NaN</span> === <span class="literal">NaN</span>  <span class="comment">// false</span></span><br><span class="line"><span class="literal">Infinity</span> === <span class="literal">Infinity</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 语义上，判断一个数字是否是 NaN， 第一种，显然不对，因为他并不是 NaN。</span></span><br><span class="line"><span class="built_in">window</span>.isNaN(<span class="string">'abc'</span>)  <span class="comment">// true  </span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">'abc'</span>)  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="literal">Infinity</span>  <span class="comment">// 1/0</span></span><br><span class="line"><span class="literal">Infinity</span>/<span class="literal">Infinity</span>  <span class="comment">//  NaN</span></span><br></pre></td></tr></table></figure><p>  注意：如果计算结果溢出，则为无穷数，而且无法再回到有穷数了。</p><ul><li>0 &amp; -0<br>有些奇怪：<br>[1] 这两个值相等<br>[2] 没有大小之分<br>[3] 数字转换成string的时候，只会是’0’，但是parse回数字的时候，可以转换成 -0 </li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">-0</span>;</span><br><span class="line"></span><br><span class="line">a === b;  <span class="comment">// true</span></span><br><span class="line">a &gt; b;    <span class="comment">// false</span></span><br><span class="line">JSON.<span class="built_in">string</span>ify(b)   <span class="comment">// "0"</span></span><br><span class="line">JSON.parse(<span class="string">'-0'</span>)    <span class="comment">// -0</span></span><br></pre></td></tr></table></figure><p> 如果判断 -0 怎么弄呢？通过 1/-0 等于 -Inifinity 来实现。  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNegZero</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> n = <span class="built_in">Number</span>(num);</span><br><span class="line">  <span class="keyword">return</span> n=== <span class="number">0</span> &amp;&amp; <span class="number">1</span>/n === -<span class="literal">Infinity</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ES6 中用<code>Object.is()</code> 可以实现 负零判断，NaN判断    </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span> / <span class="string">"foo"</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">-0</span>;</span><br><span class="line"></span><br><span class="line">Object.<span class="keyword">is</span>(a, NaN);   <span class="comment">// true</span></span><br><span class="line">Object.<span class="keyword">is</span>(b, <span class="number">-0</span>);    <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">Object.<span class="keyword">is</span>(b, <span class="number">0</span>);     <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>能用 <code>==</code> &amp; <code>===</code> 就不要用Object.is() 效率比较低，有特殊的相等比较的时候再用。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;数组&quot;&gt;&lt;a href=&quot;#数组&quot; class=&quot;headerlink&quot; title=&quot;数组&quot;&gt;&lt;/a&gt;数组&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;数组delete元素后，length不变。  &lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight ange
      
    
    </summary>
    
    
      <category term="javascript" scheme="https://akijiangrou.github.io/tags/javascript/"/>
    
      <category term="基础类型" scheme="https://akijiangrou.github.io/tags/%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>CSS-grid</title>
    <link href="https://akijiangrou.github.io/2017/12/06/CSS-grid/"/>
    <id>https://akijiangrou.github.io/2017/12/06/CSS-grid/</id>
    <published>2017-12-06T08:28:23.000Z</published>
    <updated>2017-12-07T02:42:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>grid布局的思想就是，先将一个container 设置上<code>display:grid;</code> ,然后使用<code>grid-template-columns:</code> &amp; <code>grid-template-rows</code> 将这个div划分为多个小格子。然后使用<code>grid-column</code> &amp; <code>grid-row</code>将子元素放置在一个或者多个小格子中。</p><p>代码实现。  </p><p></p><p data-height="438" data-theme-id="0" data-slug-hash="ooOLje" data-default-tab="html,result" data-user="akixiao" data-embed-version="2" data-pen-title="grid-start" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/ooOLje/" target="_blank" rel="noopener">grid-start</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p>css：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>:grid;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">600px</span>;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">100px</span> <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">grid-gap</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grid-item</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.last-item</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column-start</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">grid-column-end</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<strong>container</strong>中：<br><code>display:grid;</code>声明这个container是采用grid布局的。 </p><p><code>grid-template-XXX</code>设置了这个div的网格式布局的基本。  </p><p>在<strong>item</strong>中：<br><code>grid-column-xxx</code>设置了这个div在grid中所占有的布局。  </p><p>grid布局中新增了一些知识，下面就利用这个例子来分别解释gird布局中的一些基本术语。</p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><blockquote><h3 id="grid容器（grid-container）"><a href="#grid容器（grid-container）" class="headerlink" title="grid容器（grid container）"></a>grid容器（grid container）</h3></blockquote><p>设置了<code>display:gird|inline-grid|subgrid</code>的元素，被称为<code>grid container</code>。他是所有网格项目<code>grid item</code>的直接父元素。  如上面的<code>div.container</code></p><blockquote><h3 id="grid项目（grid-item"><a href="#grid项目（grid-item" class="headerlink" title="grid项目（grid item)"></a>grid项目（grid item)</h3></blockquote><p><code>grid container</code>的子元素被称为grid item。如上面的<code>div.grid-item</code></p><blockquote><h3 id="网格线-（grid-lines）"><a href="#网格线-（grid-lines）" class="headerlink" title="网格线 （grid lines）"></a>网格线 （grid lines）</h3></blockquote><p>网格线是水平和垂直方向来分割空间的线。水平方向的网格线是从左向右；垂直方向是从上往下。编号都是从<code>1</code>开始的。<code>grid</code>布局就是通过grid lines进行元素的布局的。通过grid-template等属性设置网格线。如果是负值，是从右往左方向。</p><p><img src="./gridline.png"></p><p>按照最上面的例子，<code>grid-template-columns: 1fr 1fr 1fr;  grid-template-rows: 100px 200px;</code><br>将空间分成了6个部分，水平方向3个格子，垂直方向2个格子。<br>相应的，gridline如上，有7条。三条紫色虚线为 <code>row grid lines</code> 。四条蓝色垂直虚线为<code>column grid lines</code>。  这七条线划分出了该grid的6个子空间，之后可以根据网格线号码定位网格项目。 网格线还可在定义轨道的时候，进行命名。 详见<code>[grid-template]</code>  </p><blockquote><h3 id="网格轨道（grid-track）"><a href="#网格轨道（grid-track）" class="headerlink" title="网格轨道（grid track）"></a>网格轨道（grid track）</h3></blockquote><p>两条邻近grid line之间的空间就是grid track。通过grid-template设置。  </p><p><img src="./gridtrack.png"><br>其中半透明橘黄色就是一个grid track。</p><blockquote><h3 id="grid-cell"><a href="#grid-cell" class="headerlink" title="grid cell"></a>grid cell</h3></blockquote><p>两条邻近的<code>row grid line</code> 和两条邻近的<code>column grid line</code> 之间的空间。是grid布局的基础单元。所有的布局都可以通过选择不同范围的grid cell 来实现。如下面的蓝色方块。</p><p><img src="./gridcell.png"></p><blockquote><h3 id="grid-area"><a href="#grid-area" class="headerlink" title="grid area"></a>grid area</h3></blockquote><p>任意四条线间的空间，被称为grid area，由多个grid组成。如下绿色部分，如果用css表示该部分应该是。<br><code>grid-row: 2/4</code><br><code>grid-column: 1/3</code></p><p>或者</p><p><code>grid-row: -3/-1</code><br><code>grid-column: -3/-1</code></p><p><img src="./gridline的副本.png"></p><blockquote><h3 id="gutters"><a href="#gutters" class="headerlink" title="gutters"></a>gutters</h3></blockquote><p>tracks 之间的间隔，如例子中的深灰色的部分。<br>可以通过<br><code>grid-column-gap, grid-row-gap, or grid-gap</code>来设置。  </p><h2 id="grid-container"><a href="#grid-container" class="headerlink" title="grid container"></a>grid container</h2><blockquote><h3 id="display"><a href="#display" class="headerlink" title="display"></a>display</h3></blockquote><p><strong>【display:grid|inline-grid|subgrid】</strong><br>第三个是指，当grid container 本身是一个grid item，也可以通过设置这个属性，进一步对该item进行网格式布局。  </p><p>声明这个container是grid形式的。因此在块容器中的一些属性使用并不适用于网格容器当中:</p><ul><li>多列布局属性column-*不能用于网格容器</li><li>float ，clear, vertical-align 都不生效</li><li>::first-line和::first-letter伪元素不能用于网格容器  </li></ul><p>grid containe的可用css属性如下：</p><blockquote><h3 id="grid-template"><a href="#grid-template" class="headerlink" title="grid-template"></a>grid-template</h3></blockquote><p>是<code>grid-template-row</code> and <code>grid-template-column</code> 的缩写。显示的设定网格的行和列。</p><h4 id="grid-template-column"><a href="#grid-template-column" class="headerlink" title="grid-template-column"></a><code>grid-template-column</code></h4><p><strong>【grid-template-column: [name] value …】</strong><br>每写一个value值，则定义了一个轨道宽度。  单位可以是<code>px</code> <code>em</code> <code>%</code> <code>fr</code>。 这里<code>fr</code>是一个新单位，代表可用空间的比例。一个例子如下：  </p><p></p><p data-height="265" data-theme-id="0" data-slug-hash="jaRRQL" data-default-tab="css,result" data-user="akixiao" data-embed-version="2" data-pen-title="grid-testone" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/jaRRQL/" target="_blank" rel="noopener">grid-testone</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p><code>grid-gap: 10px;</code><br><code>grid-template-columns: 50px repeat(2, 1fr) 2fr;</code></p><p>这里是在水平方向上分为4个部分，长度分别是 50px 1fr 1fr 2fr。 1fr是怎么计算呢，其实就是 <code>(width - 50 - 3*10) / 4</code>px。fr就不需要我们自己主动计算百分比了，他会自行计算。更准确。</p><p>代码<a href="https://codepen.io/akixiao/pen/jaRRQL" target="_blank" rel="noopener">https://codepen.io/akixiao/pen/jaRRQL</a></p><p><strong>repeat()</strong> 可以创建重复的网格轨道, 接受两个参数：第一个参数定义网格轨道应该重复的次数，第二个参数定义每个轨道的尺寸。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grid-template-columns: <span class="number">50</span>px repeat(<span class="number">3</span>, <span class="number">1f</span>r)</span><br></pre></td></tr></table></figure><p><strong>minmax()</strong> 网格轨道最大最小尺寸。<br>minmax()函数接受两个参数：第一个参数定义网格轨道的最小值，第二个参数定义网格轨道的最大值。可以接受任何长度值，也接受auto值。auto值允许网格轨道基于内容的尺寸拉伸或挤压。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grid-template-rows: minmax(<span class="number">100</span>px, <span class="built_in">auto</span>) <span class="number">50</span>px;</span><br><span class="line">grid-template-columns: minmax(<span class="built_in">auto</span>, <span class="number">25</span>%) <span class="number">50</span>px <span class="number">1f</span>r <span class="number">1f</span>r;</span><br></pre></td></tr></table></figure><p>这个就是意味着，第一行的高度最小为100px，可以超过，第二行高度为50px; 第一列的宽度最大为25%，可以根据其他列适当缩小值，其余列为定义的值。</p><p>实际例子：</p><p></p><p data-height="265" data-theme-id="0" data-slug-hash="pdBmZq" data-default-tab="css,result" data-user="akixiao" data-embed-version="2" data-pen-title="grid-test-minmax" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/pdBmZq/" target="_blank" rel="noopener">grid-test-minmax</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p>name代表什么呢？这里是指网格线名称。假如我写了如下的grid-template（这里copy了一下，偷懒了）</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.<span class="keyword">container</span> &#123;</span><br><span class="line">  grid-template-columns: <span class="comment">[first]</span> 40px <span class="comment">[line2]</span> 50px <span class="comment">[line3]</span> auto <span class="comment">[col4-start]</span> 50px <span class="comment">[five]</span> 40px <span class="comment">[end]</span>;</span><br><span class="line">  grid-template-rows: <span class="comment">[row1-start]</span> 25% <span class="comment">[row1-end]</span> 100px <span class="comment">[third-line]</span> auto <span class="comment">[last-line]</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./name-line.png" width="500px"></p><p>当我们在grid items中布局的时候，可以不用在写编号了，写name就可以了。例如：  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column</span>: first/line3;</span><br><span class="line">  <span class="attribute">grid-row</span>: row1-start/third-line;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上写法，这个item将占据 <code>width：90px;height: 25%*height + 100 px</code> 的空间，相当于左上角四个grid。  </p><p><a href="https://codepen.io/akixiao/pen/BmEgBV" target="_blank" rel="noopener">展示结果</a></p><h4 id="grid-template-row"><a href="#grid-template-row" class="headerlink" title="grid-template-row"></a><code>grid-template-row</code></h4><p><strong>【grid-template-row: [name] value …】</strong><br>先来说value，每写一个值，则定义了一个轨道高度。  单位可以是<code>px</code> <code>em</code> <code>%</code>。其余与column相似。  内容与grid-template-column相似，不多说了。  </p><h4 id="grid-template-areas"><a href="#grid-template-areas" class="headerlink" title="grid-template-areas"></a><code>grid-template-areas</code></h4><p><strong>【grid-template-areas: [name]|none|.】</strong><br>这个属性，就是将轨道分出来的每个grid 都赋予一个name，然后grid items 可以根据name来进行布局。不多说，上例子更明确  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>:grid;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">120px</span> auto;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">60px</span> <span class="number">1</span>fr <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">background</span>: gray;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>:</span><br><span class="line">    <span class="string">"sidebar header"</span></span><br><span class="line">    <span class="string">"sidebar content"</span></span><br><span class="line">    <span class="string">"sidebar footer"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: sidebar;</span><br><span class="line">  <span class="attribute">background</span>: purple;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: header;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: content;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: footer;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"sidebar"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"header"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"content"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"footer"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><p>结果图： <img src="./area.png"><br><a href="https://codepen.io/akixiao/pen/xPevXJ" target="_blank" rel="noopener">代码</a></p><p>关于简写的grid-template:  综合grid line，grid track，grid area。 </p>  <figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">grid</span>-template-<span class="built_in">columns</span>: 120px auto;</span><br><span class="line"><span class="built_in">grid</span>-template-rows:[<span class="built_in">row</span>-<span class="number">1</span>] 60px [<span class="built_in">row</span>-<span class="number">2</span>] auto [<span class="built_in">row</span>-<span class="number">3</span>] 60px [<span class="built_in">row</span>-<span class="number">4</span>];</span><br><span class="line"><span class="built_in">grid</span>-template-areas:</span><br><span class="line">  <span class="string">"sidebar header"</span></span><br><span class="line">  <span class="string">"sidebar content"</span></span><br><span class="line">  <span class="string">"sidebar footer"</span>;</span><br></pre></td></tr></table></figure><p>  等价于</p>  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grid-template: [row<span class="number">-1</span>] <span class="string">"sidebar header"</span> <span class="number">60</span>px</span><br><span class="line">               [row<span class="number">-2</span>] <span class="string">"sidebar content"</span> <span class="built_in">auto</span></span><br><span class="line">               [row<span class="number">-3</span>] <span class="string">"sidebar footer"</span> <span class="number">60</span>px [row<span class="number">-4</span>]</span><br><span class="line">              /  <span class="number">120</span>px <span class="built_in">auto</span>;</span><br></pre></td></tr></table></figure><blockquote><h3 id="grid-gap"><a href="#grid-gap" class="headerlink" title="grid-gap"></a>grid-gap</h3></blockquote><p>这个是，<code>grid-row-gap</code>和<code>grid-column-gap</code>的缩写。<br>创建的是轨道间的距离。如最开始的例子：  </p><p><code>grid-gap: 10px;</code><br>这个等价于：  </p><p><code>grid-row-gap: 10px</code><br><code>grid-column-gap: 10px</code></p><p>下面是grid 元素的对齐方式：  </p><blockquote><h3 id="justify-items"><a href="#justify-items" class="headerlink" title="justify-items"></a>justify-items</h3><h3 id="align-items"><a href="#align-items" class="headerlink" title="align-items"></a>align-items</h3></blockquote><p>这两个分别是指定网格项目沿着行轴的对齐方式，和沿着列轴的对齐方式。<br>可用的属性有：  解释都是以<code>justify-items</code>为例，<code>align-items</code>请自动转换为相对于纵轴来说。</p><ul><li>start: 内容居左排列</li><li>end: 内容居右排列</li><li>center: 内容居中排列</li><li>stretch: 默认值，横跨整个row 轴</li></ul><blockquote><h3 id="justify-contents"><a href="#justify-contents" class="headerlink" title="justify-contents"></a>justify-contents</h3><h3 id="align-contents"><a href="#align-contents" class="headerlink" title="align-contents"></a>align-contents</h3></blockquote><p>这两个是网格轨道的对齐方式，分别相对于<code>justify-contents</code>指定网格轨道沿着列轴的排列方式，其实就是row网格轨道在垂直方向上的排列情况。和<code>align-contents</code>网格轨道沿着row轴的排列方式，是column网格轨道在水平方向上的排列情况。<br>可用属性：  </p><ul><li>start：居左</li><li>end： 居右</li><li>center: 居中</li><li>strech： 拉伸</li><li>space-around：每个轨道两边距离相同</li><li>space-between：第一和最后的羽绒器边缘没有间距，其他轨道距离相同。</li><li>space-evenly：轨道距离容器边缘和轨道间的距离都相同。</li></ul><blockquote><h3 id="grid-auto"><a href="#grid-auto" class="headerlink" title="grid-auto"></a>grid-auto</h3><p><code>grid-template-columns</code>, <code>grid-template-rows</code>, <code>grid-template-areas</code> 可以定义显示的网格，给出确定的网格轨道宽高，和明确的grid数量。也可以使用<code>grid-auto-rows</code> 和 <code>grid-auto-columns</code>创建隐式网格。  </p></blockquote><p>隐式网格，当项目被放置在template未规定的grid时，就会生成隐式网格。如果是按照template摆放的内容，就算定义了隐式grid，隐式grid也不会出现在展示中。  </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;</span><br><span class="line">  display:grid;</span><br><span class="line">  height: <span class="number">400</span>px;</span><br><span class="line">  display: grid; </span><br><span class="line">  grid-template-columns: <span class="number">100</span>px;</span><br><span class="line">  grid-<span class="built_in">auto</span>-columns: <span class="number">200</span>px;</span><br><span class="line">  grid-template-rows: <span class="number">100</span>px;</span><br><span class="line">  grid-<span class="built_in">auto</span>-rows: <span class="number">200</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.first &#123;</span><br><span class="line">  grid-column: <span class="number">1</span>;</span><br><span class="line">  grid-row: <span class="number">1</span>;</span><br><span class="line">  background: lightblue;</span><br><span class="line">&#125;</span><br><span class="line">.second &#123;</span><br><span class="line">  background: orange;</span><br><span class="line">&#125;</span><br><span class="line">.third &#123;</span><br><span class="line">  background: pink;</span><br><span class="line">&#125;</span><br><span class="line">.forth &#123;</span><br><span class="line">  background: tomato;</span><br><span class="line">  grid-row: <span class="number">2</span>;</span><br><span class="line">  grid-column:<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="keyword">class</span>="<span class="symbol">container</span>"&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span> <span class="symbol">class</span>="<span class="symbol">first</span>"&gt;<span class="symbol">1</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span> <span class="symbol">class</span>="<span class="symbol">second</span>"&gt;<span class="symbol">2</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span> <span class="symbol">class</span>="<span class="symbol">third</span>"&gt;<span class="symbol">3</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span> <span class="symbol">class</span>="<span class="symbol">forth</span>"&gt;<span class="symbol">4</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">&lt;/<span class="symbol">div</span>&gt;</span><br></pre></td></tr></table></figure><p>上面只显示定义了一个columns和rows。 如果不规定forth中的样式，则默认向1下方添加高度为200px，宽度为100px的div。如果在forth中设置了不存在的cell，则container会生成隐式grid，其他的div会根据顺序以添加了隐式grid进行排列。</p><p>当forth为  </p><p><code>.forth { background: tomato; grid-row: 2; grid-column:2; }</code><br><img src="./auto-grid-one.png">  </p><p><code>.forth { background: tomato; grid-row: 3; grid-column:3; }</code><br><img src="./auto-grid-two.png"></p><h2 id="grid-items"><a href="#grid-items" class="headerlink" title="grid items"></a>grid items</h2><p>上面都是grid container的属性，下面介绍grid items 可以使用的各种属性。首先既然是grid item了，一些block的属性就不在适用了，如下： </p><ul><li>浮动和清除浮动，对于网格项目中使用不生效。</li><li>vertical-align属性对于网格项目不生效</li></ul><blockquote><h3 id="grid-column"><a href="#grid-column" class="headerlink" title="grid-column"></a>grid-column</h3><h3 id="grid-row"><a href="#grid-row" class="headerlink" title="grid-row"></a>grid-row</h3><h3 id="grid-area-1"><a href="#grid-area-1" class="headerlink" title="grid-area"></a>grid-area</h3></blockquote><p><code>grid-area</code>是<code>grid-column</code> &amp; <code>grid-row</code>的缩写。或者是template中的area-name<br>缩写方式：</p>  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grid-area: grid-<span class="keyword">row</span>-<span class="keyword">start</span> / grid-<span class="keyword">column</span>-<span class="keyword">start</span>/ grid-<span class="keyword">row</span>-<span class="keyword">end</span> / grid-<span class="keyword">column</span>-<span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">grid-area: <span class="type">name</span>;</span><br></pre></td></tr></table></figure><p><code>grid-column: grid-column-start / grid-column-end;</code><br><code>grid-row: grid-row-start / grid-row-end;</code></p><p>以上都要输入grid line的值: 这个值可以是数字，也可以是具体名称name，也可以是name-start/name-end。  </p><p>一个命名的template-area，都会隐式的生成 4 条 grid-line的名称：  </p><ul><li>area-start, area-end  行</li><li>area-start, area-end  列</li></ul><p>所以，在放置<code>grid item</code> 的时候，也可以不用<code>grid-area</code>, 用<code>grid-column</code>，<code>grid-row</code>输入隐式<code>grid line</code> 的名称即可。  </p><p>还有一种方式，通过合并单元格的形式，对grid item进行布局。<code>span</code>关键词实现单元格的跨越，类似table中的合并单元格，比如colspan合并列，rowspan合并行。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">2</span> / <span class="number">4</span>;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">1</span> / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">等价于：  </span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item-2</span> &#123;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">2</span> / span <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h3 id="justify-self"><a href="#justify-self" class="headerlink" title="justify-self"></a>justify-self</h3><h3 id="align-self"><a href="#align-self" class="headerlink" title="align-self"></a>align-self</h3></blockquote><p>含义及内容参考<code>justify-items</code> &amp; <code>align-items</code>。 这个是可以在项目本身修改下自己的排列方式。 </p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>参考：<a href="https://www.w3cplus.com/css3/breaking-out-with-css-grid-explained.html" target="_blank" rel="noopener">CSS Grid实现限宽容器</a></p><p><a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank" rel="noopener">参考</a><br><a href="https://alialaa.github.io/css-grid-cheat-sheet/" target="_blank" rel="noopener">cheat sheet</a><br><a href="http://cssgridgarden.com/" target="_blank" rel="noopener">小游戏掌握grid</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;例子&quot;&gt;&lt;a href=&quot;#例子&quot; class=&quot;headerlink&quot; title=&quot;例子&quot;&gt;&lt;/a&gt;例子&lt;/h2&gt;&lt;p&gt;grid布局的思想就是，先将一个container 设置上&lt;code&gt;display:grid;&lt;/code&gt; ,然后使用&lt;code&gt;gri
      
    
    </summary>
    
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="css3" scheme="https://akijiangrou.github.io/tags/css3/"/>
    
      <category term="grid" scheme="https://akijiangrou.github.io/tags/grid/"/>
    
  </entry>
  
  <entry>
    <title>flex布局</title>
    <link href="https://akijiangrou.github.io/2017/12/05/flex%E5%B8%83%E5%B1%80/"/>
    <id>https://akijiangrou.github.io/2017/12/05/flex布局/</id>
    <published>2017-12-05T02:34:41.000Z</published>
    <updated>2017-12-05T06:42:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>flex是个超好用的css 布局属性。<br>到2017-12 主要浏览器基本都支持了。如下：<br><img src="./cani.png"></p><p>flex 属性可应用于，flex容器，flex项目。其中flex容器中的元素，自动成为flex项目。<br>根据属性控制的轴的类型，简单总结下flex的各个属性，如下：  </p><p>假设9个方块其html如下，基本css如下：  </p>  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>="<span class="symbol">container</span>"&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">A</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">B</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">C</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">D</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">E</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">F</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">G</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">H</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">  &lt;<span class="symbol">div</span>&gt;<span class="symbol">I</span>&lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">&lt;/<span class="symbol">div</span>&gt;</span><br></pre></td></tr></table></figure><p>css  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>未加flex布局时的原始样式。<br><img src="1.png">  </p><h2 id="flex-container"><a href="#flex-container" class="headerlink" title="flex container"></a>flex container</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="2.png"></p><h3 id="主轴方向相关的属性"><a href="#主轴方向相关的属性" class="headerlink" title="主轴方向相关的属性"></a>主轴方向相关的属性</h3><blockquote><p><strong>[flex-direction]</strong>  规定项目排列方式，也就是主轴方向</p></blockquote><ul><li>row：默认，沿主轴从左向右排列子元素。规定主轴为水平方向。</li><li>row-reverse：从右向左</li><li>column：规定主轴方向为垂直方向，从上到下排列子元素。</li><li>column-reverse： 从下到上排列。</li></ul><blockquote><p><strong>[flex-direction]</strong>  规定换行情况  </p></blockquote><ul><li>no-wrap： 默认，不换行。见上面第二张图</li><li>wrap：换行。</li><li>wrap-reverse： 换行，且第一行在下方。</li></ul><p>如果规定了父元素宽度，默认不换行的话，其子元素会等比例缩小宽度（也就是子元素定义的宽不生效了）。如果换行，则按照子元素大小来显示。</p><blockquote><p><strong>[flex-flow]</strong>  以上两个的简写</p></blockquote><ul><li>主轴方向 + 换行  </li></ul><p>例子：  <code>flex-flow:row-reverse wrap-reverse;</code><br><img src="3.png"></p><blockquote><p><strong>[justify-content]</strong>  项目在主轴方向上的对齐方式。</p></blockquote><ul><li>flex-start：默认，相对于主轴左对齐（要根据flex-direction规定的轴方向来说，以下相同，不赘述了）</li><li>flex-end：右对齐</li><li>center：居中</li><li>space-between：两端对齐，项目之间间隔相同</li><li>space-around：每个项目的两侧间隔相同，所以项目间的距离是项目与边框的距离的二倍</li></ul><p>例子：<br><code>flex-flow:row-reverse wrap-reverse;</code><br><code>justify-content:flex-end;</code><br><img src="4.png"></p><p>如果换成center：<br><code>justify-content:center;</code><br><img src="5.png"></p><p>如果换成space-between：<br><code>justify-content:space-between;</code><br><img src="6.png">  </p><h3 id="交叉轴方向相关的属性"><a href="#交叉轴方向相关的属性" class="headerlink" title="交叉轴方向相关的属性"></a>交叉轴方向相关的属性</h3><p>下面换个基础图，  </p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="7.png"></p><p>如果我们设下：<code>flex-flow:row wrap;</code><br>则有：<br><img src="8.png"></p><blockquote><p><strong>[align-items]</strong>  项目在交叉轴上的对齐方式</p></blockquote><ul><li>flex-start： 交叉轴的起点对齐</li><li>flex-end：交叉轴的终点对齐</li><li>center：交叉轴的中点对齐</li><li>baseline：项目的第一行文字的基线对齐</li><li>stretch：默认，如果项目未设置高度或设为auto，将占满整个容器的高度。</li></ul><p>行数比较多的时候，有些效果可能看不出来。</p><p>例子：将c div改一下高度：  </p>  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> style=<span class="string">"height:150px"</span>&gt;C&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  displaybase: <span class="attribute">flex</span>;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">flex-flow</span>: row wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="9.png"></p><p>如果：改成<code>align-items: baseline;</code>  </p><p><img src="10.png"></p><blockquote><p><strong>[align-content]</strong>  主轴在交叉轴上的对齐方式<br>只有单行主轴的时候不生效。<br>与justify-content内容相同，多了个stretch，这个是默认值。<br>不过都是轴线相对于交叉轴的。比如：<code>flex-start</code>多根主轴在交叉轴的方向上，按交叉轴起点方向向下排列。</p></blockquote><p><code>justify-content: space-around;</code><br><code>align-content: space-around;</code></p><p><img src="11.png"></p><p><code>align-content: space-between;</code>  </p><p><img src="12.png">  </p><h2 id="flex-item"><a href="#flex-item" class="headerlink" title="flex item"></a>flex item</h2><p>每个flex项目也可以自定义一些属性。  </p><blockquote><p><strong>[order]</strong>  定义项目的排列顺序。数值越小，排列越靠前，默认为0</p></blockquote><p>例子，假如我们把上面的Fdiv的order改一下：<br><code>&lt;div style=&quot;order:2&quot;&gt;F&lt;/div&gt;</code> </p><p><img src="13.png">  </p><blockquote><p><strong>[flex-grow]</strong>  项目的放大比例。默认为0。如果为1，就是都占据同样的空间。其他的数字，则是如果有空余空间，则按照比例分配空间。  </p></blockquote><blockquote><p><strong>[flex-shrink]</strong> 项目的缩小比例。如果空间不够，将项目按照比例缩小。数字越大，缩小比例越大。</p></blockquote><p>例子：<br>  <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> style=<span class="string">"order:2;flex-shrink: 0"</span>&gt;F&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line"></span><br><span class="line">.<span class="keyword">container</span> &#123;</span><br><span class="line">  flex-flow: row nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="14.png"></p><p><code>&lt;div style=&quot;order:2;flex-shrink: 2&quot;&gt;F&lt;/div&gt;</code><br><img src="15.png"></p><blockquote><p><strong>[flex-basis]</strong>  项目占据的主轴空间。可以设为百分比。<br>默认： <code>0 1 auto；</code><br>快捷：<code>auto</code>   <code>（1 1 auto）</code><br>flex属性：[&lt;’flex-grow’&gt; &lt;’flex-shrink’&gt;? || &lt;’flex-basis’&gt;]  </p></blockquote><p>换新的布局：  </p>  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">flex-flow</span>: row wrap;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">align-content</span>: stretch;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">30%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">div</span> style=<span class="string">"height:150px"</span>&gt;C&lt;/div&gt;</span><br><span class="line">其余不变</span><br></pre></td></tr></table></figure><p><img src="16.png"></p><p>如果c设置上flex <code>&lt;div style=&quot;height:150px;flex: 2 1 30%&quot;&gt;C&lt;/div&gt;</code></p><p><img src="17.png"></p><blockquote><p><strong>[align-self]</strong><br>属性允许单个项目有与其他项目不一样的对齐方式，可覆盖align-items属性。默认继承父元素的align-items属性。其他属性与上面相同。<br><code>&lt;div style=&quot;align-self:flex-end&quot;&gt;F&lt;/div&gt;</code></p></blockquote><p><img src="last.png">  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;flex是个超好用的css 布局属性。&lt;br&gt;到2017-12 主要浏览器基本都支持了。如下：&lt;br&gt;&lt;img src=&quot;./cani.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;flex 属性可应用于，flex容器，flex项目。其中flex容器中的元素，自动成为flex项目。&lt;br&gt;根据
      
    
    </summary>
    
    
      <category term="css" scheme="https://akijiangrou.github.io/tags/css/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="flex" scheme="https://akijiangrou.github.io/tags/flex/"/>
    
  </entry>
  
  <entry>
    <title>vue学习笔记</title>
    <link href="https://akijiangrou.github.io/2017/11/28/vue%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://akijiangrou.github.io/2017/11/28/vue学习笔记/</id>
    <published>2017-11-28T07:04:55.000Z</published>
    <updated>2017-12-01T10:32:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="声明式渲染"><a href="#声明式渲染" class="headerlink" title="声明式渲染"></a>声明式渲染</h2><p>给vue一个div，将数据绑定在这个div范围内，然后就可以用vue操作和渲染了。</p>  <figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keywords">div</span> <span class="symbol">id</span>=<span class="string">"app"</span> v-bind:style=<span class="string">'style'</span>&gt;</span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line">&lt;/<span class="keywords">div</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keywords">var</span> app = new Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">'my name is zcx'</span>,</span><br><span class="line">    style: <span class="string">'width: 200px;background: pink'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>类似模板的方法: html 中嵌入数据，该数据存储在vue的data中。<br>数据还可以通过，v-bind的方法，传到dom节点中。bind后面接的是dom应有的属性，等号后面接data中的数据。  </p><h2 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h2><p>以<code>v-</code> 开头的都是，vue整合了一些常用的便捷的写法，具体如下：<br><code>【v-bind】</code>绑定数据，还提供了简写：<code>v-bind:href=&#39;url&#39; ===&gt; :href=&#39;url&#39;</code><br><code>【v-if】</code>  条件判定，绑定dom结构到数据上。<br><code>【v-for】</code> 循环<br><code>【v-on】</code>  事件监听，简写：<code>v-on:click=&#39;...&#39;  ===&gt; @click=&#39;...&#39;</code>  </p><p>实例代码：  </p><p></p><p data-height="473" data-theme-id="0" data-slug-hash="Bwvrrb" data-default-tab="js,result" data-user="akixiao" data-embed-version="2" data-pen-title="Bwvrrb" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/Bwvrrb/" target="_blank" rel="noopener">Bwvrrb</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p><code>【v-model】</code> 实现表单信息与应用状态之间的双向绑定。对于input   v-model绑定的是input中value。<br>radio 对应的是value中的 ‘one’，’two’;</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"radio"</span> name=<span class="string">"pick"</span> <span class="built_in">value</span>=<span class="string">"one"</span> v-model=<span class="string">"pick"</span>/&gt;</span><br><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">"radio"</span> name=<span class="string">"pick"</span> <span class="built_in">value</span>=<span class="string">"two"</span> v-model=<span class="string">"pick"</span>/&gt;</span><br><span class="line">&#123;&#123; pick &#125;&#125;</span><br><span class="line"></span><br><span class="line">// vue 部分</span><br><span class="line">da<span class="symbol">ta:</span> &#123;</span><br><span class="line">    <span class="built_in">pi</span><span class="symbol">ck:</span> <span class="string">"one"</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><code>【v-once】</code> 只执行一次插值，当数据改变时，插值处的内容不会更新</p><h3 id="v-model实例"><a href="#v-model实例" class="headerlink" title="v-model实例"></a>v-model实例</h3><p>将input与v-model结合，如下：  </p><p></p><p data-height="553" data-theme-id="0" data-slug-hash="EbeOXB" data-default-tab="html,result" data-user="akixiao" data-embed-version="2" data-pen-title="EbeOXB" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/EbeOXB/" target="_blank" rel="noopener">EbeOXB</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><h2 id="实例属性获取"><a href="#实例属性获取" class="headerlink" title="实例属性获取"></a>实例属性获取</h2><p>可以通过四种方式，展示&amp;监听vue实例中的属性。  </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">vm</span> = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="keyword">e</span><span class="variable">l:</span> <span class="string">'#example'</span>,</span><br><span class="line">  dat<span class="variable">a:</span> &#123;</span><br><span class="line">     message: <span class="string">'Hello'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 计算属性的 getter</span><br><span class="line">    reversedMessage: <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></span><br><span class="line">      // `this` 指向 <span class="keyword">vm</span> 实例</span><br><span class="line">      <span class="keyword">return</span> this.message.<span class="keyword">split</span>(<span class="string">''</span>).<span class="built_in">reverse</span>().<span class="keyword">join</span>(<span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="模板表达式"><a href="#模板表达式" class="headerlink" title="模板表达式"></a>模板表达式</h3><p>这个是最基本的获取方法。获取message的信息</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"example"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Original message: "</span><span class="template-variable">&#123;&#123; message &#125;&#125;</span><span class="xml">"<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h3><p>出现原因是在模板中放入太多的逻辑会让模板过重且难以维护,对于任何复杂逻辑，你都应当使用计算属性。<br>如上面的reversedMessage。  </p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"example"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Original message: "</span><span class="template-variable">&#123;&#123; reversedMessage &#125;&#125;</span><span class="xml">"<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>如果我修改了message，则对应的reversedMessage 也会跟着改变。<br>如果message不改变，re-render的时候，reversedMessage会立即展示之前的问题。</p><h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><p>其实使用method也可以达到获取reversedMessage的目的。  与上面的差别的是，每当触发重新渲染时，<code>调用方法将总会再次执行函数</code>。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">vm</span> = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="keyword">e</span><span class="variable">l:</span> <span class="string">'#example'</span>,</span><br><span class="line">  dat<span class="variable">a:</span> &#123;</span><br><span class="line">     message: <span class="string">'Hello'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  method<span class="variable">s:</span> &#123;</span><br><span class="line">    // 计算属性的 getter</span><br><span class="line">    reversedMessage: <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></span><br><span class="line">      // `this` 指向 <span class="keyword">vm</span> 实例</span><br><span class="line">      <span class="keyword">return</span> this.message.<span class="keyword">split</span>(<span class="string">''</span>).<span class="built_in">reverse</span>().<span class="keyword">join</span>(<span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;div id=<span class="string">"example"</span>&gt;</span><br><span class="line">  <span class="symbol">&lt;p&gt;</span>Original message: <span class="string">"&#123;&#123; reversedMessage() &#125;&#125;"</span>&lt;/<span class="keyword">p</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="侦听属性"><a href="#侦听属性" class="headerlink" title="侦听属性"></a>侦听属性</h3><p>一种更通用的方式来观察和响应 Vue 实例上的数据变动。 当需要在数据变化时执行异步或开销较大的操作时，这个方式是最有用的。<br>在watch函数中监听某些属性，该属性一变化，就会执行对应的函数，函数内可能会对其他属性进行操作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#example'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">     message: <span class="string">'Hello'</span>,</span><br><span class="line">     question: <span class="string">''</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="comment">// 计算属性的 getter</span></span><br><span class="line">    question: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// `this` 指向 vm 实例</span></span><br><span class="line">      <span class="keyword">this</span>.message = <span class="string">'...'</span>;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;div id=<span class="string">"example"</span>&gt;</span><br><span class="line">  &lt;input v-model=<span class="string">"question"</span>/&gt;</span><br><span class="line">  &lt;p&gt;Original message: <span class="string">"&#123;&#123; message &#125;&#125;"</span>&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>【v-bind:class】 可以与<strong>原始的class </strong>混用  </p><p>【<strong>计算属性</strong>】 返回一个classObject。  </p><p>【v-bind:class=”[activeClass, errorClass]”&gt;】 数组形式，传给他一个class列表。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> v-bind:<span class="built_in">class</span>=<span class="string">"&#123; active: isActive &#125;"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><p>上面的语法表示 active 这个 class 存在与否将取决于数据属性 isActive 是否为真。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"app"</span>&gt;</span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"static"</span></span><br><span class="line">     v-bind:<span class="built_in">class</span>=<span class="string">"&#123; active: isActive, 'text-danger': hasError &#125;"</span>&gt;</span><br><span class="line">   helloworld</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"static"</span></span><br><span class="line">     v-bind:<span class="built_in">class</span>=<span class="string">"classObj"</span>&gt;</span><br><span class="line">    <span class="keyword">second</span> <span class="keyword">try</span>&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line"></span><br><span class="line">.active &#123;</span><br><span class="line">  <span class="built_in">text</span>-decoration: underline;</span><br><span class="line">&#125;</span><br><span class="line">.static &#123;</span><br><span class="line">  font-size: <span class="number">20</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="built_in">text</span>-danger &#123;</span><br><span class="line">  color: orange;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const app = new Vue(&#123;</span><br><span class="line">  el: '<span class="comment">#app',</span></span><br><span class="line">   data: &#123;</span><br><span class="line">    isActive: <span class="literal">true</span>,</span><br><span class="line">    hasError: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  computed:&#123;</span><br><span class="line">    classObj: function() &#123;</span><br><span class="line"><span class="built_in">      return</span> &#123;</span><br><span class="line">        active: !this.isActive,</span><br><span class="line">        '<span class="built_in">text</span>-danger': this.isActive &amp;&amp; this.hasError,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>实例： </p><p data-height="348" data-theme-id="0" data-slug-hash="POdxyE" data-default-tab="js,result" data-user="akixiao" data-embed-version="2" data-pen-title="POdxyE" class="codepen">See the Pen <a href="https://codepen.io/akixiao/pen/POdxyE/" target="_blank" rel="noopener">POdxyE</a> by akixiao (<a href="https://codepen.io/akixiao" target="_blank" rel="noopener">@akixiao</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><h3 id="style"><a href="#style" class="headerlink" title="style"></a>style</h3><p>与class类似。  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;声明式渲染&quot;&gt;&lt;a href=&quot;#声明式渲染&quot; class=&quot;headerlink&quot; title=&quot;声明式渲染&quot;&gt;&lt;/a&gt;声明式渲染&lt;/h2&gt;&lt;p&gt;给vue一个div，将数据绑定在这个div范围内，然后就可以用vue操作和渲染了。&lt;/p&gt;
  &lt;figure cl
      
    
    </summary>
    
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Vue.js" scheme="https://akijiangrou.github.io/tags/Vue-js/"/>
    
  </entry>
  
  <entry>
    <title>学习笔记</title>
    <link href="https://akijiangrou.github.io/2017/11/23/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://akijiangrou.github.io/2017/11/23/学习笔记/</id>
    <published>2017-11-23T03:08:00.000Z</published>
    <updated>2017-11-23T03:08:00.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>post-message</title>
    <link href="https://akijiangrou.github.io/2017/11/17/post-message/"/>
    <id>https://akijiangrou.github.io/2017/11/17/post-message/</id>
    <published>2017-11-17T07:10:44.000Z</published>
    <updated>2019-05-09T13:00:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="用postmessage-进行iframe与parent的交流。"><a href="#用postmessage-进行iframe与parent的交流。" class="headerlink" title="用postmessage 进行iframe与parent的交流。"></a>用postmessage 进行iframe与parent的交流。</h2><p>需求描述：<br>父页面包含iframe  </p>  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">html</span> http:<span class="comment">//a.b.com&gt;</span></span><br><span class="line">  &lt;<span class="selector-tag">iframe</span> http:<span class="comment">//c.b.com&gt;</span></span><br><span class="line">  sjdkfjaksjfakfjs</span><br><span class="line">  &lt;/iframe&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>在<a href="http://c.b.com中有个button，点击后让父页面也就是a.b.com进行一些操作。那么怎么写呢？" target="_blank" rel="noopener">http://c.b.com中有个button，点击后让父页面也就是a.b.com进行一些操作。那么怎么写呢？</a>  </p><p>首先在a.b.com 重要监听message事件，如下：  </p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>, handleIframe);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleIframe = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>:&#123; pathStr &#125;&#125; = event;</span><br><span class="line"><span class="comment">// 发送message的源</span></span><br><span class="line">  <span class="keyword">const</span> origin = event.origin || event.originalEvent.origin;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">window</span>.top.location.origin;</span><br><span class="line"><span class="comment">// 防止监听多个源头的message</span></span><br><span class="line">  <span class="keyword">if</span> (test(<span class="regexp">/c.b.com/</span>, origin) &amp;&amp; pathStr) &#123;</span><br><span class="line">    <span class="built_in">window</span>.alert(pathStr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在c.b.com 中，点击button，触发click事件  </p>  <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handle<span class="constructor">Click()</span> &#123;</span><br><span class="line">  const msg = &#123; pathStr: '/shop/page/tagSetting?dim=poi&amp;tab=<span class="number">1</span>' &#125;;</span><br><span class="line">  window.top.post<span class="constructor">Message(<span class="params">msg</span>, ’<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">a</span>.<span class="params">b</span>.<span class="params">com</span>')</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意postMessage的<code>发送方，必须是发送目的地的window对象</code>，第一个参数是data信息，第二个参数是接收这个message的url。  </p><p>也就是说，我虽然在iframe中控制parent，但是实现时，是<strong>期望收到信息的window</strong>发出的message事件，这样该window才能监听到这个message。这样就好理解了。  </p><p><a href="http://blog.csdn.net/monkindey/article/details/23659387" target="_blank" rel="noopener">参考</a>  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;用postmessage-进行iframe与parent的交流。&quot;&gt;&lt;a href=&quot;#用postmessage-进行iframe与parent的交流。&quot; class=&quot;headerlink&quot; title=&quot;用postmessage 进行iframe与parent
      
    
    </summary>
    
    
      <category term="DOM" scheme="https://akijiangrou.github.io/tags/DOM/"/>
    
      <category term="iframe" scheme="https://akijiangrou.github.io/tags/iframe/"/>
    
  </entry>
  
  <entry>
    <title>WebGL学习系列-threejs-形状</title>
    <link href="https://akijiangrou.github.io/2017/11/10/WebGL%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97-threejs-%E5%BD%A2%E7%8A%B6/"/>
    <id>https://akijiangrou.github.io/2017/11/10/WebGL学习系列-threejs-形状/</id>
    <published>2017-11-10T09:56:43.000Z</published>
    <updated>2017-11-15T06:00:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>three.js中创建物体，比如一条线，需要如下函数：<br><code>new THREE.Line( geometry, material );</code><br><strong>geometry</strong>: 几何体<br><strong>material</strong>: 材质<br>这是创建物体[mesh]必须的。<code>Geometry</code>主要是存储物体的顶点信息，threejs中提供了一些固定的形状，省去我们一个个固定顶点的工作量。  </p><h2 id="常见几何体"><a href="#常见几何体" class="headerlink" title="常见几何体"></a>常见几何体</h2><p>立方体，平面，球体，圆柱体，四面体，八面体，文字等。  </p><h3 id="立方体"><a href="#立方体" class="headerlink" title="立方体"></a>立方体</h3><p><code>THREE.CubeGeometry(width, height, depth, widthSegments, heightSegments, depthSegments)</code>  前三个就是x，y，z方向上的长度。后三个是各自反向上的面分段，默认为1。<br>对于立方体，默认位置是其几何中心在坐标原点。  </p><h3 id="平面"><a href="#平面" class="headerlink" title="平面"></a>平面</h3><p><code>THREE.PlaneGeometry(width, height, widthSegments, heightSegments)</code><br>width是x方向上的长度；height是y方向上的长度；后两个参数同样表示分段</p><p>如果想让让平面在别的方向上，可以进行旋转。</p><h3 id="球体"><a href="#球体" class="headerlink" title="球体"></a>球体</h3><p><code>THREE.SphereGeometry(radius, segmentsWidth, segmentsHeight, phiStart, phiLength, thetaStart, thetaLength)</code><br>在图形底层中，并没有曲线，是通过多个折线近似构成曲线。所以segmentsWidth, segmentsHeight(纬度上的切片数)|width(经度上的切片数)设的越大越接近球体。  </p><p>phiStart表示经度开始的弧度；phiLength表示经度跨过的弧度；thetaStart表示纬度开始的弧度；thetaLength表示纬度跨过的弧度。<br>phi打头的就是代表水平方向。theta就是在垂直方向。</p><h3 id="圆形"><a href="#圆形" class="headerlink" title="圆形"></a>圆形</h3><p><code>THREE.CircleGeometry(radius, segments, thetaStart, thetaLength)</code><br>同理，segments越大，越接近于圆。  </p><h3 id="圆台"><a href="#圆台" class="headerlink" title="圆台"></a>圆台</h3><p><code>THREE.CylinderGeometry(radiusTop, radiusBottom, height, radiusSegments, heightSegments, openEnded)</code><br>openEnded表示是否没有顶面和底面。默认为false(有顶面和底面)。  </p><h3 id="正四面体"><a href="#正四面体" class="headerlink" title="正四面体"></a>正四面体</h3><p>多面体的参数，都是半径 &amp; detail。半径是外接球半径，detail是细节层次，一般可以省略。  </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tri = new THREE.TetrahedronGeometry(<span class="number">150</span>);</span><br><span class="line">  <span class="keyword">const</span> triObj= new THREE.Mesh(tri, material(<span class="number">0x333333</span>));</span><br><span class="line">  triObj.position.y = <span class="number">-300</span>;</span><br><span class="line">  triObj.position.x = <span class="number">300</span>;</span><br><span class="line">  scene.add(triObj);</span><br></pre></td></tr></table></figure><h3 id="正八面体"><a href="#正八面体" class="headerlink" title="正八面体"></a>正八面体</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正八面体</span></span><br><span class="line">  <span class="keyword">const</span> octo = new THREE.OctahedronGeometry(<span class="number">150</span>);</span><br><span class="line">  <span class="keyword">const</span> octoObj= new THREE.Mesh(octo, material(<span class="number">0x33ff33</span>));</span><br><span class="line">  octoObj.position.y = <span class="number">-300</span>;</span><br><span class="line">  octoObj.position.x = <span class="number">-300</span>;</span><br><span class="line">  scene.add(octoObj);</span><br></pre></td></tr></table></figure><h3 id="正20面体"><a href="#正20面体" class="headerlink" title="正20面体"></a>正20面体</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正二十面体</span></span><br><span class="line">  <span class="keyword">const</span> icos = new THREE.IcosahedronGeometry(<span class="number">150</span>);</span><br><span class="line">  <span class="keyword">const</span> icosObj= new THREE.Mesh(icos, material(<span class="number">0xff3333</span>));</span><br><span class="line">  icosObj.position.y = <span class="number">-300</span>;</span><br><span class="line">  icosObj.position.x = <span class="number">0</span>;</span><br><span class="line">  scene.add(icosObj);</span><br></pre></td></tr></table></figure><h3 id="甜甜圈"><a href="#甜甜圈" class="headerlink" title="甜甜圈"></a>甜甜圈</h3><p><code>THREE.TorusGeometry(150, 50, 10, 20)</code><br>第一个甜甜圈整个半径，第二个参数:管道半径，后面分别对应两者的半径。需要把两个半径调大，甜甜圈看着就光滑了。  </p><h3 id="打结版的甜甜圈"><a href="#打结版的甜甜圈" class="headerlink" title="打结版的甜甜圈"></a>打结版的甜甜圈</h3><p><code>THREE.TorusKnotGeometry(radius, tube, radialSegments, tubularSegments, p, q, heightScale)</code><br>p和q是控制其样式的参数，一般可以缺省， heightScale: z轴上的缩放。  </p><h3 id="边框"><a href="#边框" class="headerlink" title="边框"></a>边框</h3><h4 id="boxHelper"><a href="#boxHelper" class="headerlink" title="boxHelper"></a>boxHelper</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">mesh</span> = <span class="built_in">new</span> THREE.Mesh(geom,material);</span><br><span class="line"><span class="built_in">scene</span>.add(<span class="built_in">mesh</span>);</span><br><span class="line"><span class="built_in">border</span> = <span class="built_in">new</span> THREE.BoxHelper( <span class="built_in">mesh</span>,<span class="number">0x0dc3b4</span> );//设置边框，这个边框不会旋转</span><br><span class="line"><span class="built_in">scene</span>.add( <span class="built_in">border</span> );</span><br></pre></td></tr></table></figure><p>边框不跟随物体旋转</p><h4 id="edgesHelper"><a href="#edgesHelper" class="headerlink" title="edgesHelper"></a>edgesHelper</h4><p>边框跟随</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">mesh</span> = <span class="built_in">new</span> THREE.Mesh(geom,material);</span><br><span class="line"><span class="built_in">scene</span>.add(<span class="built_in">mesh</span>);</span><br><span class="line"><span class="built_in">border</span> = <span class="built_in">new</span> THREE.edgesHelper( <span class="built_in">mesh</span>,<span class="number">0x0dc3b4</span> );//设置边框，这个边框不会旋转</span><br><span class="line"><span class="built_in">scene</span>.add( <span class="built_in">border</span> );</span><br></pre></td></tr></table></figure><p>各种形状的展示：<br><img src="pic1.png"><br>代码参考：  <a href="https://github.com/MissSweety/threejs/blob/master/js/geometry.js" target="_blank" rel="noopener">https://github.com/MissSweety/threejs/blob/master/js/geometry.js</a>  </p><h2 id="外部模型-3ds-max"><a href="#外部模型-3ds-max" class="headerlink" title="外部模型[3ds max]"></a>外部模型[3ds max]</h2><p><a href="https://read.douban.com/reader/ebook/7412854/" target="_blank" rel="noopener">参考文献-几何形状</a><br><a href="https://www.august.com.au/blog/animating-scenes-with-webgl-three-js/" target="_blank" rel="noopener">形状实战</a><br><a href="http://learningthreejs.com/" target="_blank" rel="noopener">视频教程</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;three.js中创建物体，比如一条线，需要如下函数：&lt;br&gt;&lt;code&gt;new THREE.Line( geometry, material );&lt;/code&gt;&lt;br&gt;&lt;strong&gt;geometry&lt;/strong&gt;: 几何体&lt;br&gt;&lt;strong&gt;material&lt;/
      
    
    </summary>
    
    
      <category term="webGL" scheme="https://akijiangrou.github.io/tags/webGL/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Three.js" scheme="https://akijiangrou.github.io/tags/Three-js/"/>
    
  </entry>
  
  <entry>
    <title>WebGL学习系列-threejs-光源</title>
    <link href="https://akijiangrou.github.io/2017/11/06/WebGL%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97-threejs-%E5%85%89%E6%BA%90/"/>
    <id>https://akijiangrou.github.io/2017/11/06/WebGL学习系列-threejs-光源/</id>
    <published>2017-11-06T07:08:09.000Z</published>
    <updated>2017-11-06T09:11:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>图像渲染要依赖光源，如果没有光，世界就是一片黑暗，即使物体存在，你也看不出来。为了让计算机模拟光照效果，提出了几种不同的光源模型。  </p><ul><li>环境光  </li><li>平行光  </li><li>点光源  </li><li>聚光灯  </li></ul><p>Three.js中也定义了以上几种光型，有了他们会让3d效果更逼真。  </p><p>在解释光的问题外，还要先说明下Three.js 中，颜色都是16进制来表示的，白色：0xffffff。  </p><h2 id="环境光"><a href="#环境光" class="headerlink" title="环境光"></a>环境光</h2><p>环境光是指场景整体的光照效果，是由于场景内若干光源的多次反射形成的亮度一致的效果，通常用来为整个场景指定一个基础亮度。因此，环境光没有明确的光源位置，在各处形成的亮度也是一致的。  </p><h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><p><code>THREE.AmbientLight(hex)</code>  </p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>具体例子，创建光源添加到场景中。  </p><pre><code><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xffffff</span>);</span><br><span class="line">scene.<span class="keyword">add</span>(light);</span><br></pre></td></tr></table></figure></code></pre><p>加入两个物体：  白色正方形和绿色正方形，进行光的实验。  </p><pre><code><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> cube = <span class="keyword">new</span> THREE.CubeGeometry(<span class="number">200</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line"><span class="keyword">const</span> material = (<span class="built_in">color</span>) =&gt; <span class="keyword">new</span> THREE.MeshLambertMaterial(&#123;<span class="built_in">color</span>: <span class="built_in">color</span> &#125;));</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> greenCube = <span class="keyword">new</span> THREE.Mesh(cube, material(<span class="number">0x00ff00</span>));</span><br><span class="line"> greenCube.position.x = <span class="number">300</span>;</span><br><span class="line"> scene.<span class="built_in">add</span>(greenCube);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> whiteCube = <span class="keyword">new</span> THREE.Mesh(cube, material(<span class="number">0xffffff</span>));</span><br><span class="line"> whiteCube.position.x = <span class="number">-300</span>;</span><br><span class="line"> scene.<span class="built_in">add</span>(whiteCube);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 照相机位置：  </span></span><br><span class="line"> function initCamera(<span class="built_in">width</span>, <span class="built_in">height</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">camera</span> = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">45</span>, <span class="built_in">width</span> / <span class="built_in">height</span>, <span class="number">1</span>, <span class="number">8000</span>);</span><br><span class="line">  <span class="comment">// camera 位于屏幕外侧1500px的地方，这样可以直接做平面图了。</span></span><br><span class="line">  <span class="built_in">camera</span>.position.x = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">camera</span>.position.y = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">camera</span>.position.z = <span class="number">1500</span>;</span><br><span class="line">  <span class="built_in">camera</span>.lookAt(<span class="number">0</span>, <span class="number">20</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">camera</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><p>白色光源 + 白色正方形和绿色正方形<br>效果如下：<br><img src="./light1.png" width="60%"></p><p>想让光线暗一些，就把光源变灰一些。<br>效果如下：<br><img src="./light2.png" width="60%"></p><p>如果光源是红光，看下两个物体的颜色<br>效果如下：<br><img src="./light3.png" width="60%"><br>我们可以看到，绿色的小方块没了（变成黑色的了），原因是，我们能看到物体，都是因为他反射的光，而绿色小方块的红色通道是0，反射不回来内容了，所以我们看到的就是黑色物体了，如果把光源调到带有绿色的，我们可以看到如下效果：  </p><pre><code><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> light = <span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xff8800</span>);</span><br><span class="line">      scene.<span class="keyword">add</span>(light);</span><br></pre></td></tr></table></figure></code></pre><p><img src="./light4.png" width="60%"></p><p>综上，当我们使用环境光的时候，最好使用白色光与灰色光，其他颜色会导致物体显色奇怪。  </p><h2 id="平行光"><a href="#平行光" class="headerlink" title="平行光"></a>平行光</h2><p>太阳光常常被看作平行光，这是因为相对地球上物体的尺度而言，太阳离我们的距离足够远。对于任意平行的平面，平行光照射的亮度都是相同的，而与平面所在位置无关。</p><h3 id="构造函数-1"><a href="#构造函数-1" class="headerlink" title="构造函数"></a>构造函数</h3><p><code>THREE.DirectionalLight(hex, intensity)</code>  </p><p><strong>intensity:</strong> 亮度，缺省值为1，表示100%亮度。<br>对于平行光而言，设置光源位置尤为重要</p><h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>也是两个小正方形，白色和绿色。与上面的不同，我们调整了照相机的位置：  </p><pre><code><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function initCamera(<span class="built_in">width</span>, <span class="built_in">height</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">camera</span> = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">45</span>, <span class="built_in">width</span> / <span class="built_in">height</span>, <span class="number">1</span>, <span class="number">8000</span>);</span><br><span class="line">  <span class="comment">// camera 位于屏幕外侧1500px的地方，这样可以直接做平面图了。</span></span><br><span class="line">  <span class="built_in">camera</span>.position.x = <span class="number">500</span>;</span><br><span class="line">  <span class="built_in">camera</span>.position.y = <span class="number">500</span>;</span><br><span class="line">  <span class="built_in">camera</span>.position.z = <span class="number">1500</span>;</span><br><span class="line">  <span class="built_in">camera</span>.lookAt(<span class="number">100</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">camera</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><p>光源：  </p><pre><code><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">light = new THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">1</span>);</span><br><span class="line">light.position.<span class="keyword">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>);</span><br><span class="line">scene.add(light);</span><br></pre></td></tr></table></figure></code></pre><p>说明，光是从z方向处200px的位置向着所有物体照射。  我们可以得到如下图像。<br><img src="./light5.png" width="60%"></p><p>我们调整下光的照射方向：  </p>  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">light.position.<span class="keyword">set</span>(<span class="number">800</span>, <span class="number">0</span>, <span class="number">400</span>);</span><br></pre></td></tr></table></figure><p>说明，光是在x方向800，y方向为0，z方向处400px，与原点连线形成的向量，这个方向形成的光线。 我们可以得到如下图像。<br><img src="./light6.png" width="60%"></p><p>对比下，我们加上y方向的光，  light.position.set(800, 200, 400);<br><img src="./light7.png" width="60%"></p><h2 id="点光源"><a href="#点光源" class="headerlink" title="点光源"></a>点光源</h2><p>点光源是不计光源大小，可以看作一个点发出的光源。点光源照到不同物体表面的亮度是线性递减的，因此，离点光源距离越远的物体会显得越暗。这里光在每个面上的亮度是不同的，对于每个三角面片，将根据三个顶点的亮度进行插值。</p><h3 id="构造函数-2"><a href="#构造函数-2" class="headerlink" title="构造函数"></a>构造函数</h3><p><code>THREE.PointLight(hex, intensity, distance)</code>  </p><p><strong>distance</strong>：光源最远照射的距离，缺省值是0。</p><h3 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h3><pre><code><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">light = new THREE.PointLight(<span class="number">0xffffff</span>, <span class="number">2</span>, <span class="number">1000</span>);</span><br><span class="line">light.position.<span class="keyword">set</span>(<span class="number">0</span>, <span class="number">200</span>, <span class="number">300</span>);</span><br></pre></td></tr></table></figure></code></pre><p>一个点光源，在坐标(0, 200, 300)位置，进行照射，最远距离1000，结果如下：  </p><p><img src="./light8.png" width="60%"><br>当最远距离缩小为500，结果：  </p><p><img src="./light9.png" width="60%">  </p><h2 id="聚光灯"><a href="#聚光灯" class="headerlink" title="聚光灯"></a>聚光灯</h2><p>聚光灯是一种特殊的点光源，它能够朝着一个方向投射光线。聚光灯投射出的是类似圆锥形的光线，这与我们现实中看到的聚光灯是一致的。</p><h3 id="构造函数-3"><a href="#构造函数-3" class="headerlink" title="构造函数"></a>构造函数</h3><p><code>THREE.SpotLight(hex, intensity, distance, angle, exponent)</code></p><p><strong>angle</strong>：angle是聚光灯的张角，缺省值是Math.PI / 3，最大值是Math.PI / 2<br><strong>exponent</strong>：exponent是光强在偏离target的衰减指数（target需要在之后定义，缺省值为(0, 0, 0)），缺省值是10。  </p><p>使用聚光灯，一般还要设置target。  如果想让一个物体的运动有灯光跟随，可以将target设置为改对象。  </p><h3 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h3><pre><code><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">light = new THREE.SpotLight(<span class="number">0xffff00</span>, <span class="number">2</span>, <span class="number">1000</span>, Math.<span class="literal">PI</span> /<span class="number">4</span> , <span class="number">25</span>);</span><br><span class="line">light.position.set(<span class="number">300</span>, <span class="number">500</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></code></pre><p><img src="./light10.png" width="60%">  </p><p><a href="https://read.douban.com/ebook/7412854/" target="_blank" rel="noopener">参考</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;图像渲染要依赖光源，如果没有光，世界就是一片黑暗，即使物体存在，你也看不出来。为了让计算机模拟光照效果，提出了几种不同的光源模型。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;环境光  &lt;/li&gt;
&lt;li&gt;平行光  &lt;/li&gt;
&lt;li&gt;点光源  &lt;/li&gt;
&lt;li&gt;聚光灯  &lt;/li&gt;

      
    
    </summary>
    
    
      <category term="webGL" scheme="https://akijiangrou.github.io/tags/webGL/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Three.js" scheme="https://akijiangrou.github.io/tags/Three-js/"/>
    
  </entry>
  
  <entry>
    <title>WebGL学习系列-threejs-camera</title>
    <link href="https://akijiangrou.github.io/2017/11/03/WebGL%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97-threejs-camera/"/>
    <id>https://akijiangrou.github.io/2017/11/03/WebGL学习系列-threejs-camera/</id>
    <published>2017-11-03T08:41:39.000Z</published>
    <updated>2017-11-06T03:04:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="是什么？"><a href="#是什么？" class="headerlink" title="是什么？"></a>是什么？</h2><p>照相机定义了三维空间到二维屏幕的投影方式。因为投影的不同，照相机又分为正交投影相机和透视投影相机。  </p><h2 id="正交投影相机"><a href="#正交投影相机" class="headerlink" title="正交投影相机"></a>正交投影相机</h2><p>而使用正交投影照相机获得的结果就像我们在数学几何学课上老师教我们画的效果，对于在三维空间内平行的线，投影到二维空间中也一定是平行的。其特点是，远近高低比例都相同。如下：  </p><p><img src="./zhengjiao.png" width="300px"></p><h3 id="具体方法"><a href="#具体方法" class="headerlink" title="具体方法"></a>具体方法</h3><p><code>OrthographicCamera( left, right, top, bottom, near, far )</code><br>这六个参数分别代表正交投影照相机拍摄到的空间的六个面的位置，这六个面围成一个长方体，我们称其为视景体（Frustum）。只有在视景体内部的物体才可能显示在屏幕上，而视景体外的物体会在显示之前被裁减掉。需要保证(right - left)与(top - bottom)的比例与Canvas宽度与高度的比例一致</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">camera</span> = <span class="keyword">new</span> THREE.OrthographicCamera( <span class="built_in">width</span> / - <span class="number">2</span>, <span class="built_in">width</span> / <span class="number">2</span>, <span class="built_in">height</span> / <span class="number">2</span>, <span class="built_in">height</span> / - <span class="number">2</span>, <span class="number">1</span>, <span class="number">1000</span> );</span><br><span class="line"></span><br><span class="line">scene.<span class="built_in">add</span>( <span class="built_in">camera</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个例子将浏览器窗口的宽度和高度作为了视景体的高度和宽度，相机正好在窗口的中心点上。这也是一般的设置方法，基本上为了方便不会设置其他的值。</span></span><br></pre></td></tr></table></figure><ul><li>left</li></ul><h2 id="透视投影相机"><a href="#透视投影相机" class="headerlink" title="透视投影相机"></a>透视投影相机</h2><p>而使用透视投影照相机获得的结果是类似人眼在真实世界中看到的有“近大远小”的效果。透视投影是更符合我们视觉的投影。如下：  </p><p><img src="./toushi.png" width="300px"></p><h3 id="具体方法-1"><a href="#具体方法-1" class="headerlink" title="具体方法"></a>具体方法</h3><p><code>PerspectiveCamera( fov, aspect, near, far )</code><br><code>fov</code>: 眼睛睁开的角度,即,视角的大小,如果设置为0,相当你闭上眼睛了,所以什么也看不到,如果为180,那么可以认为你的视界很广阔。视角越大，中间的物体越小，这是因为，视角越大，看到的场景越大，那么中间的物体相对于整个场景来说，就越小了。角度制而非弧度制。0-180<br><code>aspect</code>: 纵横比，一般为canvas的width/height, 照相机水平方向和竖直方向长度的比值，通常设为Canvas的横纵比例。<br><code>near</code>: 照相机到视景体最近的距离。<br><code>far</code>: 照相机到视景体最远的距离。<br>相应的图像如下：<br><img src="./toushi2.png" width="500px">  </p><p>不同fov的对比，请参考：<a href="http://www.hewebgl.com/article/getarticle/59" target="_blank" rel="noopener">《三维空间的观察》</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;是什么？&quot;&gt;&lt;a href=&quot;#是什么？&quot; class=&quot;headerlink&quot; title=&quot;是什么？&quot;&gt;&lt;/a&gt;是什么？&lt;/h2&gt;&lt;p&gt;照相机定义了三维空间到二维屏幕的投影方式。因为投影的不同，照相机又分为正交投影相机和透视投影相机。  &lt;/p&gt;
&lt;h2 id
      
    
    </summary>
    
    
      <category term="three.js" scheme="https://akijiangrou.github.io/tags/three-js/"/>
    
      <category term="webGL" scheme="https://akijiangrou.github.io/tags/webGL/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="camera" scheme="https://akijiangrou.github.io/tags/camera/"/>
    
  </entry>
  
  <entry>
    <title>WebGL学习系列-three.js入门</title>
    <link href="https://akijiangrou.github.io/2017/11/03/WebGL%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97-three-js%E5%85%A5%E9%97%A8/"/>
    <id>https://akijiangrou.github.io/2017/11/03/WebGL学习系列-three-js入门/</id>
    <published>2017-11-03T04:21:26.000Z</published>
    <updated>2019-11-13T07:34:33.611Z</updated>
    
    <content type="html"><![CDATA[<p>被webGL吓得赶紧投入到three.js的怀抱，发现一个最简单的会旋转的正方型，只需10+就搞定了！<br>好的，那我们还是先学习three.js吧~~ 我的目的是先学会怎么制造3d的内容，至于渲染优化什么的目前我还不需要，所以先放弃读webGL的api。<br>先看three.js的基础知识。</p><h2 id="三大组件"><a href="#三大组件" class="headerlink" title="三大组件"></a>三大组件</h2><p>在Three.js中，要渲染物体到网页中，我们需要3个组建：<code>场景（scene）</code>、<code>相机（camera）</code>和<code>渲染器（renderer）</code>。有了这三样东西，才能将物体渲染到网页中去。  </p><h3 id="场景（scene）"><a href="#场景（scene）" class="headerlink" title="场景（scene）"></a><code>场景（scene）</code></h3><p>用<code>THREE.Scene</code>来表示。场景是所有物体的容器。每一个three.js 构造的3d内容，都需要在一个scene中。  </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</span><br></pre></td></tr></table></figure><h3 id="相机（camera）"><a href="#相机（camera）" class="headerlink" title="相机（camera）"></a><code>相机（camera）</code></h3><p>用<code>THREE.PerspectiveCamera(param)</code> 生成。相机决定了场景中哪个角度的景色会显示出来。相机就像人的眼睛一样，人站在不同位置，抬头或者低头都能够看到不同的景色。场景只有一种，但是相机却又很多种。要根据不同的场景选择不同的相机。 之后会介绍不同的相机。  </p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var camera = <span class="keyword">new</span> THREE.<span class="constructor">PerspectiveCamera(75, <span class="params">window</span>.<span class="params">innerWidth</span><span class="operator">/</span><span class="params">window</span>.<span class="params">innerHeight</span>, 0.1, 1000)</span>;</span><br></pre></td></tr></table></figure><h3 id="渲染器（renderer）"><a href="#渲染器（renderer）" class="headerlink" title="渲染器（renderer）"></a><code>渲染器（renderer）</code></h3><p>用<code>THREE.WebGLRenderer()</code>生成。渲染器决定了渲染的结果应该画在页面的什么元素上面，并且以怎样的方式来绘制。renderer有一些自己的方法和属性，如<code>setSize()</code>, <code>domElement</code>，可以用于场景的展示。<br>渲染应该使用渲染器，结合相机和场景来得到结果画面。实现这个功能的函数是:  </p><p><code>render( scene, camera, renderTarget, forceClear )</code></p><p>各个参数的意义是：<br>scene：前面定义的场景<br>camera：前面定义的相机<br>renderTarget：渲染的目标，默认是渲染到前面定义的render变量中<br>forceClear：每次绘制之前都将画布的内容给清除，即使自动清除标志autoClear为false，也会清除。  </p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var renderer = <span class="keyword">new</span> THREE.<span class="constructor">WebGLRenderer()</span>;</span><br><span class="line">renderer.set<span class="constructor">Size(<span class="params">window</span>.<span class="params">innerWidth</span>, <span class="params">window</span>.<span class="params">innerHeight</span>)</span>;</span><br><span class="line">document.body.append<span class="constructor">Child(<span class="params">renderer</span>.<span class="params">domElement</span>)</span>;</span><br></pre></td></tr></table></figure><h3 id="light光源-amp-object物体"><a href="#light光源-amp-object物体" class="headerlink" title="light光源 &amp; object物体"></a><code>light</code>光源 &amp; <code>object</code>物体</h3><p>场景什么的都准备好了，上主角吧 ~~  </p><p>一个标准three.js 模板  </p><p>这里我们把物体添加到场景中去。<br>比如我们想添加一个矩形进去，<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> geometry = <span class="built_in">new</span> THREE.CubeGeometry(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">//CubeGeometry(<span class="built_in">width</span>, <span class="built_in">height</span>, depth, segmentsWidth, segmentsHeight, segmentsDepth, materials, sides)</span><br><span class="line"></span><br><span class="line">// 材质</span><br><span class="line"><span class="built_in">var</span> material = <span class="built_in">new</span> THREE.MeshBasicMaterial(&#123;<span class="built_in">color</span>: <span class="number">0x00ff00</span>&#125;);</span><br><span class="line"><span class="built_in">var</span> <span class="built_in">cube</span> = <span class="built_in">new</span> THREE.Mesh(geometry, material); </span><br><span class="line"><span class="built_in">scene</span>.add(<span class="built_in">cube</span>);</span><br></pre></td></tr></table></figure></p><h3 id="场景，相机，渲染器之间的关系"><a href="#场景，相机，渲染器之间的关系" class="headerlink" title="场景，相机，渲染器之间的关系"></a>场景，相机，渲染器之间的关系</h3><p>场景是物体的容器，照相机就是选择场景的一部分，渲染器负责把照相机照下来的场景内容展示到屏幕上。  </p><h2 id="计算机的3D世界"><a href="#计算机的3D世界" class="headerlink" title="计算机的3D世界"></a>计算机的3D世界</h2><p>计算机的3D世界，是由点组成的，两个点组成线，不在一条线上的点组成面，无书面就能构成各种形状的物体，成为网状的模型，叫做mesh模型，在给这个模型贴上皮肤（纹理），那么物体就和现实差不多了。。。  </p><p>three.js 的实现过程  </p><p><strong>创建一个场景</strong><br><code>var scene = new THREE.Scene()</code>;  </p><p><strong>添加一个渲染器</strong><br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">render</span> = new THREE.WebGLRenderer(&#123;</span><br><span class="line">  <span class="keyword">canvas</span>: document.getElementById(<span class="string">'myCanvas'</span>),</span><br><span class="line">  antialias: true</span><br><span class="line">&#125;); <span class="comment">// 抗锯齿属性  </span></span><br><span class="line"><span class="keyword">render</span>.setClearColor(<span class="number">0xffffff</span>); <span class="comment">// 背景色为白色</span></span><br><span class="line"><span class="keyword">render</span>.setSize(<span class="keyword">canvas</span>.style.width, <span class="keyword">canvas</span>.style.height);</span><br></pre></td></tr></table></figure></p><p><strong>创建一个照相机</strong><br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var camera = <span class="keyword">new</span> THREE.<span class="constructor">PerspectiveCamera(45, <span class="params">window</span>.<span class="params">innerWidth</span> <span class="operator">/</span> <span class="params">window</span>.<span class="params">innerHeight</span>, 0.1, 1000)</span>;  </span><br><span class="line">   </span><br><span class="line"><span class="comment">//设置相机朝向位置为(20,0,20) </span></span><br><span class="line">camera.look<span class="constructor">At(<span class="params">new</span> THREE.Vector3(20, 0, 20)</span>);</span><br></pre></td></tr></table></figure></p><p><strong>创建光</strong>  </p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xffffff</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//使用 Scene()的add方法将light添加到Scene中  </span></span><br><span class="line">scene.<span class="keyword">add</span>(light);</span><br></pre></td></tr></table></figure><p><strong>创建一个物体</strong>  </p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//物体三维图形</span></span><br><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="type">THREE</span>.CubeGeometry(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>); </span><br><span class="line">    </span><br><span class="line"><span class="comment">//物体材质 </span></span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="type">THREE</span>.MeshBasicMaterial(&#123;  </span><br><span class="line">  color: <span class="type">0x4d6dad  </span></span><br><span class="line"><span class="type"></span>&#125;);  </span><br><span class="line"><span class="comment">//生成三维物体</span></span><br><span class="line"><span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="type">THREE</span>.Mesh(geometry, material); </span><br><span class="line">mesh.position.<span class="keyword">set</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 Scene()的add方法将mesh添加到Scene中</span></span><br><span class="line">scene.add(mesh);</span><br></pre></td></tr></table></figure><p><strong>创建一个物体</strong>  </p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染场景  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">render</span>.<span class="keyword">render</span>(scene, <span class="keyword">camera</span>);</span><br></pre></td></tr></table></figure><h3 id="右手坐标系"><a href="#右手坐标系" class="headerlink" title="右手坐标系"></a>右手坐标系</h3><p>threejs使用右手坐标系，x轴正方向向右，y轴正方向向上，z轴由屏幕从里向外。如下：  </p><p><img src="./axis.png" width="200px"></p><h3 id="坐标系的点"><a href="#坐标系的点" class="headerlink" title="坐标系的点"></a>坐标系的点</h3><p>联系原来学的几何，空间几何中，点可以用一个向量表示。那么在three.js中，可以用如下代码表示一个点：  假设一个点：(3,4,5)  </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> point = new THREE.Vector(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pointer = new THREE.Vector();</span><br><span class="line">pointer.<span class="keyword">set</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br></pre></td></tr></table></figure><h3 id="两点生成线"><a href="#两点生成线" class="headerlink" title="两点生成线"></a>两点生成线</h3><p>以两个点生成一条渐变的彩色线为例:  完整实例参考<code>line-three.html</code></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initObject</span></span>() &#123;</span><br><span class="line">  <span class="comment">// 声明一个几何体geometry， 几何体里面有一个vertices变量，可以用来存放点。</span></span><br><span class="line">  <span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="type">THREE</span>.Geometry();</span><br><span class="line">  <span class="comment">// 定义线条材质，`LineBasicMaterial` 是有多个参数的，这个之后了解吧。这里就是定义线条材质是否使用顶点颜色，这是一个boolean值。意思是，线条各部分的颜色会根据顶点的颜色来进行插值</span></span><br><span class="line">  <span class="keyword">var</span> material = <span class="keyword">new</span> <span class="type">THREE</span>.LineBasicMaterial( &#123; vertexColors: <span class="type">true </span>&#125; );</span><br><span class="line">  <span class="comment">// 颜色，用于两个端点颜色。</span></span><br><span class="line">  <span class="keyword">var</span> color1 = <span class="keyword">new</span> <span class="type">THREE</span>.Color( <span class="number">0x444444</span> ), color2 = <span class="keyword">new</span> <span class="type">THREE</span>.Color( <span class="number">0xFF0000</span> ); </span><br><span class="line">  <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="type">THREE</span>.Vector3( <span class="number">-100</span>, <span class="number">0</span>, <span class="number">100</span> );</span><br><span class="line">  <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="type">THREE</span>.Vector3(  <span class="number">100</span>, <span class="number">0</span>, <span class="number">-100</span> );</span><br><span class="line">  geometry.vertices.push(p1);</span><br><span class="line">  geometry.vertices.push(p2);</span><br><span class="line">  <span class="comment">// 为上面两个顶点，设置两个颜色。</span></span><br><span class="line">  geometry.colors.push( color1, color2 );</span><br><span class="line">  <span class="comment">// 第一个参数是几何体geometry，里面包含了2个顶点和顶点的颜色。第二个参数是线条的材质，或者是线条的属性，表示线条以哪种方式取色。第三个参数是一组点的连接方式</span></span><br><span class="line">  <span class="keyword">var</span> line = <span class="keyword">new</span> <span class="type">THREE</span>.Line( geometry, material, THREE.LineSegments );</span><br><span class="line">  scene.add(line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线的更多理解"><a href="#线的更多理解" class="headerlink" title="线的更多理解"></a>线的更多理解</h3><p>threejs中，线是由点，材质，颜色组成的。<br><code>THREE.Vector</code>是点，但是threejs中没有提供单独画点的函数，所以要用THREE.Geometry来画，该结构有vertices属性，用来存放顶点。<br>材质的话，可以选择专为线准备的材质，THREE.LineBasicMaterial。<br>最后通过THREE.Line绘制了一条线。<br><code>new THREE.Line( geometry, material, THREE.LineSegments )</code>  </p><p>如果想绘制一个网格线。那么思路就是，先定义一个长度为1000的x方向上的线，然后。将线均分为20份，每一条分别加一个y方向的位移。另一方面，垂直的线我们需要沿z方向旋转x轴上的线，然后在x方向上平移。  完整实例参考 <code>grid-three.html</code></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function initObject(<span class="built_in">scene</span>) &#123;</span><br><span class="line">  <span class="built_in">var</span> geometry = <span class="built_in">new</span> THREE.Geometry();</span><br><span class="line">  <span class="built_in">var</span> p1 = <span class="built_in">new</span> THREE.Vector3( -<span class="number">500</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">var</span> p2 = <span class="built_in">new</span> THREE.Vector3(  <span class="number">500</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  geometry.<span class="built_in">vertices</span>.<span class="built_in">push</span>(p1);</span><br><span class="line">  geometry.<span class="built_in">vertices</span>.<span class="built_in">push</span>(p2);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">var</span> material = <span class="built_in">new</span> THREE.LineBasicMaterial(&#123; <span class="built_in">color</span>: <span class="number">0x800080</span>, <span class="built_in">opacity</span>: <span class="number">0.6</span>&#125;);</span><br><span class="line">  <span class="keyword">for</span> ( <span class="built_in">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">20</span>; i ++ ) &#123;</span><br><span class="line">    <span class="built_in">var</span> line = <span class="built_in">new</span> THREE.Line( geometry, material );</span><br><span class="line">    line.<span class="built_in">position</span>.y = ( i * <span class="number">50</span> ) - <span class="number">500</span>;</span><br><span class="line">    <span class="built_in">scene</span>.add( line );</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">var</span> line = <span class="built_in">new</span> THREE.Line( geometry, material);</span><br><span class="line">    line.<span class="built_in">position</span>.x = ( i * <span class="number">50</span> ) - <span class="number">500</span>;</span><br><span class="line">    // 将x轴方向的线，沿着z轴旋转<span class="number">90</span>度，就变成了垂直的线~~</span><br><span class="line">    line.rotation.z = <span class="number">90</span> * Math.PI / <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scene</span>.add( line );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>所有代码示例，可以参考这里<a href="https://github.com/MissSweety/threejs" target="_blank" rel="noopener">code</a>;<br>英文参考：<a href="https://www.script-tutorials.com/category/html5-2/page/2/" target="_blank" rel="noopener">webgl with three.js</a><br>实战参考： <a href="https://teakki.com/p/58a3c1c4f0d40775548c8e9b" target="_blank" rel="noopener">dragon/three.js</a><br>实例参考：<a href="https://aotu.io/notes/2017/08/28/getting-started-with-threejs/index.html" target="_blank" rel="noopener">参考1</a><br>实例参考：<a href="http://www.myjscode.com/page/articleThree.html" target="_blank" rel="noopener">参考2</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;被webGL吓得赶紧投入到three.js的怀抱，发现一个最简单的会旋转的正方型，只需10+就搞定了！&lt;br&gt;好的，那我们还是先学习three.js吧~~ 我的目的是先学会怎么制造3d的内容，至于渲染优化什么的目前我还不需要，所以先放弃读webGL的api。&lt;br&gt;先看th
      
    
    </summary>
    
    
      <category term="three.js" scheme="https://akijiangrou.github.io/tags/three-js/"/>
    
      <category term="webGL" scheme="https://akijiangrou.github.io/tags/webGL/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>WebGL学习系列-基础篇</title>
    <link href="https://akijiangrou.github.io/2017/11/01/WebGL%E5%AD%A6%E4%B9%A0%E7%B3%BB%E5%88%97-%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <id>https://akijiangrou.github.io/2017/11/01/WebGL学习系列-基础篇/</id>
    <published>2017-11-01T03:38:12.000Z</published>
    <updated>2017-11-06T09:13:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>一直对图形之类的很喜欢，之后每天学习一点WEBGL相关的内容，明年也做出来一些3D动画网站就可以啦~~  </p><blockquote><p>[参考网站]<br><a href="http://www.glprogramming.com/red/" target="_blank" rel="noopener">OpenGL 编程指南</a><br>MOZILA <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API" target="_blank" rel="noopener">webGL</a><br><a href="http://www.yiibai.com/webgl/html5_canvas_overview.html#article-start" target="_blank" rel="noopener">WebGL中文教程</a><br><a href="http://www.hewebgl.com/" target="_blank" rel="noopener">three.js</a><br><a href="http://www.hiwebgl.com/?p=42" target="_blank" rel="noopener">中文教程</a><br><a href="https://www.script-tutorials.com/category/html5-2/page/2/" target="_blank" rel="noopener">webgl with three.js</a></p></blockquote><h2 id="WebGL-Web图形库"><a href="#WebGL-Web图形库" class="headerlink" title="WebGL (Web图形库)"></a>WebGL (Web图形库)</h2><p>是一种JavaScript API，用于在任何兼容的Web浏览器中呈现交互式3D和2D图形，而无需使用插件。WebGL通过引入一个与OpenGL ES 2.0紧密相符合的API，可以在HTML5 <code>&lt;canvas&gt;</code>元素中使用。</p><h3 id="和canvas的关系"><a href="#和canvas的关系" class="headerlink" title="和canvas的关系"></a>和canvas的关系</h3><p>WebGL需要通过canvas来进行渲染，通过在getContext方法中传入，webgl相关字段，获取html中的画布。’webgl’ 或者 ‘experimental-webgl’ 都可以。  </p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'my_canvas'</span>);</span><br><span class="line"><span class="keyword">var</span> gl = canvas.getContext(<span class="string">'experimental-webgl'</span>);</span><br></pre></td></tr></table></figure><h2 id="WebGL相关知识基础"><a href="#WebGL相关知识基础" class="headerlink" title="WebGL相关知识基础"></a>WebGL相关知识基础</h2><h3 id="WebGL坐标系"><a href="#WebGL坐标系" class="headerlink" title="WebGL坐标系"></a>WebGL坐标系</h3><p>在WebGL的坐标被限制为(1,1,1)和(-1，-1，- 1)。<br>坐标系如下：<br><img src="./pic1.png" width="300px">  </p><h3 id="坐标"><a href="#坐标" class="headerlink" title="坐标"></a>坐标</h3><p>用显示器上单位度量出的数值起初叫做<code>物理设备坐标</code>或者叫<code>设备坐标</code>。对于光栅设备，我们使用的术语是<code>窗口坐标</code>或者<code>屏幕坐标</code>。屏幕坐标总是用某种整数类型来表示，因为帧缓存中任何像素中心都必须位于固定的网格点上。</p><h3 id="WebGL颜色系统"><a href="#WebGL颜色系统" class="headerlink" title="WebGL颜色系统"></a>WebGL颜色系统</h3><p>webgl采用rgba的四色系统来定义颜色。与我们平时所用的颜色系统不一样的是，RGBA四个分量使用0.0~0.1之间的数值来表示。前三个分量表示三原色的饱和度，最后一个表示不透明度。  </p><h3 id="清屏clearColor"><a href="#清屏clearColor" class="headerlink" title="清屏clearColor"></a>清屏clearColor</h3><p>一般canvas都会使用一个颜色填充来清理画布。 WebGL也需要清屏，一般初始化步骤如下  </p>  <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置清除颜色(蓝色，不透明)</span></span><br><span class="line"><span class="keyword">gl</span>.clearColor(0.0, 1.0, 1.0, 1.0);</span><br><span class="line"><span class="comment">// 深度清理</span></span><br><span class="line"><span class="keyword">gl</span>.clearDepth(1.0);</span><br><span class="line"><span class="comment">//  开启“深度测试”, Z-缓存</span></span><br><span class="line"><span class="keyword">gl</span>.enable(<span class="keyword">gl</span>.DEPTH_TEST);</span><br><span class="line"><span class="comment">// 设置深度测试，近的物体遮挡远的物体</span></span><br><span class="line"><span class="keyword">gl</span>.depthFunc(<span class="keyword">gl</span>.LEQUAL);</span><br><span class="line"><span class="comment">// 清理画布</span></span><br><span class="line"><span class="keyword">gl</span>.<span class="keyword">clear</span>(<span class="keyword">gl</span>.COLOR_BUFFER_BIT);</span><br></pre></td></tr></table></figure><h3 id="基本图元"><a href="#基本图元" class="headerlink" title="基本图元"></a>基本图元</h3><p>在webgl中，所有的几何图元都是由点、线段和三角形这样的基本图元组成。<br>webgl 提供了多种点和线段图元，相应的type参数如下  </p><ul><li>点（<code>gl.POINTS</code>）:每个顶点被显示的大小至少是一个像素。</li><li>线段（<code>gl.LINES</code>）:这种图元把相继的顶点配对后解释为线段的两个端点（两两配对）。</li><li>折线（<code>gl.LINE_STRIP</code>,<code>gl.LINE_LOOP</code>）想要让相继的顶点相连，可以使用折线图元。曲线可以通过合适的折线来近似。如果希望折线闭合，可以吧最后一个顶点设置与第一个顶点重合，也可以使用<code>gl.LINE_LOOP</code>类型，它会在最后一个顶点和第一个顶点之间画一条线，得到一个环路。</li><li>三角形（<code>gl.TRIANGLE</code>）:相继的三个顶点组合在一起</li><li>三角形条带和三角形扇（<code>gl.TRIANGLE_STRIP</code>,<code>gl.TRIANGEL_FAN</code>）: 前者就是每三个点连接成一个三角形。后面是每两个分别与0号点形成三角形。</li><li><p>多边形 (<code>GL_POLYGON</code>, <code>GL_QUADS</code>, <code>GL_QUAD_STRIP</code>)  </p><p><img src="./pic2.png" width="500px"></p></li></ul><h3 id="着色器"><a href="#着色器" class="headerlink" title="着色器"></a>着色器</h3><p>一旦创建WEBGL上下文成功，你就可以在这个上下文里渲染画图了。着色器使用ES SL(嵌入式系统着色语言）在GPU上运行，语言类似C语言。在js中，我们可以写成字符串交由底层处理。同样使用script标签保存这些代码字符也是可行的。着色器来渲染我们的简单场景并画出我们的物体。个人理解是，js存一些信息，将内容交给硬件去绘制和呈现。  分为顶点着色器，片元着色器。  </p><ul><li><p>片段着色器：  在 WebGL 多边形中的每一个像素都叫一个片段。这个片段着色器的工作就是建立每个像素的色彩。在这个案例中，我们会简单地给每个像素填上白色。<br>gl_FragColor 是一个 GL 内置的特殊变量，用于片段的色彩填充。如下所示，设定它的值就是设定每个像素的颜色。</p><pre><code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"shader-fs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-fragment"</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">void</span> main(<span class="keyword">void</span>) &#123;</span></span><br><span class="line">    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></code></pre></li><li><p>顶点着色器：  顶点着色器定义了每个顶点的位置和形状。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"shader-vs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-vertex"</span>&gt;</span></span><br><span class="line">  attribute vec3 aVertexPosition;</span><br><span class="line"></span><br><span class="line">  uniform mat4 uMVMatrix;</span><br><span class="line">  uniform mat4 uPMatrix;</span><br><span class="line">  </span><br><span class="line"><span class="actionscript">  <span class="keyword">void</span> main(<span class="keyword">void</span>) &#123;</span></span><br><span class="line">    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h2><p>mdn 官网上的例子， <a href="https://github.com/mdn/webgl-examples/blob/gh-pages/tutorial/sample3/webgl-demo.js" target="_blank" rel="noopener">戳这里</a><br>写了150+行，还是缺少一些方法，<br>很繁琐，而且基本都是重复性的内容，难道没有更容易写的3d代码？ duangduangduang~</p><h2 id="three-js"><a href="#three-js" class="headerlink" title="three.js"></a>three.js</h2><p>看了webgl的接口什么的，用它实现一个简单图形，太复杂繁琐了。赶紧使用three.js 吧。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一直对图形之类的很喜欢，之后每天学习一点WEBGL相关的内容，明年也做出来一些3D动画网站就可以啦~~  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[参考网站]&lt;br&gt;&lt;a href=&quot;http://www.glprogramming.com/red/&quot; target=&quot;_
      
    
    </summary>
    
    
      <category term="webGL" scheme="https://akijiangrou.github.io/tags/webGL/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>redux源码相关</title>
    <link href="https://akijiangrou.github.io/2017/10/26/redux%E6%BA%90%E7%A0%81%E7%9B%B8%E5%85%B3/"/>
    <id>https://akijiangrou.github.io/2017/10/26/redux源码相关/</id>
    <published>2017-10-26T13:19:25.000Z</published>
    <updated>2017-10-27T09:38:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="redux源码阅读"><a href="#redux源码阅读" class="headerlink" title="redux源码阅读"></a>redux源码阅读</h1><p>redux源码很少，重点在思想。  </p><h2 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h2><blockquote><p>function createStore(reducer, preloadedState, enhancer)</p></blockquote><p>reducer是唯一必传的参数，它很重要，因为它决定了整个state。preloadedState就是state的初始值。第三个参数不是特别常用，它是个函数，如果它存在的情况下，会执行下面的语句：</p><p><code>enhancer(createStore)(reducer, preloadedState)</code></p><p>enhancer 增强createStore。</p><p>createStore内部维护：  </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentReducer = reducer</span><br><span class="line"><span class="keyword">var</span> currentState = preloadedState</span><br></pre></td></tr></table></figure><h3 id="function-subscribe-listener"><a href="#function-subscribe-listener" class="headerlink" title="function subscribe(listener)"></a>function subscribe(listener)</h3><p>在createStore内部维护了两个数组currentListeners、nextListeners。nextListeners的存在是为了避免在listeners执行过程中，listeners发生改变，导致错误。listeners的添加或删除都是对nextListeners进行操作的。nextListeners 初始等于 currentListeners = [];</p><p>每次subscribe 都会判定下nextListeners === currentListeners是否相等。</p><p>每次执行substribe 都会返回function unsubscribe()，取消监听。  </p><h3 id="function-dispatch-action"><a href="#function-dispatch-action" class="headerlink" title="function dispatch(action)"></a>function dispatch(action)</h3><p>currentState = currentReducer(currentState, action)</p><p>有dispatch，就一定执行currentReducer。<br>以及</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var listeners = currentListeners = nextListeners</span><br><span class="line"><span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; listeners.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</span><br><span class="line">  listeners[<span class="built_in">i</span>]()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> action</span><br></pre></td></tr></table></figure><p>调用subscribe传进来的listeners，按顺序执行它们，没有任何条件判断，也就是说只要执行dispatch，所有的listeners都会执行，不管state有没有发生改变，而且listeners执行的时候是没参数的。</p><p>而且，在创建store的时候，会  </p><h3 id="function-getState"><a href="#function-getState" class="headerlink" title="function getState()"></a>function getState()</h3><p>return currentState</p><p>每次都返回currentState</p><p><code>dispatch({ type: ActionTypes.INIT })</code></p><h3 id="function-replaceReducer-nextReducer"><a href="#function-replaceReducer-nextReducer" class="headerlink" title="function replaceReducer(nextReducer)"></a>function replaceReducer(nextReducer)</h3><p>currentReducer = nextReducer<br>dispatch({ type: ActionTypes.INIT })</p><p>直接拿nextReducer替换掉前面说很重要的currentReducer，后面再执行dispatch，action就会被nextReducer处理，处理的结果赋值给currentState。替换之后会执行一遍初始化action。</p><p>重点是：currentState，currentReducer，nextListeners；</p><h2 id="bindActionCreator"><a href="#bindActionCreator" class="headerlink" title="bindActionCreator"></a>bindActionCreator</h2><p><code>function bindActionCreators(actionCreators, dispatch)</code></p><p>如果actionCreators是函数，直接返回<br><code>(...args) =&gt; dispatch(actionCreator(...args))</code>；</p><p>如果是对象，则对每一个key，进行上面的转化，最后返回一个函数集合的对象。</p><h2 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h2><p><code>function combineReducers(reducers)</code></p><p>它接收的参数reducers是个对象，对象的value不能是undefined，必须是function。符合这个标准的reducer会被放入finalReducers中。<br>然后再对finalReducers进行校验，reducer必须有default处理，不能处理Redux内部的action type，比如@@redux/INIT。然后返回一个函数combination(state = {}, action)，它也是一个reducer，可以被再次和其他reducer combine。一般combination等同于currentReducer，它的返回结果会赋给state，combination的关键代码如下：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> hasChanged = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">var</span> nextState = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">var</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.<span class="built_in">length</span>; i++) &#123;</span><br><span class="line">      <span class="built_in">var</span> <span class="built_in">key</span> = finalReducerKeys[i]</span><br><span class="line">      <span class="built_in">var</span> reducer = finalReducers[<span class="built_in">key</span>]</span><br><span class="line">      <span class="built_in">var</span> previousStateForKey = state[<span class="built_in">key</span>]</span><br><span class="line">      <span class="built_in">var</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line">      <span class="keyword">if</span> (typeof nextStateForKey === 'undefined') &#123;</span><br><span class="line">        <span class="built_in">var</span> errorMessage = getUndefinedStateErrorMessage(<span class="built_in">key</span>, action)</span><br><span class="line">        <span class="built_in">throw</span> <span class="built_in">new</span> Error(errorMessage)</span><br><span class="line">      &#125;</span><br><span class="line">      nextState[<span class="built_in">key</span>] = nextStateForKey</span><br><span class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> hasChanged ? nextState : state</span><br></pre></td></tr></table></figure><p>reducer从state中拿到对应的state，然后把返回的数据组装到state的对应位置(nextState[key] = nextStateForKey)</p><h2 id="applyMiddleware"><a href="#applyMiddleware" class="headerlink" title="applyMiddleware"></a>applyMiddleware</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span><span class="params">(<span class="rest_arg">...middlewares</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> store = createStore(reducer, preloadedState, enhancer)</span><br><span class="line">    <span class="keyword">var</span> dispatch = store.dispatch</span><br><span class="line">    <span class="keyword">var</span> chain = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: (action) =&gt; dispatch(action)</span><br><span class="line">    &#125;</span><br><span class="line">    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>applyMiddleWARE, 返回的其实是createStore，来增强dispatch。常用的thunkMiddleware，强化dispatch，可以传递函数，不一定是object。</p><p>一般使用的时候，是如下调用的，以thunkmiddleware为例：</p><p>thunkMiddleware 如下： </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回以 dispatch 和 getState 作为参数的action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">thunkMiddleware</span>(<span class="params">&#123; dispatch, getState &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> action(dispatch, getState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next(action);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"><span class="keyword">import</span> &#123;createStore, applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunkMiddleware <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(</span><br><span class="line">      reducers,</span><br><span class="line">      state,</span><br><span class="line">      applyMiddleware(thunkMiddleware)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>相当于有了enhancer，<br>上面store 会按如下执行：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createStore.js</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> enhancer(createStore)(reducer, initialState)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ||<br>\/</p><p><code>applyMiddleware(thunkMiddleware)(createStore)(reducer, initialState)</code></p><p>||<br>\/</p><p>applyMiddleware(thunkMiddleware) 返回<code>(createStore) =&gt; (reducer, initialState, enhancer) =&gt; {}</code>的函数。</p><p>继续，把createStore这个函数，传给上面的函数，然后继续执行。</p><p>在中间件代码中的，map部分，开始执行thunkMiddleware，其实就是对dispatch的封装，因为倒数第二步是：<br>chain = middlewares.map(middleware =&gt; middleware(middlewareAPI));<br>dispatch = compose(…chain)(store.dispatch);</p><p>chain = [(next) =&gt; (action) =&gt; {…}];</p><p>dispatch = compose((next) =&gt; (action) =&gt; {…})(store.dispatch);</p><p>dispatch = store.dispatch(action) =&gt; {…};</p><p>最终{} 内部就是监测type是function的action</p><p>因此，如果dispatch的action返回的是一个function，则证明是中间件，则将(dispatch, getState)作为参数代入其中，进行action 内部下一步的操作。否则的话，认为只是一个普通的action，将通过next(也就是dispatch)进一步分发。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;redux源码阅读&quot;&gt;&lt;a href=&quot;#redux源码阅读&quot; class=&quot;headerlink&quot; title=&quot;redux源码阅读&quot;&gt;&lt;/a&gt;redux源码阅读&lt;/h1&gt;&lt;p&gt;redux源码很少，重点在思想。  &lt;/p&gt;
&lt;h2 id=&quot;createStore
      
    
    </summary>
    
    
      <category term="js" scheme="https://akijiangrou.github.io/tags/js/"/>
    
      <category term="redux" scheme="https://akijiangrou.github.io/tags/redux/"/>
    
      <category term="源码" scheme="https://akijiangrou.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>child_process</title>
    <link href="https://akijiangrou.github.io/2017/10/25/child-process/"/>
    <id>https://akijiangrou.github.io/2017/10/25/child-process/</id>
    <published>2017-10-25T11:45:20.000Z</published>
    <updated>2017-10-26T10:31:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>子进程<code>child_process</code>，使node可以在进程中执行操作，应用系统命令等。nodejs创建子进程有四种方法,分别是</p><blockquote><p>spawn<br>fork<br>exec<br>execFile。</p></blockquote><p>后两个函数有回调函数。前两个没有。其中spawn 是最基本的函数，剩下三个其实都是不同程度的封装。</p><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>child_process 会在父进程和衍生的子进程中建立stdin、stdout和stderr的管道。数据能以非阻塞的方式在管道中流通。</p><h2 id="四个api"><a href="#四个api" class="headerlink" title="四个api"></a>四个api</h2><p>官网里对这四个指令的解释：<br><code>spawn</code>: 异步衍生一个子进程，不阻塞node.js 事件循环。  </p><p><code>fork</code>: 衍生一个新的 Node.js 进程，并通过建立一个 IPC 通讯通道来调用一个指定的模块，该通道允许父进程与子进程之间相互发送信息。  </p><p><code>exec</code>:衍生一个 shell 并在 shell 上运行命令，当完成时会传入 stdout 和 stderr 到回调函数。  </p><p><code>execFile</code>: 直接衍生命令，且无需先衍生一个 shell。 </p><p>简单说说<code>exec</code>与<code>spawn</code>的区别：  </p><ul><li>exec可以方便的使用复杂的shell命令，而spawn需要拆分shell指令，写在数组参数里。  </li><li>exec是将进程输出结果放在buffer中，结果完全返回后，在一次性的将其以回调函数的形式返回给node，这个可能会因为返回过大，超过buffersize而报错。</li><li>相反的，spawn从子进程开始执行后，就开始不断将数据从子进程返回给主进程，它通过流的方式发数据传给主进程，从而实现了多进程之间的数据交换。  </li><li>总结：如果只是想看运行结果，用exec；需要执行结果的数据，最好用spawn。  </li></ul><h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><p><code>child_process.spawn(command, [args], [options])</code>  </p><p>command : 主命令<br>args : 其他参数，以及副命令<br>options: 见<a href="http://nodejs.cn/api/child_process.html#child_process_child_process_spawn_command_args_options" target="_blank" rel="noopener">文档</a>中的定义  </p><p>// hellow.js</p><pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"> <span class="comment">// 主命令ls为第一个参数，辅助命令以及路径等参数，都放在参数数组里。</span></span><br><span class="line"><span class="keyword">const</span> ls = spawn(<span class="string">'ls'</span>, [<span class="string">'-lh'</span>, <span class="string">'/usr'</span>]);</span><br><span class="line"></span><br><span class="line">ls.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ls.stderr.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`stderr: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ls.on(<span class="string">'close'</span>, (code) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`child process exited with code <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></code></pre><p>运行：<br>node hellow.js </p><p>等价于运行：<br>ls -lh /usr</p><p>输出如下：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stdout: total 0</span><br><span class="line">drwxr-xr-x  1066 root  wheel    35K 10  8 19:37 bin  </span><br><span class="line">drwxr-xr-x   283 root  wheel   9.4K 10  8 19:37 lib  </span><br><span class="line">drwxr-xr-x   212 root  wheel   7.0K 10  8 20:27 libexec  </span><br><span class="line">drwxr-xr-x    23 root  wheel   782B  3 25  2017 local  </span><br><span class="line">drwxr-xr-x   246 root  wheel   8.2K 10  8 19:36 sbin  </span><br><span class="line">drwxr-xr-x    46 root  wheel   1.5K  3 25  2017 share  </span><br><span class="line">drwxr-xr-x     5 root  wheel   170B 12 13  2016 standalone  </span><br><span class="line"></span><br><span class="line">child process exited with code 0</span><br></pre></td></tr></table></figure></p><p>example2 模拟ps ax | grep ssh </p><pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">const</span> ps = spawn(<span class="string">'ps'</span>, [<span class="string">'ax'</span>]);</span><br><span class="line"><span class="keyword">const</span> grep = spawn(<span class="string">'grep'</span>, [<span class="string">'ssh'</span>]);</span><br><span class="line"></span><br><span class="line">ps.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  grep.stdin.write(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ps.stderr.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`ps stderr: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ps.on(<span class="string">'close'</span>, (code) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`wrong ps process exited with code <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  grep.stdin.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">grep.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">grep.stderr.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`grep stderr: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">grep.on(<span class="string">'close'</span>, (code) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`wrong grep process exited with code <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`ps process exited with code <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></code></pre><p>输出<br>    <figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1915 </span>  ??  S      <span class="number">0</span>:<span class="number">00.03</span> /<span class="keyword">usr</span>/bin/ssh-agent -l</span><br></pre></td></tr></table></figure></p><p>执行  ps ax | grep ssh  </p><pre><code><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1915 </span>  ??  S      <span class="number">0</span>:<span class="number">00.03</span> /<span class="keyword">usr</span>/bin/ssh-agent -l</span><br><span class="line"><span class="symbol">57189 </span>s009  S+     <span class="number">0</span>:<span class="number">00.00</span> grep --<span class="keyword">color</span>=<span class="keyword">auto</span> --exclude-dir=.bzr --exclude-dir=<span class="keyword">CVS</span> --exclude-dir=.git --exclude-</span><br></pre></td></tr></table></figure></code></pre><p>shell这个会有两条，是因为后面这个是上面寻找的这条shell的进程  </p><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><p><code>child_process.exec(command[, options][, callback])</code><br>回调函数参数如下：  </p><ul><li>error  </li><li>stdout  </li><li>stderr   </li></ul><p>stdout &amp; stderr 就是shell执行后返回的内容，格式默认为utf-8编码的string，可以在options中设置编码方式<code>{encoding: &#39;utf-8&#39;}</code> 。注意<code>maxBuffer: 200 * 1024</code>, 所以如果返回的结果过大，请不要使用exec，会使语句执行错误。</p><p>在node v8版本中，可以使用util中的promisify对exec函数进行封装，如果出现error，则直接reject；其他两个作为promise的两个属性，如下代码：  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">const</span> exec = util.promisify(<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">lsExample</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; stdout, stderr &#125; = <span class="keyword">await</span> exec(<span class="string">'ls'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'stdout:'</span>, stdout);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'stderr:'</span>, stderr);</span><br><span class="line">&#125;</span><br><span class="line">lsExample();</span><br></pre></td></tr></table></figure><p>exec中写复杂的shell语句比较方便。与上面的 spawn进行ps方法的比较：  </p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exec(<span class="string">'ps ax | grep ssh'</span>, (<span class="built_in">error</span>, <span class="built_in">stdout</span>, <span class="built_in">stderr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">error</span>) &#123;</span><br><span class="line">    console.<span class="built_in">error</span>(<span class="string">'exec error'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  console.<span class="built_in">log</span>(`<span class="built_in">stdout</span>: $&#123;<span class="built_in">stdout</span>&#125;`);</span><br><span class="line">  console.<span class="built_in">log</span>(`<span class="built_in">stderr</span>: $&#123;<span class="built_in">stderr</span>&#125;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>但是输出结果会多一条：<br>应该是exec又新开了一个shell导致的。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stdout:  <span class="number">1915</span>   ??  S      <span class="number">0</span>:<span class="number">00.03</span> /usr/bin/ssh-agent -l</span><br><span class="line"><span class="number">69597</span> s008  S+     <span class="number">0</span>:<span class="number">00.00</span> /bin/sh -c ps ax | grep ssh</span><br><span class="line"><span class="number">69599</span> s008  S+     <span class="number">0</span>:<span class="number">00.00</span> grep ssh</span><br></pre></td></tr></table></figure><h3 id="execFile"><a href="#execFile" class="headerlink" title="execFile"></a>execFile</h3><p><code>child_process.execFile(file[, args][, options][, callback])</code></p><p>options，callback与exec一样，但是输入参数，比较费劲。和spawn一样麻烦了。回调函数都是当子进程停止的时候执行。</p><p>execFile是对spawn的封装，多了回调函数。而exec又是对execFile的封装，可以更便利的输入shell指令。</p><p>exec执行的时候，可能会遇到问题，这个时候多是maxBuffer 导致的，所以可以设大这个值。</p><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><p><code>child_process.fork(modulePath[, args][, options])</code></p><p>返回的 ChildProcess 会有一个额外的内置的通信通道，它允许消息在父进程和子进程之间来回传递。可以达到启动多个node进行处理的目的。</p><p>fork中的options有一些不一样的地方：<br><code>silent</code>：<boolean> 默认是false，即子进程的stdio从父进程继承。如果是true，则直接pipe向子进程的child.stdin、child.stdout等。  </boolean></p><p><code>stdio</code>：<array> 如果声明了stdio，则会覆盖silent选项的设置。默认继承父进程的stdio，其实就是父进程所在终端。  </array></p><p>其中 stdio可以设置为文件，<br>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> out = fs.openSync(<span class="string">'./out.log'</span>, <span class="string">'a'</span>); <span class="comment">// out.log 中可以显示child.js 的输出。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> err = fs.openSync(<span class="string">'./err.log'</span>, <span class="string">'a'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = child_process.spawn(<span class="string">'node'</span>, [<span class="string">'child.js'</span>], &#123;</span><br><span class="line">    detached: <span class="literal">true</span>,</span><br><span class="line">    stdio: [<span class="string">'ignore'</span>, out, err]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"><span class="keyword">var</span> times = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(++times * <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">if</span> (times &gt;<span class="number">1000</span>)</span><br><span class="line">    &#123;clearInterval(timer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>如果子进程还在进行，父进程也会一直hold着，这个时候，可以调用子进程的unref()，释放出父进程（parent.js 最后加上 <code>child.unref();</code>注意stdio中参数第一个要设置为ignore, 如上child.js）。但是子进程仍在执行。验证可以在终端执行：<code>ps aux | grep node</code>, 发现会有子进程在进行：<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zzz             <span class="number">70478</span>   <span class="number">0.3</span>  <span class="number">0.1</span>  <span class="number">3094324</span>  <span class="number">24244</span>   ??  Ss    <span class="number">5</span>:<span class="number">28</span>下午   <span class="number">0</span>:<span class="number">00.08</span> node child.js</span><br></pre></td></tr></table></figure></p><h4 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h4><p><code>send</code>：<br>关于父子进程沟通，父进程中，可以调用子进程的send()方法，向子进程发送数据，对应的子进程程序中，调用process.send()方法向父进程发送数据。</p><p>code：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cp = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">const</span> n = cp.fork(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/child.js`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>);</span><br><span class="line"></span><br><span class="line">n.on(<span class="string">'message'</span>, <span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'PARENT got message:'</span>, m);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line"></span><br><span class="line">n.send(&#123; hello: <span class="string">'world'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'4'</span>);</span><br><span class="line">process.on(<span class="string">'message'</span>, <span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'CHILD got message:'</span>, m);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">process.send(&#123; foo: <span class="string">'bar'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'5'</span>);</span><br></pre></td></tr></table></figure><p>child先发送，parent收到结果，然后parent发送，child收到结果。结果如下： </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">node</span> <span class="string">p.js</span>       </span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="attr">PARENT got message:</span> <span class="string">&#123;</span> <span class="attr">foo:</span> <span class="string">'bar'</span> <span class="string">&#125;</span></span><br><span class="line"><span class="attr">CHILD got message:</span> <span class="string">&#123;</span> <span class="attr">hello:</span> <span class="string">'world'</span> <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">```</span>   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">`disconnect`：</span></span><br><span class="line"><span class="string">在父进程中调用</span> <span class="string">subprocess.disconnect()</span> <span class="string">或在子进程中调用</span> <span class="string">process.disconnect()</span> <span class="string">后会触发</span> <span class="string">'disconnect'</span> <span class="string">事件。</span> <span class="string">断开后就不能再发送或接收信息，且</span> <span class="string">subprocess.connected</span> <span class="string">属性会被设为</span> <span class="literal">false</span><span class="string">。</span>  </span><br><span class="line"></span><br><span class="line"><span class="string">code：</span></span><br></pre></td></tr></table></figure><p>// parent.js<br>const cp = require(‘child_process’);<br>const n = cp.fork(<code>${__dirname}/child.js</code>);</p><p>console.log(‘1’);</p><p>n.on(‘message’, (m) =&gt; {<br>    console.log(‘in Parent child is connect’, n.connected);<br>  console.log(‘PARENT got message:’, m);<br>});</p><p>console.log(‘2’);</p><p>n.send({ hello: ‘world’ });<br>n.on(‘disconnect’, () =&gt; {<br>    console.log(‘in parent, child send disconnect signal’, n.connected);<br>})<br>console.log(‘3’);</p><p>// child.js</p><p>console.log(‘4’);<br>process.on(‘message’, (m) =&gt; {<br>  console.log(‘CHILD got message:’, m);<br>  // console.log(‘in child, child send disconnect’);<br>  // process.disconnect();</p><p>});</p><p>process.send({ foo: ‘bar’ });<br>console.log(‘5’);</p><p>process.disconnect();</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出的是：</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>in Parent child is connect true<br>PARENT got message: { foo: ‘bar’ }<br>in parent, child send disconnect signal false</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果把注释打开，最后的disconnect去掉，则会在parent接收到message后，先输出child这边的 `<span class="keyword">in</span> child, child send disconnect`,在输出`<span class="keyword">in</span> parent, child send disconnect signal false` ...</span><br><span class="line"></span><br><span class="line">注意如果child是一个会执行很久的函数，此时他依然是可以在执行的，只是父进程监控不到他了~~~，要注意！如果不想让子进程也执行了，调用kill既可。</span><br><span class="line"></span><br><span class="line">`kill`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 事件：</span></span><br><span class="line">- message</span><br><span class="line">`on(<span class="string">'message'</span>, <span class="keyword">func</span>)` 分别用on方法来监听，对方发送的数据。</span><br><span class="line">- close</span><br><span class="line">- <span class="keyword">exit</span></span><br><span class="line">- disconnect  </span><br><span class="line"></span><br><span class="line">close 和<span class="keyword">exit</span> 当子进程退出的时候都会监控到，两者的结果基本相似。close，是当stdio流关闭时触发。 一般子进程退出了，stdio一定退出了。  </span><br><span class="line"> </span><br><span class="line">对于<span class="keyword">exit</span>，如果子进程是自己退出的，那么code就是退出码，否则为null；如果子进程是通过信号结束的，那么，signal就是结束进程的信号，否则为null。这两者中，一者肯定不为null。</span><br><span class="line"></span><br><span class="line">例子：</span><br></pre></td></tr></table></figure><p>// parent.js</p><p>const cp = require(‘child_process’);<br>const n = cp.fork(<code>${__dirname}/child.js</code>);</p><p>console.log(‘1’);</p><p>n.on(‘message’, (m) =&gt; {<br>    console.log(‘in Parent child is connect’, n.connected);<br>  console.log(‘PARENT got message:’, m);<br>});</p><p>console.log(‘2’);</p><p>n.send({ hello: ‘world’ });<br>n.on(‘exit’, (cc, signal) =&gt; {<br>    console.log(‘in parent, child send exit signal’,cc, signal);<br>})</p><p>n.on(‘close’, (cc, signal) =&gt; {<br>    console.log(‘in parent, child send close signal’, cc, signal);<br>})</p><p>console.log(‘3’);</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>// child.js</p><p>console.log(‘4’);<br>process.on(‘message’, (m) =&gt; {<br>  console.log(‘CHILD got message:’, m);</p><p>});</p><p>process.send({ foo: ‘bar’ });<br>console.log(‘5’);</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">终端运行：` <span class="keyword">node</span> <span class="title">parent</span>.js`</span><br><span class="line">输出：</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>in Parent child is connect true<br>PARENT got message: { foo: ‘bar’ }<br>CHILD got message: { hello: ‘world’ }<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">此时，再开一个终端，使用`ps ax | grep node` 找到child.js 的进程，执行`kill -9 pid` </span><br><span class="line"></span><br><span class="line">原来终端会显示</span><br></pre></td></tr></table></figure></p><p>in parent, child send exit signal null SIGKILL<br>in parent, child send close signal null SIGKILL</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果是在child<span class="selector-class">.js</span> 中故意写一些错误，会监控到<span class="selector-tag">code</span> 为<span class="number">1</span> ，输出：</span><br></pre></td></tr></table></figure><p>in parent, child send exit signal 1 null<br>in parent, child send close signal 1 null</p><p><code>`</code></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://nodejs.org/api/child_process.html#child_process_event_close" target="_blank" rel="noopener">官方文档</a>  </p><p><a href="https://segmentfault.com/a/1190000007735211#articleHeader18" target="_blank" rel="noopener">参考</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;子进程&lt;code&gt;child_process&lt;/code&gt;，使node可以在进程中执行操作，应用系统命令等。nodejs创建子进程有四种方法,分别是&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;spawn&lt;br&gt;fork&lt;br&gt;exec&lt;br&gt;execFile。&lt;/p&gt;
&lt;/b
      
    
    </summary>
    
    
      <category term="js" scheme="https://akijiangrou.github.io/tags/js/"/>
    
      <category term="nodejs" scheme="https://akijiangrou.github.io/tags/nodejs/"/>
    
      <category term="shell" scheme="https://akijiangrou.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>d3-scale</title>
    <link href="https://akijiangrou.github.io/2017/09/21/d3-scale/"/>
    <id>https://akijiangrou.github.io/2017/09/21/d3-scale/</id>
    <published>2017-09-21T06:54:58.000Z</published>
    <updated>2017-09-22T08:59:20.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>scale</code>缩放也叫比例尺。是可视化的基本，使抽象的数据，转换成可视化的代表，比如宽高，位置或者颜色等。</p><h2 id="输入-amp-输出"><a href="#输入-amp-输出" class="headerlink" title="输入 &amp; 输出"></a>输入 &amp; 输出</h2><p><code>scale</code>缩放，其实是一种mapping。<br>将输入的数据转换成对应的想要的输出的数据形式。  </p><p>既然是转换，那就需要输入和输出。</p><p>输入是放入<code>domain</code>函数的参数。<br>输出时放入<code>range</code> 函数的参数。  </p><p><img src="./scale.png" width="400px">  </p><p><strong> 妙记 </strong> ID OR<br>其实每个scale函数返回的都是函数，需要的参数就是实际展示的数据。</p><p>先举几个基本例子：  </p><ul><li><p>人口范围50万-130万  对应 输出长度为 500像素范围。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newRamp = d3.scale.linear().domain([<span class="number">500000</span>,<span class="number">13000000</span>]).range([<span class="number">0</span>, <span class="number">500</span>]);</span><br><span class="line"></span><br><span class="line">newRamp(<span class="number">1000000</span>);   <span class="comment">// return 20;说明，人数为100万时对应长度为20像素</span></span><br><span class="line">newRamp(<span class="number">9000000</span>);</span><br><span class="line">newRamp.invert(<span class="number">313</span>); <span class="comment">// 知道像素长度313px，想知道他对应的人口数。</span></span><br></pre></td></tr></table></figure></li><li><p>人口范围50万-130万  对应 输出颜色 蓝色-红色</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newRamp = d3.scale.linear().domain([<span class="number">500000</span>,<span class="number">13000000</span>]).range([<span class="string">"blue"</span>,</span><br><span class="line"><span class="string">"red"</span>]);</span><br><span class="line"></span><br><span class="line">newRamp(<span class="number">1000000</span>);   <span class="comment">// return #ad0052;说明，人数为100万时对应颜色</span></span><br><span class="line">newRamp(<span class="number">9000000</span>);</span><br><span class="line">newRamp.invert(#ad0052); //NaNinvert适应于输出为数字的比例转换。</span><br></pre></td></tr></table></figure><ul><li>示意： <img src="./continue.png" width="400px"></li></ul></li><li><p>离散型，将一组数据分为三类</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sampleArray = [<span class="number">423</span>,<span class="number">124</span>,<span class="number">66</span>,<span class="number">424</span>,<span class="number">58</span>,<span class="number">10</span>,<span class="number">900</span>,<span class="number">44</span>,<span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> qScale = d3.scale.quantile().domain(sampleArray).range([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]);</span><br><span class="line">qScale(<span class="number">423</span>);  <span class="comment">// 2</span></span><br><span class="line">qScale(<span class="number">20</span>);   <span class="comment">// 0</span></span><br><span class="line">qScale(<span class="number">10000</span>);  <span class="comment">//2</span></span><br></pre></td></tr></table></figure><ul><li>示意：<img src="./quantile.png" width="400px"></li></ul></li></ul><h2 id="scale-分类"><a href="#scale-分类" class="headerlink" title="scale 分类"></a>scale 分类</h2><p>按照我个人的偏好分类如下：</p><blockquote><p>输入输出都连续[linear, power, log]<br>输出离散[quantize scale quantile]<br>输入输出都离散[band, point, ordinal]<br>颜色相关[scaleSequential, category]<br>时间相关[scaleTime 属于连续型]</p></blockquote><h3 id="输入输出都连续"><a href="#输入输出都连续" class="headerlink" title="输入输出都连续"></a>输入输出都连续</h3><ul><li>scaleLinear</li><li>scalePower</li><li>scaleLog</li><li>scaleSqrt</li><li>scaleTime</li><li><p>scaleSequential</p><p>后两个单独做解释。<br><code>线性scaleLinear</code>， 没什么可说的，就是输出与输入呈线性相关。<code>y = ax + b</code><br><code>幂指数scalePower</code>，输出与输入的幂指数呈正相关。<code>y = m * x^k + b</code><br><code>平方根缩放scaleLog</code>，就是幂指数中k = 0.5。关于这个，一般用于使用面积来表达数据值的大小时。所以该scale函数的结果可以作为r的值。<br><code>对数缩放scaleLog</code>， 输出与输入的对数呈正相关。 <code>y = m * log(x) + b</code></p><p>参考代码：<a href="https://github.com/MissSweety/practiceD3" target="_blank" rel="noopener">d3-practice</a></p><p>关于连续型的缩放，还有其他几个参数：  </p></li><li><code>Clamp()</code>：控制当输入超过range的情况。默认是false，如果超过range，则会自动按比例换算成domain以外的值。设为true则会严格控制结果在对应的domain中。</li><li><code>Nice()</code>：主要用在使用真实数据来设置range的时候，<code>d3.extent(data)</code>会自动读取min&amp;max作为范围。但是如果作为坐标轴，可能数据看起来不是很好看，设置成nice()它会自动向上取整。</li><li><code>invert()</code>：可以根据给出的输出值，来计算输入值。【注意】：domain必须是数字类型的</li><li><p><code>range</code>: 支持多个value。同时domain也要输入多个参数。相互为边界，实现缩放。例子：（见下面的多段缩放）  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 位置缩放</span></span><br><span class="line"><span class="keyword">const</span> firstScale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">10</span>])</span><br><span class="line">  .range([<span class="number">0</span>, <span class="number">400</span>]);</span><br><span class="line"><span class="comment">// 面积缩放</span></span><br><span class="line"><span class="keyword">const</span> sqrScale = d3.scaleSqrt()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">10</span>])</span><br><span class="line">  .range([<span class="number">0</span>, <span class="number">40</span>]);</span><br><span class="line"><span class="comment">// 多段缩放</span></span><br><span class="line"><span class="keyword">const</span> fourthScale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>])</span><br><span class="line">  .range([<span class="string">'purple'</span>,<span class="string">'white'</span>, <span class="string">'lightgreen'</span>]);</span><br><span class="line"></span><br><span class="line">canvas.selectAll(<span class="string">'.fourthScale'</span>)</span><br><span class="line">  .data(testData)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'fourthScale'</span>)</span><br><span class="line">  .attr(<span class="string">'r'</span>, d =&gt; sqrScale(d))</span><br><span class="line">  .attr(<span class="string">'cx'</span>, d =&gt; firstScale(d))</span><br><span class="line">  .attr(<span class="string">'cy'</span>, <span class="number">200</span>)</span><br><span class="line">  .attr(<span class="string">'fill'</span>, d =&gt; fourthScale(d));</span><br></pre></td></tr></table></figure></li></ul><p>结果如下：<img src="./scaleMult.png" width="400px"></p><h3 id="输入连续，输出离散"><a href="#输入连续，输出离散" class="headerlink" title="输入连续，输出离散"></a>输入连续，输出离散</h3><ul><li><p>scaleQuantize<br>输入可以是连续范围，输出是离散的值，在range中规定。输入会按照输出数组的长度n分成n份。调用的时候，根据输入判定落在那个区间内，就输出对应的range中的值。<br>例子:  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> quantizeScale = d3.scaleQuantize()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">100</span>])</span><br><span class="line">  .range([<span class="string">'purple'</span>, <span class="string">'pink'</span>, <span class="string">'lightgreen'</span>]);</span><br><span class="line"></span><br><span class="line">quantizeScale(<span class="number">10</span>);   <span class="comment">// returns 'purple'</span></span><br><span class="line">quantizeScale(<span class="number">30</span>);  <span class="comment">// returns 'purple'</span></span><br><span class="line">quantizeScale(<span class="number">90</span>);  <span class="comment">// returns 'lightgreen'</span></span><br></pre></td></tr></table></figure></li><li><p>scaleQuantile<br>与上面类似，但是输入可以是随机的数组，d3会主动将domain中的数组排序，然后按照range的参数长度n来将排序后的输入分成n组，然后，按照下标值将domain内容均分，然后分别对应range中的内容。（当数量不均分时，可通过<code>quantileScale.quantiles()</code>查看边界分类）。 例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myData = [<span class="number">0</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> linearScale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">100</span>])</span><br><span class="line">  .range([<span class="number">0</span>, <span class="number">600</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> quantileScale = d3.scaleQuantile()</span><br><span class="line">  .domain(myData)</span><br><span class="line">  .range([<span class="string">'lightblue'</span>, <span class="string">'orange'</span>, <span class="string">'lightgreen'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(quantileScale.quantiles())  <span class="comment">// [4.666666666666666, 8]</span></span><br><span class="line">d3.select(<span class="string">'#wrapper'</span>)</span><br><span class="line">  .selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .data([<span class="number">0</span>, <span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,<span class="number">10</span>, <span class="number">20</span>])</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'r'</span>, <span class="number">3</span>)</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> linearScale(d);</span><br><span class="line">  &#125;)</span><br><span class="line">  .style(<span class="string">'fill'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> quantileScale(d);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li><li><p>scaleThreshold<br>将domain中的数据映射到range中的颜色或者离散值。其实domain规定的数据的门限值，就是range中范围的分界点。domain中的数组长度要比range的少一位，这样才能将所有数据包含。看例子：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> thresholdScale = d3.scaleThreshold()</span><br><span class="line">  .domain([<span class="number">0</span>, <span class="number">50</span>, <span class="number">100</span>])</span><br><span class="line">  .range([<span class="string">'#purple'</span>, <span class="string">'lightblue'</span>, <span class="string">'orange'</span>, <span class="string">'#red'</span>]);</span><br><span class="line"></span><br><span class="line">thresholdScale(<span class="number">-10</span>);  <span class="comment">// returns '#purple'</span></span><br><span class="line">thresholdScale(<span class="number">20</span>);   <span class="comment">// returns 'lightblue'</span></span><br><span class="line">thresholdScale(<span class="number">70</span>);   <span class="comment">// returns 'orange'</span></span><br><span class="line">thresholdScale(<span class="number">110</span>);  <span class="comment">// returns '#red'</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="输入输出都离散"><a href="#输入输出都离散" class="headerlink" title="输入输出都离散"></a>输入输出都离散</h3><ul><li><p>scaleOrdinal<br>domain和range规定的内容是一一对应的。如果range长度不够，则重复range。如果输入的数据布在domain中，则会将range中的第一个值赋给他。这个可以通过设置<code>.unknown(&#39;xxxx&#39;)</code>来自定义。</p></li><li><p>scaleBand<br>domain规定每个band的值，range中规定整个柱形图的长度，也就是多个柱子和间隙的总和。当输入数据时，会返回对应的柱子的宽度以及起始位置。柱子宽度通过<code>d3.scaleBand().bandwidth()</code>  </p><blockquote><p>bandwidth() 柱子宽度<br>paddingInner() 每个band间的距离<br>paddingOuter() 第一个子band前面的padding和最后一个子band后面padding 之和。<br>常用在柱形图，条形图中。自动生成柱子和间隙的位置。</p></blockquote></li></ul><ul><li><p>scalePoint<br>按照给出的domain将range范围分为对应的n-1份。两边的间隔可以通过<code>d3.scalePoint.padding()</code>来计算。而间隔的值可通过<code>step()</code>获取</p><p>一般输入输出都离散，常用在坐标轴，颜色中。</p></li></ul><h3 id="颜色相关"><a href="#颜色相关" class="headerlink" title="颜色相关"></a>颜色相关</h3><ul><li><p>scaleSequential<br>这个和线性的类似，只不过range是不能配置的，而是通过interpolator()来对应的。其中，插值函数是接收0，1之间的输入，输出两个数字，颜色或者字符之间的插值。<br>这个一般用于热力图等关于颜色的计算中，而且<code>d3</code>规定了一些内置的颜色插值。<a href="https://bl.ocks.org/d3indepth/89ced137bece23b908cf51580d5e082d" target="_blank" rel="noopener">代码参考</a><br>如下图：<br><img src="./interpolate.png" width="500px"></p></li><li><p>category Scales 用于 scaleOrdinal中<br>根据预置的颜色集合，生成具体的颜色块。更多颜色参考：<a href="https://github.com/d3/d3-scale-chromatic" target="_blank" rel="noopener">https://github.com/d3/d3-scale-chromatic</a><br>使用方法：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = d3.scaleOrdinal(d3.schemeCategory10);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">canvas.selectAll(<span class="string">'.test'</span>)</span><br><span class="line">  .data(testData)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'test'</span>)</span><br><span class="line">  .attr(<span class="string">'fill'</span>, d =&gt; color(d));</span><br></pre></td></tr></table></figure></li></ul><h3 id="时间相关"><a href="#时间相关" class="headerlink" title="时间相关"></a>时间相关</h3><ul><li><p>scaleTime<br>主要用于与时间相关的应用上。可以将连续的时间转换成range中的范围，可以是长度颜色等等。<br>可以通过scaleTime获取一些数据，用<code>ticks()</code>。比如想要获取domain中每十天的值，可以使用如下代码：  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timescale = d3.scaleTime()</span><br><span class="line">  .domain([<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2017</span>, <span class="number">7</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2017</span>, <span class="number">9</span>, <span class="number">1</span>)])</span><br><span class="line">  .range([<span class="number">0</span>, <span class="number">600</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> infor = timescale.ticks(d3.timeDay.every(<span class="number">10</span>));</span><br></pre></td></tr></table></figure><p>以上输出的是：<br>August 01<br>August 11<br>August 21<br>August 31<br>September 01<br>September 11<br>September 21<br>October 01<br>更多时间tick可以参考：<a href="https://github.com/d3/d3-scale#time-scales" target="_blank" rel="noopener">https://github.com/d3/d3-scale#time-scales</a><br>时间格式输出，参考：<a href="https://github.com/d3/d3-time-format" target="_blank" rel="noopener">https://github.com/d3/d3-time-format</a></p></li></ul><blockquote><p><a href="http://d3indepth.com/scales/" target="_blank" rel="noopener">参考一</a><br><a href="https://github.com/d3/d3-scale" target="_blank" rel="noopener">参考二</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;scale&lt;/code&gt;缩放也叫比例尺。是可视化的基本，使抽象的数据，转换成可视化的代表，比如宽高，位置或者颜色等。&lt;/p&gt;
&lt;h2 id=&quot;输入-amp-输出&quot;&gt;&lt;a href=&quot;#输入-amp-输出&quot; class=&quot;headerlink&quot; title=&quot;输入
      
    
    </summary>
    
    
      <category term="d3" scheme="https://akijiangrou.github.io/tags/d3/"/>
    
      <category term="学习笔记" scheme="https://akijiangrou.github.io/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>html5-小插件</title>
    <link href="https://akijiangrou.github.io/2017/09/21/html5-%E5%B0%8F%E6%8F%92%E4%BB%B6/"/>
    <id>https://akijiangrou.github.io/2017/09/21/html5-小插件/</id>
    <published>2017-09-21T02:56:33.000Z</published>
    <updated>2017-09-21T03:38:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>有些时候会遇到上传文件和下载的需求，一般原生html样式并不能满足要求。所以总结了一下平时常用的图片上传，问价上传下载等简单的小需求的实现。</p><p>包含图片上传，限制图片的大小。<br>文件上传和下载（不用form 标签）<br>之前做地图需求的，字符颜色转rgb的简单转化。  </p><p>大部分的组件渲染是基于react，所以写法都是react相关的。  </p><h2 id="上传图片及检查大小"><a href="#上传图片及检查大小" class="headerlink" title="上传图片及检查大小"></a>上传图片及检查大小</h2><p>本示例是限制了上传图片的大小，<code>maxWidth: 600</code>, <code>maxHeight: 300</code>, <code>maxSize: 200</code>, 上传前前端先做检查。  </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component, PropTypes &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> imageStyles <span class="keyword">from</span> <span class="string">'../styles/image.css'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; imageSizeCheck, newImageSrc &#125; <span class="keyword">from</span> <span class="string">'../utils/imgCheck.js'</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Image 组件，支持上传图片</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @props   onImageChange   传回上传的图片的地址</span></span><br><span class="line"><span class="comment"> * @props   onError         上传失败的处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Image</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>(...arguments);</span><br><span class="line">    <span class="comment">// 用于自动设置图片高度</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      imageHeight: <span class="number">180</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'undefined'</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> imageHeight = <span class="keyword">this</span>.refs.imageContainer.offsetWidth * <span class="number">0.618</span>;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; imageHeight &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick() &#123;</span><br><span class="line">    <span class="comment">// 模拟点击上传图片按钮</span></span><br><span class="line">    <span class="keyword">this</span>.refs.file.click();</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange() &#123;</span><br><span class="line">    <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    formData.append(<span class="string">'file'</span>, <span class="keyword">this</span>.refs.file.files[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// 检验图片大小</span></span><br><span class="line">    <span class="keyword">this</span>.imageCheck(<span class="keyword">this</span>.props.subtype, <span class="keyword">this</span>.refs.file.files[<span class="number">0</span>], (err, res) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">const</span> msg = <span class="string">`请选择<span class="subst">$&#123;res.maxWidth&#125;</span>*<span class="subst">$&#123;res.maxHeight&#125;</span>像素且大小不超过<span class="subst">$&#123;res.maxSize&#125;</span>k的图片上传`</span>;</span><br><span class="line">        <span class="built_in">window</span>.alert(<span class="string">`您的图片为<span class="subst">$&#123;res.height&#125;</span>*<span class="subst">$&#123;res.width&#125;</span>像素,大小为<span class="subst">$&#123;res.size&#125;</span>k. <span class="subst">$&#123;msg&#125;</span>`</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 成功的操作</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  imageCheck(subtype, file, cb) &#123;</span><br><span class="line">  <span class="comment">// 可修改图片检查的大小和尺寸。</span></span><br><span class="line">    <span class="keyword">const</span> sixthree = &#123;</span><br><span class="line">      imgFile: file,</span><br><span class="line">      maxWidth: <span class="number">600</span>,</span><br><span class="line">      maxHeight: <span class="number">300</span>,</span><br><span class="line">      maxSize: <span class="number">200</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    imageSizeCheck(sixthree, (err, res) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> cb(err, res);</span><br><span class="line">      &#125;</span><br><span class="line">      imageSizeCheck(&#123;</span><br><span class="line">        imgFile: file,</span><br><span class="line">        maxWidth: <span class="number">700</span>,</span><br><span class="line">        maxHeight: <span class="number">350</span>,</span><br><span class="line">        maxSize: <span class="number">200</span>,</span><br><span class="line">      &#125;, cb);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div</span><br><span class="line">        ref=<span class="string">"imageContainer"</span></span><br><span class="line">        className=&#123;imageStyles.imageContainer&#125;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          className=&#123;imageStyles.imageUpload&#125;</span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>)&#125;</span><br><span class="line">          style=&#123;&#123;</span><br><span class="line">            height: <span class="keyword">this</span>.state.imageHeight,</span><br><span class="line">            lineHeight: <span class="keyword">this</span>.state.imageHeight + <span class="string">'px'</span>,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;点击上传图片</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input ref="file" className=&#123;imageStyles.inputFile&#125; onChange=&#123;this.handleChange.bind(this)&#125; type="file" accept="image/</span>*<span class="string">"/&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Image;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">image</span><span class="selector-class">.css</span></span><br><span class="line"><span class="selector-class">.imageContainer</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.imageContainerHasImg</span> <span class="selector-class">.imageUpload</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.imageUpload</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#999</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.imageUpload</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type="file"]</span><span class="selector-class">.inputFile</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">imageCheck.js</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">imageSizeCheck</span>(<span class="params">&#123; imgFile, maxWidth, maxHeight, maxSize &#125;, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;</span><br><span class="line">    maxWidth,</span><br><span class="line">    maxHeight,</span><br><span class="line">    maxSize,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> size = <span class="built_in">Math</span>.floor(imgFile.size / <span class="number">1024</span>);</span><br><span class="line">  <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">  reader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = e.target.result;</span><br><span class="line">    <span class="keyword">const</span> tempImg = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">    tempImg.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      res.width = tempImg.width;</span><br><span class="line">      res.height = tempImg.height;</span><br><span class="line">      res.size = size;</span><br><span class="line">      <span class="keyword">if</span> (res.width &gt; maxWidth || res.height &gt; maxHeight || res.size &gt; maxSize) &#123;</span><br><span class="line">        cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'上传失败'</span>), res);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cb(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    tempImg.src = data;</span><br><span class="line">  &#125;;</span><br><span class="line">  reader.readAsDataURL(imgFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>文件上传有默认的样式，一般都是不满足的，所以用一下方式修改。后面的span用于展示文件内容。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"monitor-clickUploader"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"monitor-upload-btn"</span>&gt;</span> + 上传商户id<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">ref</span>=<span class="string">&#123;input</span> =&gt;</span> &#123; this.upload = input; &#125; &#125; onChange=&#123;() =&gt; this.handleFileChanged()&#125;/&gt;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;this.state.fileName&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.monitor-clickUploader</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">10px</span> <span class="number">0px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.monitor-clickUploader</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=0);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.monitor-upload-btn</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#3bb4f1</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3bb4f1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">10px</span> <span class="number">4px</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">handleFileChanged() &#123;</span><br><span class="line">  <span class="keyword">const</span> fileList = <span class="keyword">this</span>.upload.files;</span><br><span class="line">  <span class="keyword">if</span> (fileList.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">fileName</span>: fileList[<span class="number">0</span>].name&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>展示样式：<br><img src="./button.png"></p><h2 id="文件上传提交"><a href="#文件上传提交" class="headerlink" title="文件上传提交"></a>文件上传提交</h2><p>上传文件需要formdata格式，但是不用自己显式的写明content-type,有时会出问题。不需要写form，可以这样写。  </p><p>文件上传的html同上。<br>触发上传：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginLeft:</span> <span class="attr">70</span>, <span class="attr">marginTop:</span> <span class="attr">20</span> &#125;&#125;</span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">"button"</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">className</span>=<span class="string">"btn Btn"</span></span></span><br><span class="line">  disabled=&#123;startDate === "" || endDate === "" || poiResultList.length &lt;=0 || monitorIndexList.length &lt;= 0&#125;</span><br><span class="line">  onClick=&#123;() =&gt; this.handleFileUpload()&#125;</span><br><span class="line">&gt;开始监控<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">handleFileUpload() &#123;</span><br><span class="line">    <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    <span class="keyword">const</span> fileList = <span class="keyword">this</span>.upload.files;</span><br><span class="line">    <span class="keyword">if</span> (fileList.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      formData.append(<span class="string">'uploadFile'</span>, fileList[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">this</span>.props.postMonitor(&#123; formData &#125; )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//postMonitor里发送formdata文件。xhr就行。</span></span><br></pre></td></tr></table></figure><h2 id="前端实现下载功能"><a href="#前端实现下载功能" class="headerlink" title="前端实现下载功能"></a>前端实现下载功能</h2><h3 id="2进制文件"><a href="#2进制文件" class="headerlink" title="2进制文件"></a>2进制文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// render部分：</span></span><br><span class="line">&lt;div</span><br><span class="line">  style=&#123;&#123; <span class="attr">display</span>: canDownload ? <span class="string">'inline-block'</span> : <span class="string">'none'</span> &#125;&#125;</span><br><span class="line">  className=&#123;listcss.download&#125;</span><br><span class="line">  onClick=&#123;<span class="keyword">this</span>.handleDownload&#125;</span><br><span class="line">&gt;导出数据&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 处理：</span></span><br><span class="line"><span class="regexp">handleDownload() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; download &#125; = this.props;</span></span><br><span class="line"><span class="regexp">    if (download &amp;&amp; download.length &gt; 0) &#123;</span></span><br><span class="line"><span class="regexp">      const u8arr = new Uint8Array(download.length);</span></span><br><span class="line"><span class="regexp">      let length = download.length;</span></span><br><span class="line"><span class="regexp">      while (length--) &#123;</span></span><br><span class="line"><span class="regexp">        u8arr[length] = download[length];</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      const blob = new Blob([u8arr.buffer], &#123; type: 'application/</span>vnd.ms-excel<span class="string">' &#125;);</span></span><br><span class="line"><span class="string">      const fileName = '</span>orderData.xls<span class="string">';</span></span><br><span class="line"><span class="string">      downBinaryToExcel(blob, fileName);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">export const downBinaryToExcel = (blob, fileName) =&gt; &#123;</span></span><br><span class="line"><span class="string">  if (window.navigator.msSaveOrOpenBlob) &#123;</span></span><br><span class="line"><span class="string">    navigator.msSaveBlob(blob, fileName);</span></span><br><span class="line"><span class="string">  &#125; else &#123;</span></span><br><span class="line"><span class="string">    const link = document.createElement('</span>a<span class="string">');</span></span><br><span class="line"><span class="string">    link.href = window.URL.createObjectURL(blob);</span></span><br><span class="line"><span class="string">    link.download = fileName;</span></span><br><span class="line"><span class="string">    link.click();</span></span><br><span class="line"><span class="string">    window.URL.revokeObjectURL(link.href);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure><h3 id="数组或者字符串内容下载"><a href="#数组或者字符串内容下载" class="headerlink" title="数组或者字符串内容下载"></a>数组或者字符串内容下载</h3><p>主要是拼接成excel需要的格式, 然后放在blob的内容里。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> headerInfo = <span class="string">`&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"&gt;</span></span><br><span class="line"><span class="string">&lt;ss:Worksheet ss:Name="Sheet1"&gt;</span></span><br><span class="line"><span class="string">&lt;ss:Table&gt;\n</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> footerInfo = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;/ss:Table&gt;</span></span><br><span class="line"><span class="string">&lt;/ss:Worksheet&gt;</span></span><br><span class="line"><span class="string">&lt;/ss:Workbook&gt;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己组织数据结构，包括一行表头，和每行的数据。</span></span><br><span class="line"><span class="keyword">const</span> composeRow = R.compose(</span><br><span class="line">  item =&gt; <span class="string">`&lt;ss:Row&gt;\n<span class="subst">$&#123;item&#125;</span>&lt;/ss:Row&gt;\n`</span>,</span><br><span class="line">  R.join(<span class="string">''</span>),</span><br><span class="line">  R.map(</span><br><span class="line">    item =&gt;</span><br><span class="line">      <span class="string">`  &lt;ss:Cell&gt;</span></span><br><span class="line"><span class="string">    &lt;ss:Data ss:Type="<span class="subst">$&#123;R.is(<span class="built_in">Number</span>, item)</span></span></span><br><span class="line"><span class="string"><span class="subst">      ? <span class="string">'Number'</span></span></span></span><br><span class="line"><span class="string"><span class="subst">      : <span class="string">'String'</span>&#125;</span>"&gt;<span class="subst">$&#123;item&#125;</span>&lt;/ss:Data&gt;</span></span><br><span class="line"><span class="string">  &lt;/ss:Cell&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rows = FUNC（composeRow）<span class="comment">// 具体的自己写吧</span></span><br><span class="line"><span class="keyword">const</span> xml = <span class="string">`<span class="subst">$&#123;headerInfo&#125;</span><span class="subst">$&#123;rows&#125;</span><span class="subst">$&#123;footerInfo&#125;</span>`</span>;</span><br></pre></td></tr></table></figure><h2 id="HEX-TO-RGB"><a href="#HEX-TO-RGB" class="headerlink" title="HEX TO RGB"></a>HEX TO RGB</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> hexToRgb = <span class="function"><span class="params">hex</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> rgb = [];</span><br><span class="line">  <span class="keyword">let</span> letters = hex.substr(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (letters.length === <span class="number">3</span>) &#123;</span><br><span class="line">    letters = letters.replace(<span class="regexp">/(.)/g</span>, <span class="string">'$1$1'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  letters.replace(<span class="regexp">/../g</span>, color =&gt; &#123; rgb.push(<span class="built_in">parseInt</span>(color, <span class="number">0x10</span>)); &#125;);</span><br><span class="line">  <span class="keyword">return</span> rgb;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;有些时候会遇到上传文件和下载的需求，一般原生html样式并不能满足要求。所以总结了一下平时常用的图片上传，问价上传下载等简单的小需求的实现。&lt;/p&gt;
&lt;p&gt;包含图片上传，限制图片的大小。&lt;br&gt;文件上传和下载（不用form 标签）&lt;br&gt;之前做地图需求的，字符颜色转rgb的
      
    
    </summary>
    
    
      <category term="html5" scheme="https://akijiangrou.github.io/tags/html5/"/>
    
      <category term="图片上传" scheme="https://akijiangrou.github.io/tags/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/"/>
    
      <category term="文件上传" scheme="https://akijiangrou.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
      <category term="文件下载" scheme="https://akijiangrou.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>D3-api-transition</title>
    <link href="https://akijiangrou.github.io/2017/09/18/D3-api-transition/"/>
    <id>https://akijiangrou.github.io/2017/09/18/D3-api-transition/</id>
    <published>2017-09-18T08:45:41.000Z</published>
    <updated>2017-09-22T03:10:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="D3的动效API-transition"><a href="#D3的动效API-transition" class="headerlink" title="D3的动效API-transition"></a>D3的动效API-transition</h1><p>D3的动效都是通过transition来实现的。</p><p><code>transition</code> 是类似于selection的接口，它用于动画改变DOM界面。<br><code>transition</code> 通过 <code>selection.transition</code> 获得，他和d3.select(…)返回的内容是一样的。</p><h2 id="常用api"><a href="#常用api" class="headerlink" title="常用api"></a>常用api</h2><p>基本api：</p><blockquote><p>selection.transition([name])<br>selection.interrupt([name])<br>transition.duration()<br>transition.delay(value|func)<br>transition.ease(name)<br>transition.each()<br>transition.call()<br>transition.filter()<br>transition.merge()<br>transition.remove()  </p></blockquote><p>高级：</p><blockquote><p>transition.on  监控控制流，几个状态：start，end，interrupt。这个只是transition对象有。</p></blockquote><blockquote><p>transition.attrTween<br>transition.styleTween<br>transition.tween(name[, value])</p></blockquote><h2 id="最简单例子"><a href="#最简单例子" class="headerlink" title="最简单例子"></a>最简单例子</h2><p>在需要变化的属性前加上<code>transition()</code>即可~~<br>例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">svg.selectAll(<span class="string">"rect"</span>)</span><br><span class="line"> .data(dataset)</span><br><span class="line"> .transition()    <span class="comment">// &lt;-- This is new! Everything else here is unchanged.</span></span><br><span class="line"> .attr(<span class="string">"y"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> h - yScale(d);</span><br><span class="line"> &#125;)</span><br><span class="line"> .attr(<span class="string">"height"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> yScale(d);</span><br><span class="line"> &#125;)</span><br><span class="line"> .attr(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"rgb(0, 0, "</span> + (d * <span class="number">10</span>) + <span class="string">")"</span>;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>如果不加，则立即执行，加了则延迟一点点。默认：250ms</p><h2 id="常用的transition写法"><a href="#常用的transition写法" class="headerlink" title="常用的transition写法"></a>常用的transition写法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.transition()</span><br><span class="line">  .delay(<span class="function"><span class="keyword">function</span>(<span class="params">d,i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">150</span>;</span><br><span class="line">   &#125;)</span><br><span class="line">  .duration(<span class="number">1500</span>)</span><br><span class="line">  .ease(d3.easeBack)</span><br></pre></td></tr></table></figure><p>每个元素都会有自己的delay。</p><h3 id="ease-函数"><a href="#ease-函数" class="headerlink" title=" ease  函数"></a><strong> ease </strong> 函数</h3><pre><code>&quot;easeElastic&quot;,  &quot;easeBounce&quot;,  &quot;easeLinear&quot;,  &quot;easeSin&quot;,  &quot;easeQuad&quot;,  &quot;easeCubic&quot;,  &quot;easePoly&quot;,  &quot;easeCircle&quot;,  &quot;easeExp&quot;,  &quot;easeBack&quot;  </code></pre><p>调用：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selection.ease(d3.easeElastic)</span><br></pre></td></tr></table></figure></p><h3 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h3><p>连续添加多个transition,最简单的方法之一，就是在第一个transition完成后，继续调用transition。<br>参考例子：<a href="https://codepen.io/akixiao/pen/BwNZRp" target="_blank" rel="noopener">https://codepen.io/akixiao/pen/BwNZRp</a></p><h3 id="d3-active-node-name"><a href="#d3-active-node-name" class="headerlink" title="d3.active(node, [name])"></a>d3.active(node, [name])</h3><p>返回具有指定名称（如果有）的指定节点上的<code>active transition</code>。如果未指定名称，则使用null。如果指定节点上没有这样的<code>active transition</code>，则返回null。此方法对于创建链接<code>transition</code>很有用。</p><h3 id="tween-补间动画"><a href="#tween-补间动画" class="headerlink" title="tween 补间动画"></a>tween 补间动画</h3><p>transition的变化详情，是通过interpolate实现的。<br>默认有几个情况：<br>如果attr中的value是数字，则使用interpolateNumber<br>如果value是color或者字符颜色，则使用 interpolateRgb.<br>其他情况：interpolateString  </p><p><code>style</code>的属性也是一样的<br><code>tween</code>有自己的时间函数<br><code>tween</code>相关函数使用重点就是在，tween函数中设置自己的时间函数：  </p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">transition.tween(<span class="string">"attr.fill"</span>, function() &#123;</span><br><span class="line">  var <span class="keyword">node</span> <span class="title">= this</span>, i = d3.interpolateRgb(<span class="keyword">node</span>.<span class="title">getAttribute</span>(<span class="string">"fill"</span>), <span class="string">"blue"</span>);</span><br><span class="line">  return function(t) &#123;</span><br><span class="line">    <span class="keyword">node</span>.<span class="title">setAttribute</span>(<span class="string">"fill"</span>, i(t));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>另一个数字补间应用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.tween(<span class="string">'number'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> that = d3.select(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">const</span> i = d3.interpolateRound(<span class="number">0</span>, <span class="number">200</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    that.style(<span class="string">'color'</span>, <span class="string">`rgb(<span class="subst">$&#123;<span class="number">0</span> + i(t)&#125;</span>, <span class="subst">$&#123;<span class="number">80</span> + i(t)&#125;</span>, 232)`</span>);</span><br><span class="line">    that.text(i(t));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>演示：<a href="https://codepen.io/akixiao/pen/mBJqzO" target="_blank" rel="noopener">https://codepen.io/akixiao/pen/mBJqzO</a></p><h3 id="循环变换"><a href="#循环变换" class="headerlink" title="循环变换"></a>循环变换</h3><p>一般通过是将transition写成一个函数。然后使用on监听end事件，实现递归调用。简单例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">repeat</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   show.transition()</span><br><span class="line">   .delay(<span class="number">800</span>)</span><br><span class="line">   .duration(<span class="number">2000</span>)</span><br><span class="line">   .tween(<span class="string">'number'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">const</span> that = d3.select(<span class="keyword">this</span>);</span><br><span class="line">     <span class="keyword">const</span> i = d3.interpolateRound(<span class="number">0</span>, <span class="number">200</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">       that.style(<span class="string">'color'</span>, <span class="string">`rgb(<span class="subst">$&#123;<span class="number">0</span> + i(t)&#125;</span>, <span class="subst">$&#123;<span class="number">80</span> + i(t)&#125;</span>, 232)`</span>);</span><br><span class="line">       that.text(i(t));</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br><span class="line">   .on(<span class="string">'end'</span>, repeat); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="一些例子"><a href="#一些例子" class="headerlink" title="一些例子"></a>一些例子</h3><p>d3实现的smooth scroll<br>高级玩法：<br><a href="https://bl.ocks.org/mbostock/70d5541b547cc222aa02" target="_blank" rel="noopener">https://bl.ocks.org/mbostock/70d5541b547cc222aa02</a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote><p><a href="http://duspviz.mit.edu/d3-workshop/transitions-animation/" target="_blank" rel="noopener">d3 transition</a><br><a href="https://bost.ocks.org/mike/transition/" target="_blank" rel="noopener">working with transitions</a><br><a href="https://leanpub.com/d3-t-and-t-v4/read" target="_blank" rel="noopener">D3 Tips and Tricks V4.0</a><br><a href="https://www.dashingd3js.com/lessons/d3-transition-basics" target="_blank" rel="noopener">D3 Transition Basics</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;D3的动效API-transition&quot;&gt;&lt;a href=&quot;#D3的动效API-transition&quot; class=&quot;headerlink&quot; title=&quot;D3的动效API-transition&quot;&gt;&lt;/a&gt;D3的动效API-transition&lt;/h1&gt;&lt;p&gt;D3
      
    
    </summary>
    
    
      <category term="d3" scheme="https://akijiangrou.github.io/tags/d3/"/>
    
      <category term="transition" scheme="https://akijiangrou.github.io/tags/transition/"/>
    
  </entry>
  
  <entry>
    <title>关于Object查缺补漏</title>
    <link href="https://akijiangrou.github.io/2017/09/18/%E5%85%B3%E4%BA%8EObject%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/"/>
    <id>https://akijiangrou.github.io/2017/09/18/关于Object查缺补漏/</id>
    <published>2017-09-18T08:09:48.000Z</published>
    <updated>2017-09-18T08:10:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h2><p>这些都是对象子类型，看起来与基础类型一样。如下：</p><ul><li>String</li><li>Number</li><li>Boolean</li><li>Object</li><li>Function</li><li>Array</li><li>Date</li><li>RegExp</li><li>Error</li></ul><p>以上内置函数可以当做构造函数来使用。一些字面可以自动转换成对象类型进行一些方法的操作。</p><h2 id="深复制-amp-浅复制"><a href="#深复制-amp-浅复制" class="headerlink" title="深复制 &amp; 浅复制"></a>深复制 &amp; 浅复制</h2><p>对于对象和数组来说，<code>浅复制</code>是对对象地址的复制，并没有开辟新的栈，复制的结果是两个对象指向同一个地址，修改一个对象的属性，会改变另一个对象属性。<code>深复制</code>则开辟新的栈，两个对象对应两个不同的地址，属性隔离。</p><p>浅复制：拷贝引用<br>深复制：拷贝实例<br>深复制比较耗内存，而且可能出现死循环栈溢出的情况。<br>深复制死循环的例子：  </p><p>const testArr = [];<br>const myObj = {<br>  a: 2,<br>  b: testArr,<br>};</p><p>testArr.push(myObj, true);</p><p>比如深复制myObj, 除了复制myObj外，还要复制testArr，而testArr引用了myObj,所以又要再次复制myObj，然后这两个开始循环引用导致死循环了。</p><p>Object.assign是es6里非常好用的一个方法，<br><code>Object.assign()</code></p><h2 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h2><p>是从es5以后，对象属性有了属性描述符。<br>一个对象的属性不仅包含属性值，还包含另外三个特性：<code>writable</code>，<code>enumerable</code> 和 <code>configurable</code><br>使用该函数，可以获取一个对象属性的配置信息。<br>Object.getOwnPropertyDescriptor( myObject, “a” );</p><p>使用下面的函数，可以配置对象属性<br>Object.defineProperty(obj, ‘prop’, {<br>  value: 6,<br>  writable: true,<br>  configurable: true,<br>  enumerable: true,<br>});</p><p><code>writable</code>: 控制能否重写这个属性的值<br><code>enumerable</code>: 控制这个属性能否被遍历<br><code>configurable</code>: 控制这个属性的属性描述符是否可以修改，也就是控制这三个属性是否可以被修改。configurable:false 还会禁止删除这个属性</p><h2 id="控制属性的不变性"><a href="#控制属性的不变性" class="headerlink" title="控制属性的不变性"></a>控制属性的不变性</h2><p>当我们想控制一些对象的属性，让他成为不可改变的，我们有如下几种方法：</p><h3 id="结合writable-amp-configurable"><a href="#结合writable-amp-configurable" class="headerlink" title="结合writable &amp; configurable"></a>结合writable &amp; configurable</h3><p>writable:false<br>configurable:false</p><p>对应的属性将不会被更改。也不能被删除。</p><h3 id="禁止扩展"><a href="#禁止扩展" class="headerlink" title="禁止扩展"></a>禁止扩展</h3><p><code>Object.preventExtensions</code><br>可以禁止一个对象添加新属性，并且保留已有属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span>&#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(obj);</span><br><span class="line">obj.b = <span class="number">3</span>;</span><br><span class="line">obj.b; <span class="comment">// undefined </span></span><br><span class="line"><span class="comment">// strict mode：typeError</span></span><br></pre></td></tr></table></figure><h3 id="seal-密封"><a href="#seal-密封" class="headerlink" title="seal 密封"></a>seal 密封</h3><p>Object.seal(..) 会创建一个“密封”的对象，等价于preventExtensions + 每个属性configurable: false;<br>但是其实这个是可以修改属性值的。</p><h3 id="freeze-冻结"><a href="#freeze-冻结" class="headerlink" title="freeze 冻结"></a>freeze 冻结</h3><p>等价于对对象使用seal，并把每个属性标记为writable:false;</p><p>但是该属性可以修改深度的对象。</p><h2 id="对象属性获取原理"><a href="#对象属性获取原理" class="headerlink" title="对象属性获取原理"></a>对象属性获取原理</h2><p>属性访问其实是通过对象的[[get]]获取的。对象默认的内置 [[Get]] 操作首先在对象中查找是否有名称相同的属性， 如果找到就会返回这个属性的值。如果本对象中没有，会遍历原型链进行寻找。如果都没有则返回undefined。</p><p>在es6中，我们可以进行这个内置操作的修改了。比如Proxy 代理对象。</p><p>对应的还有[[Put]]内置操作。主要用来设置对象的值。<br>[[Put]] 被触发时，实际的行为取决于许多因素，包括对象中是否已经存在这个属性(这是最重要的因素，没有则会去查原型链)。<br>如果已经存在这个属性，[[Put]] 算法大致会检查下面这些内容。  </p><ol><li>属性是否是访问描述符?如果是并且存在setter就调用setter。  </li><li>属性的数据描述符中writable是否是false?如果是，在非严格模式下静默失败，在严格模式下抛出 TypeError 异常。  </li><li>如果都不是，将该值设置为属性的值。  </li></ol><h3 id="getter-amp-setter"><a href="#getter-amp-setter" class="headerlink" title="getter &amp; setter"></a>getter &amp; setter</h3><p>可以在对象的某个属性上进行修改默认的getter与setter函数。但是一般这两个要绑定在一起输出。两个方法：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="keyword">get</span> c() &#123; <span class="keyword">return</span> <span class="number">1</span>;&#125; &#125;;</span><br><span class="line">Object.definePropperty(obj, <span class="string">'b'</span>,</span><br><span class="line">  &#123; <span class="keyword">get</span>: function() &#123; <span class="keyword">return</span> <span class="number">2</span>;&#125;&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">obj.c <span class="comment">// 1</span></span><br><span class="line">obj.b <span class="comment">// 2 </span></span><br><span class="line">obj.b = <span class="number">3</span>;</span><br><span class="line">obj.b <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get set 经典搭配</span></span><br><span class="line"><span class="keyword">const</span> myObj = &#123;</span><br><span class="line">  <span class="keyword">get</span> a() &#123; <span class="keyword">return</span> <span class="keyword">this</span>._a_; &#125;</span><br><span class="line">  <span class="keyword">set</span> a(<span class="keyword">val</span>) &#123; <span class="keyword">this</span>._a_ = <span class="keyword">val</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="属性存在性"><a href="#属性存在性" class="headerlink" title="属性存在性"></a>属性存在性</h2><p>检验一个对象中是否有某个属性，可以用 <code>in</code>  <code>hasOwnProperty</code> 。可以用于检测是属性值为undefined，还是为定义属性。<br>但是这两个的区别是，<code>in</code>是对象本身和其原型链都查，后者则只查对象本身。</p><p>参考的是《你不知道的javascript》</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;内置对象&quot;&gt;&lt;a href=&quot;#内置对象&quot; class=&quot;headerlink&quot; title=&quot;内置对象&quot;&gt;&lt;/a&gt;内置对象&lt;/h2&gt;&lt;p&gt;这些都是对象子类型，看起来与基础类型一样。如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;String&lt;/li&gt;
&lt;li&gt;Number&lt;/
      
    
    </summary>
    
    
      <category term="javascript" scheme="https://akijiangrou.github.io/tags/javascript/"/>
    
      <category term="object" scheme="https://akijiangrou.github.io/tags/object/"/>
    
  </entry>
  
  <entry>
    <title>React生命周期</title>
    <link href="https://akijiangrou.github.io/2017/09/12/React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <id>https://akijiangrou.github.io/2017/09/12/React生命周期/</id>
    <published>2017-09-12T11:07:41.000Z</published>
    <updated>2017-10-25T11:44:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="react生命周期"><a href="#react生命周期" class="headerlink" title="react生命周期"></a>react生命周期</h1><p>在自定义React组件时，会根据需要在组件生命周期的不同阶段实现不同的逻辑。本文源码是【15.6.1】</p><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>而组件的生命周期在不同状态下的执行顺序如下：</p><h4 id="首次挂载组件"><a href="#首次挂载组件" class="headerlink" title="首次挂载组件"></a>首次挂载组件</h4><ul><li>getDefaultProps</li><li>getInitialState</li><li>componentWillMount</li><li>render</li><li>componentDidMount</li></ul><h4 id="重新挂载组件"><a href="#重新挂载组件" class="headerlink" title="重新挂载组件"></a>重新挂载组件</h4><ul><li>getInitialState</li><li>componentWillMount</li><li>render</li><li>componentDidMount</li></ul><h4 id="再次渲染组件-props-CHANGE"><a href="#再次渲染组件-props-CHANGE" class="headerlink" title="再次渲染组件-props CHANGE"></a>再次渲染组件-props CHANGE</h4><ul><li>componentWillReceiveProps</li><li>shouldComponentUpdate</li><li>componentWillUpdate</li><li>render</li><li>componentDidUpdate</li></ul><h4 id="再次渲染组件-state-CHANGE"><a href="#再次渲染组件-state-CHANGE" class="headerlink" title="再次渲染组件-state CHANGE"></a>再次渲染组件-state CHANGE</h4><ul><li>shouldComponentUpdate</li><li>componentWillUpdate</li><li>render</li><li>componentDidUpdate</li></ul><p>下面就是揭秘React为何会按照上面这个执行生命周期。</p><h2 id="生命周期详解"><a href="#生命周期详解" class="headerlink" title="生命周期详解"></a>生命周期详解</h2><p>自定义组件声明周期存在3个阶段：<br><strong>MOUNTING</strong>, <strong>RECEIVE_PROPS</strong>, <strong>UNMOUNTING</strong></p><p>分别对应3种方法。</p><ul><li>mountComponent，</li><li>updateComponent</li><li>unmountComponent</li></ul><p>以上每个都提供了几种处理方法。will前缀的方法在进入状态之前调用，did在进入状态之后调用。</p><h3 id="使用createClass创建自定义组件"><a href="#使用createClass创建自定义组件" class="headerlink" title="使用createClass创建自定义组件"></a>使用createClass创建自定义组件</h3><p>ES6编写React组件时：</p><pre><code>class MyComponent extends React.Component</code></pre><p>是调用<code>createClass</code>创建组件，利用原型继承<code>ReactClassComponent</code>父类，合并<code>mixins</code>，初始化<code>defaultProps</code>，返回构造函数。下面是代码。</p><p>关于createClass：【isomorphic/class/createClass.js】  </p><pre><code>&apos;use strict&apos;;var {Component} = require(&apos;ReactBaseClasses&apos;);var {isValidElement} = require(&apos;ReactElement&apos;);var ReactNoopUpdateQueue = require(&apos;ReactNoopUpdateQueue&apos;);var factory = require(&apos;create-react-class/factory&apos;);module.exports = factory(Component, isValidElement, ReactNoopUpdateQueue);</code></pre><p>factory: [react/addons/create-react-class/factory.js];</p><p>component如上，但是<code>createClass</code>实际上导出的是由<code>factory`</code>包裹的函数。各种生命周期都是在factory<code>里构造的。</code>factory<code>里定义了，</code>ReactClassInterface`，里面规定了好多协议（如render等）</p><pre><code>// Helper function to allow the creation of anonymous functions which do not// have .name set to the name of the variable being assigned to.function identity(fn) {  return fn;}function factory(ReactComponent, isValidElement, ReactNoopUpdateQueue) {  var injectedMixins = [];  // 定义reactclass中的协议（其实就是方法）  var ReactClassInterface = {    mixins: &apos;DEFINE_MANY&apos;,    statics: &apos;DEFINE_MANY&apos;,    propTypes: &apos;DEFINE_MANY&apos;,    contextTypes: &apos;DEFINE_MANY&apos;,    childContextTypes: &apos;DEFINE_MANY&apos;,    getDefaultProps: &apos;DEFINE_MANY_MERGED&apos;,    getInitialState: &apos;DEFINE_MANY_MERGED&apos;,    getChildContext: &apos;DEFINE_MANY_MERGED&apos;,    render: &apos;DEFINE_ONCE&apos;,    componentWillMount: &apos;DEFINE_MANY&apos;,    componentDidMount: &apos;DEFINE_MANY&apos;,    componentWillReceiveProps: &apos;DEFINE_MANY&apos;,    shouldComponentUpdate: &apos;DEFINE_ONCE&apos;,    componentWillUpdate: &apos;DEFINE_MANY&apos;,    componentDidUpdate: &apos;DEFINE_MANY&apos;,    componentWillUnmount: &apos;DEFINE_MANY&apos;,    updateComponent: &apos;OVERRIDE_BASE&apos;};  var ReactClassComponent = function() {};  _assign(    ReactClassComponent.prototype,    ReactComponent.prototype,    ReactClassMixin  );  function createClass(spec) {    // Constructor.name !== &apos;Constructor&apos;.确保不会将没有displayName的类识别为&apos;Constructor&apos;。重写了contructor函数~~~~     var Constructor = identity(function(props, context, updater) {     // 自动绑定     if (this.__reactAutoBindPairs.length) {      bindAutoBindMethods(this);    }    this.props = props;    this.context = context;    this.refs = emptyObject;    this.updater = updater || ReactNoopUpdateQueue;    this.state = null;    // reactClasses没有构造函数，通过getInitialState，与componentWillMount来进行初始化。    var initialState = this.getInitialState ? this.getInitialState() : null;    // 原型继承自父类。    Constructor.prototype = new ReactClassComponent();    Constructor.prototype.constructor = Constructor;    Constructor.prototype.__reactAutoBindPairs = [];    injectedMixins.forEach(mixSpecIntoComponent.bind(null, Constructor));// 把didmount，willunmount赋给原型    mixSpecIntoComponent(Constructor, IsMountedPreMixin);    mixSpecIntoComponent(Constructor, spec);    mixSpecIntoComponent(Constructor, IsMountedPostMixin);    // Initialize the defaultProps property after all mixins have been merged.    // 所有mixin合并后，开始初始化defaultProps    if (Constructor.getDefaultProps) {      Constructor.defaultProps = Constructor.getDefaultProps();    }    // 减少查找并设置原型的时间。    for (var methodName in ReactClassInterface) {      if (!Constructor.prototype[methodName]) {        Constructor.prototype[methodName] = null;      }    }    return Constructor;  }   return createClass;}</code></pre><p>以上是初始化的阶段，第一次mounting前，<code>createClass</code>返回<code>Constructor</code>函数。<code>getDefaultProps</code> 是在constructor阶段调用的，所以生成一个实例后，就不会再调用了。所以只有初次挂载的时候才会调用。。。</p><h3 id="mountComponent阶段"><a href="#mountComponent阶段" class="headerlink" title="mountComponent阶段"></a>mountComponent阶段</h3><p>mountComponent负责管理生命周期的<code>getInitialState</code>，<code>componentWillMount</code>，<code>render</code>，和<code>componentDidMount</code>.</p><p>mountComponent挂载组件，初始化序号，标记等参数，判断是否为无状态组件，以及初始化操作。使用<code>getInitialState</code>获取初始化state。在<code>componentWillMount</code>中调用setState，<strong>不触发re-render</strong>，而是merge state。这个状态的this.state并不是最新的。在render中才可以获取更新的this.state。  </p><p>[代码里]</p><pre><code>// When mounting, calls to `setState` by `componentWillMount` will set  // `this._pendingStateQueue` without triggering a re-render.  if (this._pendingStateQueue) {    inst.state = this._processPendingState(inst.props, inst.context);    // merge state   }</code></pre><p>利用：<code>this._pendingStateQueue</code> , <code>this._pendingReplaceState</code>, <code>this._pendingForceUpdate</code> 实现setState的异步跟新机制。</p><p>render后，若存在didMount，则调用。</p><p>mountComponent通过递归渲染的，由于是递归，肯定是父的willMOUNT, 父的RENDER, 子的willMount，子render，子didMount，父didmount。</p><p>mountComponent,初始化state，执行<code>initialMount</code>，返回markup。</p><pre><code>mountComponent: function(    transaction,    hostParent,    hostContainerInfo,    context,  ){    ...    var initialState = inst.state;    if (initialState === undefined) {      inst.state = initialState = null;    }    this._pendingStateQueue = null;    this._pendingReplaceState = false;    this._pendingForceUpdate = false;    var markup;    if (inst.unstable_handleError) {      markup = this.performInitialMountWithErrorHandling(        renderedElement,        hostParent,        hostContainerInfo,        transaction,        context,      );    } else {      markup = this.performInitialMount(        renderedElement,        hostParent,        hostContainerInfo,        transaction,        context,      );    }    if (inst.componentDidMount) {      if (__DEV__) {        transaction.getReactMountReady().enqueue(() =&gt; {          measureLifeCyclePerf(            () =&gt; inst.componentDidMount(),            this._debugID,            &apos;componentDidMount&apos;,          );        });      } else {        transaction.getReactMountReady().enqueue(inst.componentDidMount, inst);      }    }    return markup;  } </code></pre><p>在<code>performInitialMount</code>函数中, 使用ReactReconciler，进行递归渲染组件。</p><pre><code>var markup = ReactReconciler.mountComponent(  child,  transaction,  hostParent,  hostContainerInfo,  this._processChildContext(context),  debugID,);</code></pre><h3 id="RECEIVE—props-update的过程"><a href="#RECEIVE—props-update的过程" class="headerlink" title="RECEIVE—props update的过程"></a>RECEIVE—props update的过程</h3><p>源码里面：updateComponent负责管理生命周期的 <code>componentWillReceiveProps</code>，<code>shouldComponentUpdate</code>, <code>componentWillUpdate</code>, <code>componentDidUpdate</code>;</p><p>首先通过<code>updateComponent</code>更新组件，如果元素不一致，说明要进行组件更新。<br>代码继续向下执行，如果有<code>componentWillReceiveProps</code>执行，其中有<code>setState</code>会合并state，且在<code>componentWillReceiveProps，shouldComponentUpdate，componentWillUpdate</code>中不会获取到新的state。只能在render和did状态才能获取。剩下几个状态也是有就执行，且顺序为：<br><code>shouldComponentUpdate</code><br><code>componentWillUpdate</code><br><code>render</code><br><code>componentDidUpdate</code></p><p>在<code>updateComponent</code>中</p><pre><code>updateComponent: function(transaction,prevParentElement,nextParentElement,prevUnmaskedContext,nextUnmaskedContext,</code></pre><p>  ) {<br>    var inst = this._instance;<br>    …<br>    var willReceive = false;</p><pre><code>// 判断context变化与否，设置willReceive。if (this._context === nextUnmaskedContext) {  nextContext = inst.context;} else {  nextContext = this._processContext(nextUnmaskedContext);  willReceive = true;}var prevProps = prevParentElement.props;var nextProps = nextParentElement.props;// 判断props变化与否，设置willReceive。if (prevParentElement !== nextParentElement) {  willReceive = true;}if (willReceive &amp;&amp; inst.componentWillReceiveProps) {...判断和执行componentWillReceiveProps}var nextState = this._processPendingState(nextProps, nextContext);var shouldUpdate = true;... 下面是关于shouldupdate的判断和执行。</code></pre><p>shouldComponentUpdate，如果用户自定义了，则按照自定义判断来返回shouldUpdate，否则执行默认操作：</p><pre><code>if (!this._pendingForceUpdate) {if (inst.shouldComponentUpdate) {    if (__DEV__) {      shouldUpdate = measureLifeCyclePerf(        () =&gt; inst.shouldComponentUpdate(nextProps, nextState, nextContext),        this._debugID,        &apos;shouldComponentUpdate&apos;,      );    } else {      shouldUpdate = inst.shouldComponentUpdate(        nextProps,        nextState,        nextContext,      );    }  } else {    if (this._compositeType === CompositeTypes.PureClass) {      shouldUpdate =        !shallowEqual(prevProps, nextProps) ||        !shallowEqual(inst.state, nextState);    }  }  }</code></pre><p>后面render要根据shouldUpdate的状态来执行。</p><pre><code> if (shouldUpdate) {  this._pendingForceUpdate = false;  // Will set `this.props`, `this.state` and `this.context`.  this._performComponentUpdate(    nextParentElement,    nextProps,    nextState,    nextContext,    transaction,    nextUnmaskedContext,  );} else {  // 如果确定不更新，也要设置props，state，context  this._currentElement = nextParentElement;  this._context = nextUnmaskedContext;  inst.props = nextProps;  inst.state = nextState;  inst.context = nextContext;}</code></pre><p>如果应该update则调用一下函数<br><code>this._performComponentUpdate</code><br>规定了如果有componentWillUpdate，调用。<br>然后是_updateRenderedComponent，进行re-render，调动render方法更新dom<br>接着，如果有hasComponentDidUpdate，调用。</p><pre><code>_updateRenderedComponent: function(transaction, context) {// 如果需要更新，则调用ReactReconciler.receiveComponent跟新组件  if (shouldUpdateReactComponent(prevRenderedElement, nextRenderedElement)) {      ReactReconciler.receiveComponent(        prevComponentInstance,        nextRenderedElement,        transaction,        this._processChildContext(context),      );   } else {     // 渲染组件，render递归     var nextMarkup = ReactReconciler.mountComponent(        child,        transaction,        this._hostParent,        this._hostContainerInfo,        this._processChildContext(context),        debugID,      );    }</code></pre><p>也是递归render的，所以也是父的先willUpdate，然后子的willUpdate,子的didUpdate，父的DidUpdate</p><h3 id="unmounting"><a href="#unmounting" class="headerlink" title="unmounting"></a>unmounting</h3><p>负责管理<code>componentWillUnmount</code></p><p>如果规定了componentWillUnmount，则执行并重置所有参数，更新队列以及状态。有setState，不会执行re-render。并清除了当前的这个实例。</p><h3 id="无状态组件"><a href="#无状态组件" class="headerlink" title="无状态组件"></a>无状态组件</h3><p>只是一个render方法，没有组件实例化过程。因为没有状态，没有生命周期，接收props生成dom结构。</p><h2 id="setState-机制"><a href="#setState-机制" class="headerlink" title="setState 机制"></a>setState 机制</h2><p>this.state 用来访问state，this.setState 用来更新state。但是我们在刚写react的时候，有些时候setState并不生效。原因慢慢来分析。  </p><p>首先记住，setState是异步更新，这是通过监控一个state队列实现的，这也避免了频繁重复更新state。  </p><p>调用setState的时候，会执行enqueueSetState方法，对partialState 和 _pendingStateQueue进行合并操作，最终通过enqueueUpdate执行state更新。这个也就是setState的时候，将需要更新的state进行合并，让后放到state 队列中，通过this.state = xxx 修改的state，并不会放入state队列中，也就不会更新。</p><p>源码在：src/isomorphic/modern/class/ReactBaseClasses.js  </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ReactComponent.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">partialState, callback</span>) </span>&#123;</span><br><span class="line">  invariant(</span><br><span class="line">    <span class="keyword">typeof</span> partialState === <span class="string">'object'</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> partialState === <span class="string">'function'</span> ||</span><br><span class="line">      partialState == <span class="literal">null</span>,</span><br><span class="line">    <span class="string">'setState(...): takes an object of state variables to update or a '</span> +</span><br><span class="line">      <span class="string">'function which returns an object of state variables.'</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">this</span>.updater.enqueueSetState(<span class="keyword">this</span>, partialState);</span><br><span class="line">  <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">    <span class="keyword">this</span>.updater.enqueueCallback(<span class="keyword">this</span>, callback, <span class="string">'setState'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">src/renderers/shared/stack/reconciler/ReactUpdateQueue.js:</span><br><span class="line">enqueueSetState: <span class="function"><span class="keyword">function</span>(<span class="params">publicInstance, partialState</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> internalInstance = getInternalInstanceReadyForUpdate(</span><br><span class="line">      publicInstance,</span><br><span class="line">      <span class="string">'setState'</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!internalInstance) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> queue =</span><br><span class="line">      internalInstance._pendingStateQueue ||</span><br><span class="line">      (internalInstance._pendingStateQueue = []);</span><br><span class="line">    queue.push(partialState);</span><br><span class="line"></span><br><span class="line">    enqueueUpdate(internalInstance);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/src/renderers/shared/stack/reconciler/ReactUpdates.js:</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enqueueUpdate</span>(<span class="params">component</span>) </span>&#123;</span><br><span class="line">  ensureInjected();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Various parts of our code (such as ReactCompositeComponent's</span></span><br><span class="line">  <span class="comment">// _renderValidatedComponent) assume that calls to render aren't nested;</span></span><br><span class="line">  <span class="comment">// verify that that's the case. (This is called by each top-level update</span></span><br><span class="line">  <span class="comment">// function, like setState, forceUpdate, etc.; creation and</span></span><br><span class="line">  <span class="comment">// destruction of top-level components is guarded in ReactMount.)</span></span><br><span class="line"><span class="comment">// 不处于批量更新模式，马上更新</span></span><br><span class="line">  <span class="keyword">if</span> (!batchingStrategy.isBatchingUpdates) &#123;</span><br><span class="line">    batchingStrategy.batchedUpdates(enqueueUpdate, component);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 处于批量更新模式，则放在dirtyComponent中，不能马上更新</span></span><br><span class="line">  dirtyComponents.push(component);</span><br><span class="line">    <span class="keyword">if</span> (component._updateBatchNumber == <span class="literal">null</span>) &#123;</span><br><span class="line">    component._updateBatchNumber = updateBatchNumber + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用如下例子解释：setSTATE: </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestState</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">val</span> : <span class="number">0</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">val</span>: <span class="keyword">this</span>.state.val + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.val);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">val</span>: <span class="keyword">this</span>.state.val + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.val);</span><br><span class="line"></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">val</span>: <span class="keyword">this</span>.state.val + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.val);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">val</span>: <span class="keyword">this</span>.state.val + <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.val);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TestState;</span><br></pre></td></tr></table></figure><p>输出 0 0 2 3</p><p>在componentDidMount中，<code>this.setState({ val: this.state.val + 1});</code> 处于各种事务中，而事务的进行和结束，都需要一个一个的进行，而不是瞬时执行的，前两个setState语句运行时，isBatchingUpdates设为true了（这个应该是事务导致的），所以此时console.log state制并没有变。而setTimeout中，调用栈都发生变化了，变得很简单，并不处于事务中，也就没有bachedUpdate，所以isBatchingUpdate是false，马上就会更新state。 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;react生命周期&quot;&gt;&lt;a href=&quot;#react生命周期&quot; class=&quot;headerlink&quot; title=&quot;react生命周期&quot;&gt;&lt;/a&gt;react生命周期&lt;/h1&gt;&lt;p&gt;在自定义React组件时，会根据需要在组件生命周期的不同阶段实现不同的逻辑。本文源码
      
    
    </summary>
    
    
      <category term="react" scheme="https://akijiangrou.github.io/tags/react/"/>
    
      <category term="生命周期" scheme="https://akijiangrou.github.io/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    
  </entry>
  
  <entry>
    <title>d3-basic-line</title>
    <link href="https://akijiangrou.github.io/2017/06/29/d3-basic-line/"/>
    <id>https://akijiangrou.github.io/2017/06/29/d3-basic-line/</id>
    <published>2017-06-29T04:19:49.000Z</published>
    <updated>2017-06-29T04:27:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="d3-折线图"><a href="#d3-折线图" class="headerlink" title="d3-折线图"></a>d3-折线图</h1><p>从一个最基本的折线图开始，看看d3是怎么实现的，以及用到哪些知识</p><h2 id="需要的知识"><a href="#需要的知识" class="headerlink" title="需要的知识"></a>需要的知识</h2><ul><li><a href="https://github.com/d3/d3-scale" target="_blank" rel="noopener">scale</a></li><li><a href="https://github.com/d3/d3-array/blob/master/README.md#extent" target="_blank" rel="noopener">extent</a></li><li><a href="https://github.com/d3/d3/blob/master/API.md#transitions-d3-transition" target="_blank" rel="noopener">transition</a></li><li><a href="https://github.com/d3/d3-shape/blob/master/README.md#lines" target="_blank" rel="noopener">line</a></li><li><a href="https://github.com/d3/d3-shape/blob/master/README.md#curves" target="_blank" rel="noopener">curve</a></li><li><a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener">axis</a></li></ul><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol><li><p>获取svg容器</p><pre><code>&lt;svg width=&quot;500&quot; height=&quot;270&quot; class=&quot;testline&quot;&gt;&lt;/svg&gt;const svg = d3.select(&apos;.testline&apos;);const margin = {top: 20, right: 20, bottom: 20, left: 20};const width = +svg.attr(&quot;width&quot;) - margin.left - margin.right;const height = +svg.attr(&quot;height&quot;) - margin.top - margin.bottom;const g = svg.append(&quot;g&quot;).attr(&quot;transform&quot;, `translate(${margin.left},${margin.top})`);</code></pre></li></ol><ol start="2"><li><p>x，y轴缩放<br>这里，如果x轴是与时间有关的，可以直接使用d3提供的scaleTime()来实现时间的转换。关于scale还有好多内容，待总结。这里需要确定两个轴，缩放的类型，以及xy轴图像在屏幕中的实际宽高值。<br>这里的<code>x</code>, <code>y</code> 其实是函数（根据给出的数据，得出该数据的x，y坐标值）。</p><pre><code>const x = d3.scaleTime().range([0, width]);const y = d3.scaleLinear().range([height, 0]);</code></pre></li><li><p>line<br>line的生成就需要上面的轴缩放函数。 这里是因为date函数可以接受ms的unix时间戳，所以乘以1000.这里也可以加一些点与点之间的连接方式。 <code>curveMonotoneX</code>平滑, <code>curveLinear</code>线性。需要两步，line函数生成。line呈现。<br>关于line的展示，需要把数据绑定到path标签上，将line函数运用到path的d属性上。就可以绘制出线了，transition这里是为了实现简单的动画效果。<br>注意，line展示的时候，data([data]) 也可应用datum(data)，前者删了数组标记是不可以的。不知道为什么</p><pre><code>const line = d3.line()  .x((d, i) =&gt; x(d.ts * 1000))  .y(d =&gt; y(d.y))  .curve(d3.curveMonotoneX);// line 的展示。g.append(&apos;path&apos;)      .data([data]).attr(&apos;fill&apos;, &apos;none&apos;).attr(&apos;d&apos;, line).attr(&apos;stroke&apos;, &apos;#f33155&apos;)      .transition(500)      .attr(&apos;stroke-width&apos;, 3);</code></pre></li><li><p>x坐标轴，y坐标轴<br>domain是将坐标轴对应的真实数据连接起来，一般就是将坐标轴要展示的数据的最大最小值放进来。<code>d3.extent</code>可以自动的算出数组内的最小，最大值，很方便。如下x轴的计算。<br>v4支持axisBottom，axisTop，axisRight，axisLeft等快捷操作，就是说明坐标轴的展现方式。<br>规定好domain后，可以将轴展示在图像中了。给出selector然后调用call(如果是x轴，记得把上面x轴函数传进来，y轴同理)，同时，这里可以规定轴线样式和<a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener">刻度</a>的相关内容。下面的例子是规定了，最大最小值中间还可以有多少个刻度。</p><pre><code>x.domain(d3.extent(data, d =&gt; d.ts * 1000));y.domain([0, d3.max(data, d =&gt; d.y * 1.1 )]);// Add the X Axisg.append(&quot;g&quot;).attr(&quot;transform&quot;, `translate(0,${height})`)  .call(d3.axisBottom(x).ticks(5));// Add the Y Axisg.append(&quot;g&quot;).attr(&quot;transform&quot;, `translate(0,0)`)  .call(d3.axisLeft(y).ticks(8));</code></pre></li><li><p>线上打点<br>线上打点，主要是通过line函数，获取点的center位置。需要将data绑定到circle标签上，最后根据line函数绘制出来。</p><pre><code>g.selectAll(&quot;.dot&quot;).data(data).enter().append(&quot;circle&quot;).attr(&apos;class&apos;, &apos;.dot&apos;).attr(&quot;cx&quot;, line.x()).attr(&quot;cy&quot;, line.y()).transition(500).attr(&quot;r&quot;, 3.5).attr(&apos;fill&apos;, &apos;white&apos;).attr(&apos;stroke&apos;, &apos;#f33155&apos;);</code></pre></li></ol><ol start="6"><li><p>数据label<br>类似的，label也是根据line函数获取位置，然后将要现实的值，用text属性显示出来。</p><pre><code>g.selectAll(&quot;.text&quot;)    .data(this.data).enter().append(&quot;text&quot;)    .attr(&apos;class&apos;, &apos;.text&apos;).attr(&apos;font-size&apos;, 12)    .attr(&quot;x&quot;, line.x()).attr(&quot;y&quot;, line.y())    .attr(&apos;dx&apos;, -15).attr(&apos;dy&apos;, 7)    .text(function(d) { return d.y})    .transition(500)    .attr(&apos;fill&apos;, &apos;#333&apos;).attr(&apos;stroke&apos;, &apos;#333&apos;);</code></pre></li></ol><p>当绑定了data数据后，x函数，y函数，会自动按顺序获取数据。</p><p>最后结果：<br><a href="https://codepen.io/akixiao/pen/eRyBdY" target="_blank" rel="noopener">参考</a><br><img src="./line.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;d3-折线图&quot;&gt;&lt;a href=&quot;#d3-折线图&quot; class=&quot;headerlink&quot; title=&quot;d3-折线图&quot;&gt;&lt;/a&gt;d3-折线图&lt;/h1&gt;&lt;p&gt;从一个最基本的折线图开始，看看d3是怎么实现的，以及用到哪些知识&lt;/p&gt;
&lt;h2 id=&quot;需要的知识&quot;&gt;&lt;a
      
    
    </summary>
    
    
      <category term="d3" scheme="https://akijiangrou.github.io/tags/d3/"/>
    
      <category term="line" scheme="https://akijiangrou.github.io/tags/line/"/>
    
      <category term="可视化" scheme="https://akijiangrou.github.io/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>git实用指令</title>
    <link href="https://akijiangrou.github.io/2017/06/02/git%E5%AE%9E%E7%94%A8%E6%8C%87%E4%BB%A4/"/>
    <id>https://akijiangrou.github.io/2017/06/02/git实用指令/</id>
    <published>2017-06-02T02:51:14.000Z</published>
    <updated>2017-06-02T03:23:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="实用指令"><a href="#实用指令" class="headerlink" title="实用指令"></a>实用指令</h1><h2 id="回滚相关"><a href="#回滚相关" class="headerlink" title="回滚相关"></a>回滚相关</h2><p>最近又好好复习了下reset指令。<br>一般这些回滚的操作最好不要用，尤其是在多人开发的时候，但是偶尔想用，还有点模糊了，这次在记录一下。</p><h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><p>步骤：<br>readme中分别添加  </p><p>test1<br>tess2<br>test3  </p><p>每一句添加一个commit<br>先看下log</p><pre><code>git log</code></pre><p><img src="./reset-1.png" width="400px"></p><p>暂存区有其他修改，但没有add。</p><p>此时，<strong>我改错了</strong>，想<strong>回退到test1</strong>的状态。用</p><pre><code>git reset --hard 46670a</code></pre><p>执行后，暂存区的内容也清空了，readme中，只有test1 了。<br>查看git log前两个提交也不见了。</p><p><img src="./reset-2.png" width="400px"></p><p>假如我后悔了，我又不想回退了，我还想在test3的情况下修改。</p><p>git reflog<br><img src="./reset-3.png" width="400px"><br>可以看到指令的log，从这里可以找回之前回退的相关commit<br>这里会记录着还未被回收的commit号。<br>此次，我把内容添加到暂存区了，也就是add过了，<br>再次使用reset，回滚到原来的test3的状态</p><pre><code>git reset --hard 9d91688</code></pre><p>内容回到test3 处的commit，并且，之前add到暂存区的都没了</p><p>真想回滚，用<code>reset</code>就够了。</p><h3 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h3><p>其实是取消某个提交的意思。<br>revert  功能：revert是撤销某一次的提交，并不是回滚到这次提交时的状态！！！  </p><p>revert 的历史保留在commit中</p><h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p>用来合并多个commits<br>场景，我们自己在本地改了好多乱七八糟的，但是并不想让所有的commit信息，比如fix之类的都提交，这个时候可以用rebase 配合 squash ，合并commit。</p><p>过程如下：<br>先</p><pre><code>git log：</code></pre><p><img src="./rebase-1.png" width="400px"></p><p>我们想将0fad78ccc3到现在的commit都合并, 那么先rebase到那个不变动的commit</p><pre><code>git rebase -i 4c9bc3a7</code></pre><p>如下：<br><img src="./rebase-2.png" width="400px"></p><p>需要留一个pick，其他都改成squash, 如下<br><img src="./rebase-3.png" width="400px"></p><p><code>esc</code> <code>:wq</code><br>保存后，这样就把其他的提交都合并了。自动跳到如下界面(这里可以重写合并的commit内容了)<br><img src="./rebase-4.png" width="400px"></p><p>修改完毕，<code>esc</code>  <code>:wq</code> 保存<br><img src="./rebase-5.png" width="400px"></p><p>最后，看下git log，干净了！！！！</p><h3 id="远端分支回滚"><a href="#远端分支回滚" class="headerlink" title="远端分支回滚"></a>远端分支回滚</h3><p>如果远端对应的分支也想修改，必须要—force</p><pre><code>git push --force origin branch-name</code></pre><h3 id="刪除远端分支"><a href="#刪除远端分支" class="headerlink" title="刪除远端分支"></a>刪除远端分支</h3><pre><code>git push origin --delete target_branch</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;实用指令&quot;&gt;&lt;a href=&quot;#实用指令&quot; class=&quot;headerlink&quot; title=&quot;实用指令&quot;&gt;&lt;/a&gt;实用指令&lt;/h1&gt;&lt;h2 id=&quot;回滚相关&quot;&gt;&lt;a href=&quot;#回滚相关&quot; class=&quot;headerlink&quot; title=&quot;回滚相关&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="git" scheme="https://akijiangrou.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>前端页面-网络性能</title>
    <link href="https://akijiangrou.github.io/2017/05/25/%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/"/>
    <id>https://akijiangrou.github.io/2017/05/25/网络优化/</id>
    <published>2017-05-25T02:48:54.000Z</published>
    <updated>2017-05-25T03:02:09.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前端页面-网络性能"><a href="#前端页面-网络性能" class="headerlink" title="前端页面-网络性能"></a>前端页面-网络性能</h1><p>一个网站从开始访问，发送请求，页面渲染，异步请求，到最终呈现，每个阶段都有各自不同的优化点。  </p><p>前一段时间，自己项目的网站在加载和渲染的时候表现很奇怪，遂仔细用起chrome的network以及timeline面板，期待找到问题的根源。用的时候发现很多自己缺失的知识，于是就有这篇文章记录查缺补漏的内容。</p><p>这里先从网络性能角度来看，它将从初始阶段影响网站的性能。<br>下面会以chrome中的network面板出发，从三点介绍网络性能相关内容，分别包括：<strong>主要网络属性</strong>，<strong>如何在chrome devtool中查看网络性能</strong>，<strong>如何优化</strong>  </p><h2 id="主要网络属性"><a href="#主要网络属性" class="headerlink" title="主要网络属性"></a>主要网络属性</h2><p>这里主要关注timing这个属性。某个请求的timing如下：<br><img src="./屏幕快照 2017-05-23 下午8.33.48.png"></p><p>在network页面点击具体的请求url即可进入上述页面。</p><p>可以看到一条资源从列队、停滞、代理协议、初始化连接、SSL协议、发送request、等待及内容下载所耗的时间。 </p><h3 id="主要属性"><a href="#主要属性" class="headerlink" title="主要属性"></a>主要属性</h3><ul><li>Queueing时间：请求排队的时间，出现原因有：更高优先级的请求，或者在HTTP/1.0和HTTP/1.1中，已经有6个同源请求在进行中</li><li>Stalled阻塞时间：原因如上queueing</li><li>DNS Lookup. 浏览器解析请求的ip地址需要的时间</li><li>Proxy negotiation. 与代理服务器通信需要的时间</li><li>Initial Connection / connecting: 建立连接的过程，包含TCP握手/重试，商定SSL</li><li>SSL: 完成SSL握手阶段</li><li>Request sent：发送请求耗时，通常只要不到1ms的时间</li><li>ServiceWorker Preparation.浏览器启动服务worker的时间</li><li>Request to ServiceWorker.The request is being sent to the service worker.</li><li>Waiting (TTFB). 收到首字节的时间。</li><li>Content Download. 浏览器接收响应数据的时间。</li></ul><h3 id="performance-api"><a href="#performance-api" class="headerlink" title="performance api"></a>performance api</h3><p>上面这些资源数据是根据js的性能api计算的。<br><strong>window.performance.getEntries()</strong> 获取资源加载时间列表。每个performanceResourceTiming大概如下：<br><img src="./屏幕快照 2017-05-23 下午8.34.34.png"> </p><ul><li>connectEnd：浏览器与服务器完成建立用以检索资源的网络连接的时间戳  </li><li>connectStart：浏览器与服务器开始建立用以检索资源的网络连接的时间戳</li><li>damainLookupEnd：浏览器完成资源的域名解析的时间戳</li><li>damainLookupStart：浏览器开始进行资源的域名解析的时间戳</li><li>duration：资源请求从开始到结束的时间差</li><li>entryType：PerformanceEntry对象的类型，该对象封装一个单一的性能指标作为性能表的一部分，此类型是<code>frame</code>, <code>mark</code>, <code>measure</code>, <code>navigation</code>, <code>resource</code>,<code>server</code>的其中一个。</li><li>fetchStart：浏览器开始获取资源的时间戳</li><li>initiatorType：资源文件的类型</li><li>name：资源的url</li><li>redirectEnd：接收到重定向资源的最后一个响应字节的时间戳</li><li>redirectStart：启动重定向以获取资源的开始时间戳</li><li>requestStart：浏览器从服务器请求资源的开始时间戳</li><li>responseEnd：浏览器接收到资源最后一个字节的时间戳，或者关闭传输连接的时间戳</li><li>responseStart：浏览器接收到服务器的响应的第一个字节的时间戳</li><li>secureConnectionStart：浏览器开始握手协议，以保护当前连接的安全性，握手开始的时间</li><li>startTime：浏览器开始获取资源前的时间戳(整个过程的开始时间)</li><li>workerStart：如果当前上下文是”worker”，返回开始获取资源的时间戳，否则返回0(应该是应用于双工通信的)</li></ul><p>下面这张图定义了PerformanceResourceTiming 接口的各个时间属性：</p><p><img src="./resource-timing-overview-1.png"></p><p><strong>performance.timing()</strong> 获取页面整体的时间参数<br><img src="./屏幕快照 2017-05-24 上午11.56.02.png"></p><p>这个api可以参考这个非正式的标准规范<a href="https://www.w3.org/TR/resource-timing/" target="_blank" rel="noopener">Resouce timing - w3c</a>   <a href="https://www.w3.org/TR/performance-timeline/#sec-PerformanceEntry-interface" target="_blank" rel="noopener">old one</a></p><p>该规范定义了一个用于Web应用程序的接口，这个接口可以访问文档需要的资源的完整时序信息。 接口的详细说明这里就不一一介绍了，细节了解需要自己去读标准。 下面只挑和我们相关的内容。 </p><p>由上面这个图，我们可以获取到chrome网络面板中，timing的相关信息，举个例子：   </p><p>页面整体的时间参数 （mta应该有用到以下参数） </p><pre><code>pageloadtime = t.loadEventStart - t.navigationStart,  dns = t.domainLookupEnd - t.domainLookupStart,  tcp = t.connectEnd - t.connectStart,  ttfb = t.responseStart - t.navigationStart; </code></pre><p>某个资源的时间参数 </p><pre><code>var r0 = performance.getEntriesByType(&quot;resource&quot;)[0],    loadtime = r0.duration,    dns = r0.domainLookupEnd - r0.domainLookupStart,    tcp = r0.connectEnd - r0.connectStart,    ttfb = r0.responseStart - r0.startTime;</code></pre><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>还有一些其他的测量时间的问题，请参考<a href="http://mutongwu.iteye.com/blog/2164917?utm_source=tuicool" target="_blank" rel="noopener">performance的资源计时统计</a><br>其他方法使用，参考<a href="http://www.alloyteam.com/2015/09/explore-performance/" target="_blank" rel="noopener">初探performance-监控网页与程序性能</a>  </p><h2 id="如何在chrome-devtool中查看网络性能"><a href="#如何在chrome-devtool中查看网络性能" class="headerlink" title="如何在chrome devtool中查看网络性能"></a>如何在chrome devtool中查看网络性能</h2><p>在chrome devtool中，我们可以模拟各种网络环境，可以过滤请求，查看http请求信息，了解dom加载时间，cookie信息，资源的上下游等等。</p><p>内容略多，参考这里，chrome developers 官网<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/" target="_blank" rel="noopener">测量网络性能</a><br>英文不好的可以看这个：<a href="http://www.jianshu.com/p/471950517b07" target="_blank" rel="noopener">Chrome DevTools 之 Network，网络加载分析利器</a></p><h2 id="如何优化"><a href="#如何优化" class="headerlink" title="如何优化"></a>如何优化</h2><p>网站加载时间对用户的影响：<br>0.1秒：秒开<br>100-300 ：比较小的可察觉的延迟<br>300-1s：Machine is working<br>1秒：还能接受，但是已经不开心了<br>10秒：什么破玩意，不想看了<br>chrome developer里提到，目标是250ms</p><p>优化主要从四个属性入手，以下基本翻译自chrome devtool </p><h3 id="Queued-or-stalled-requests"><a href="#Queued-or-stalled-requests" class="headerlink" title="Queued or stalled requests"></a>Queued or stalled requests</h3><p>这两个指标如果时间很长，说明很多资源等待<br><strong>造成的原因</strong>：访问同一个域名的请求太多，对于http1.1来说，每个host最多同时支持6个tcp连接。</p><p><strong>解决</strong>：</p><ul><li>域名分片：将资源放在不同的域名中，用来克服浏览器对同一个域名访问的限制，但是不能过多因为dns解析也需要时间  </li></ul><p><strong>[备注]</strong>domain sharding (域名分片)（<a href="https://wp-rocket.me/blog/difference-cdn-and-domain-sharding/" target="_blank" rel="noopener">和cdn的不同</a>域名分片是一种分布方式，是将资源分布在不同的域名中达到克服浏览器访问限制的目的；cdn则是在不同的服务器上托管世界各地的网站资源。<br>）</p><ul><li>使用http2.0<br>让重要的请求先发起，不重要的remove或者推迟。</li></ul><h3 id="Slow-Time-To-First-Byte-TTFB"><a href="#Slow-Time-To-First-Byte-TTFB" class="headerlink" title="Slow Time To First Byte (TTFB)"></a>Slow Time To First Byte (TTFB)</h3><p><strong>起因：</strong> client与server的连接慢；server响应太慢</p><p><strong>解决：</strong></p><ul><li>连接慢， 使用cdn，或者换个服务商</li><li>如果server慢，优化数据库查询，用缓存，修改server配置等。</li></ul><h3 id="Slow-content-download"><a href="#Slow-content-download" class="headerlink" title="Slow content download"></a>Slow content download</h3><p><strong>原因：</strong>网络不好；内容过大</p><p><strong>解决：</strong></p><ul><li>连接慢， 使用cdn，或者换个服务商；</li><li>优化请求使数据更少。</li></ul><p><hr><br>以上是关于网络层面的网站优化内容，与前端人员开发技术能力相关性不大，需要一些网络层面以及后台来支持。当我们发现网页加载过慢的时候，可以先从网络这边入手，把网络和连接的基础问题排查后，再从优化自己写的代码入手。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前端页面-网络性能&quot;&gt;&lt;a href=&quot;#前端页面-网络性能&quot; class=&quot;headerlink&quot; title=&quot;前端页面-网络性能&quot;&gt;&lt;/a&gt;前端页面-网络性能&lt;/h1&gt;&lt;p&gt;一个网站从开始访问，发送请求，页面渲染，异步请求，到最终呈现，每个阶段都有各自不同的
      
    
    </summary>
    
    
      <category term="timing" scheme="https://akijiangrou.github.io/tags/timing/"/>
    
  </entry>
  
  <entry>
    <title>高德地图api使用总结</title>
    <link href="https://akijiangrou.github.io/2017/05/18/%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEapi%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <id>https://akijiangrou.github.io/2017/05/18/高德地图api使用总结/</id>
    <published>2017-05-18T04:28:44.000Z</published>
    <updated>2017-05-18T07:11:35.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常用的高德地图api"><a href="#常用的高德地图api" class="headerlink" title="常用的高德地图api"></a>常用的高德地图api</h1><p>关于appkey，分为两种，一个是api调用的key，一个是地图服务的key，例如，获取门店信息，search功能等等。</p><h2 id="脚本加载"><a href="#脚本加载" class="headerlink" title="脚本加载"></a>脚本加载</h2><pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;http://webapi.amap.com/maps?v=1.3&amp;key=您申请的key值&quot;&gt;&lt;/script&gt;</code></pre><p>需要把这个脚本加载完成后，才能使用AMap。</p><p>可以使用<code>map-div</code>这个组件。</p><p>如果搭配react，需要在componentDidMount阶段，调用<code>map-div</code> 中的createMap函数。配套的，最好将该地图实例保存在一个对象中，并设置一个flag作为地图加载完成的标志位，以便react使用。</p><p>示例：  </p><pre><code>mapInstance.jslet __value = null;export default {  getter: () =&gt; __value,  setter: (val) =&gt; { __value = val; },};---------------------------------------const mapConfig = {  name: &apos;AMap&apos;,  initOpts: {    zoom: MAP_CONFIG.zoom,    zooms: MAP_CONFIG.zooms,  },  query: {    plugin: &apos;AMap.Geocoder,AMap.CitySearch&apos;,  },};componentDidMount() {  (async () =&gt; {    const mapIns = await createMap(mapConfig, &apos;mapComponent&apos;);    mapInstance.setter(mapIns);    this.props.setMapInstanceFlag(true);    // 一些事件监听    mapEventHandler(mapIns, &apos;dragend&apos;, &apos;on&apos;, throttle(this.handleMapScale, 800));    mapEventHandler(mapIns, &apos;click&apos;, &apos;on&apos;, throttle(this.handleMapClick, 800));    ...  })();  ...}</code></pre><h2 id="创建地图对象"><a href="#创建地图对象" class="headerlink" title="创建地图对象"></a>创建地图对象</h2><p>需要给出一个div作为地图的容器。</p><pre><code>&lt;div id=&quot;container&quot; style=&quot;width:800px; height:500px&quot;&gt;&lt;/div&gt;var map = new AMap.Map(&apos;container&apos;,{ config })</code></pre><p><strong>注意：</strong> 如果不加center，地图默认显示用户当前城市范围</p><h3 id="config常用基本配置"><a href="#config常用基本配置" class="headerlink" title="config常用基本配置"></a>config常用基本配置</h3><table><thead><tr><th>options</th><th>说明</th></tr></thead><tbody><tr><td>zoom</td><td>缩放级别</td></tr><tr><td>center</td><td>地图中心点坐标[lon, lat]</td></tr><tr><td>zooms</td><td>地图可以缩放的范围 ，数组格式[max, min]</td></tr><tr><td>zoomEnable</td><td>是否可缩放，默认为true</td></tr><tr><td>dragEnable</td><td>是否可拖拽，默认为true</td></tr><tr><td>mapStyle</td><td>地图显示样式，normal（默认样式）、dark（深色样式）、light（浅色样式）、fresh(osm清新风格样式)、blue_night</td></tr><tr><td>features</td><td>地图上显示的元素种类， 默认都显示，支持’bg’（地图背景）、’point’（POI点）、’road’（道路）、’building’（建筑物）</td></tr></tbody></table><h2 id="常用的地图实例方法"><a href="#常用的地图实例方法" class="headerlink" title="常用的地图实例方法"></a>常用的地图实例方法</h2><h3 id="地图常用方法"><a href="#地图常用方法" class="headerlink" title="地图常用方法"></a>地图常用方法</h3><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>getZoom()， setZoom()</td><td>缩放级别</td></tr><tr><td>getCenter(), setCenter()</td><td>获取地图中心点坐标[lon, lat]</td></tr><tr><td>setZoomAndCenter</td><td>同时设定缩放级别和中心点坐标</td></tr><tr><td>setCity(city:String，callback:Functon)</td><td>通过设置城市名称来设置地图显示的中心点</td></tr><tr><td>zoomIn</td><td>地图放大一级</td></tr><tr><td>zoomOut</td><td>地图缩小一级</td></tr></tbody></table><h3 id="地图常用事件类型"><a href="#地图常用事件类型" class="headerlink" title="地图常用事件类型"></a>地图常用事件类型</h3><ul><li>click: 鼠标左键单击  </li><li>mapmove: 地图平移时触发</li><li>movestart: 地图平移开始时触发</li><li>moveend: 地图移动结束后触发，包括平移和缩放(经试验，缩放并没有触发moveend)。</li><li>zoomchange: 地图缩放级别更改后触发</li><li>zoomstart: 缩放开始时触发</li><li>zoomend: 缩放停止时触发</li><li>dragstart: 开始拖拽地图时触发</li><li>dragend: 停止拖拽地图时触发</li><li>dragging: 拖拽地图过程中触发</li></ul><p>如果地图操作后会有其他操作，一般监听  XXXend 方法。<br>注意：setCity，setCenter等操作不会触发drag相关内容。</p><h3 id="关于amap的事件绑定"><a href="#关于amap的事件绑定" class="headerlink" title="关于amap的事件绑定"></a>关于amap的事件绑定</h3><p>有两种方法：  </p><ul><li><p>针对Map、覆盖物等常用类<br>直接使用on， off 方法来实现事件的简单绑定和移除</p></li><li><p>使用AMap.event命名空间<br>addDomListener(domobj, eventName, handler, context(没用过，不清楚))<br>addListener(obj, eventName, handler, context(没用过，不清楚))<br>removeListener(listener): 可以移除dom和非dom事件。</p><p><a href="http://lbs.amap.com/api/javascript-api/example/event/dom-event/" target="_blank" rel="noopener">参考</a></p></li></ul><h3 id="事件event中的内容"><a href="#事件event中的内容" class="headerlink" title="事件event中的内容"></a>事件event中的内容</h3><ul><li>所有的CLICK事件<br>点击位置的经纬度，对应在画布上的横纵坐标，事件target， 事件type<br><img src="./pic2.png"></li><li>其他类型事件，如moveend，zoom<br>event中只有事件类型type</li></ul><p>针对以上，我们可以对地图事件进行封装，一般需要的是事件发生的zoom，地图范围，点击位置的经纬度。<br>🌰如下:</p><pre><code>const eventInjector = (ev, mapINS, cb) =&gt; {    const bounds = mapINS.getBounds();    const param = {        sw: bounds.getSouthWest(),        ne: bounds.getNorthEast(),        zoom: mapINS.getZoom(),        type: ev.type,        lng: ev.lnglat ? ev.lnglat.getLng() : &apos;&apos;,        lat: ev.lnglat ? ev.lnglat.getLat() : &apos;&apos;,    };      if (cb) cb(param);};const mapEventHandler = (mapINS, type, opt, cb) =&gt; mapINS[opt](type, (ev) =&gt; eventInjector(ev, mapINS, cb));//使用mapEventHandler(mapIns, &apos;dragend&apos;, &apos;on&apos;, this.handleMapScale);mapEventHandler(mapIns, &apos;dragend&apos;, &apos;off&apos;,this.handleMapScale);//handleMapScale handleMapScale(ev) {   console.log(ev);   const { ne, sw, zoom, type } = ev;   ... }</code></pre><p>之后，如果在地图上发生dragend，event的结果如下：<br><img src="./pic1.png"></p><h2 id="常用地图基本类型"><a href="#常用地图基本类型" class="headerlink" title="常用地图基本类型"></a>常用地图基本类型</h2><h3 id="LngLat-：-经纬度坐标，确定地图上的一个点"><a href="#LngLat-：-经纬度坐标，确定地图上的一个点" class="headerlink" title="LngLat ： 经纬度坐标，确定地图上的一个点"></a>LngLat ： 经纬度坐标，确定地图上的一个点</h3><p>构造函数： AMap.LngLat(lng: 119.78, lat: 39.99);<br>生成一个经纬度为[119.78, 39.99]的地理坐标对象。<br>常用方法：  </p><pre><code>- getLng()    获取经度- getLat()    获取纬度- offset(w:2,s:-3)   w经度，s纬度，参数为数字。将当前经纬度坐标值变化。经度是越向右越大，所以向右为正。同理，纬度越向上越大，所以向上为正。    - distance(lnglat: LngLat | [lng, lat])  当前经纬度与传入的经纬度的连线的地面距离- equals(lnglat:LngLat)</code></pre><h3 id="Bounds：经纬度范围矩形框"><a href="#Bounds：经纬度范围矩形框" class="headerlink" title="Bounds：经纬度范围矩形框"></a>Bounds：经纬度范围矩形框</h3><p>AMap.Bounds(southWest:LngLat1, northEast:LngLat2);<br>生成一个东北角是LngLat2，西南角是LngLat1  的矩形地物框。<br>常用方法：    </p><pre><code>- contains(point: LngLat)   给出的经纬度点是否包含在矩形范围内- getCenter()- getSouthWest()- getNorthEast()</code></pre><h2 id="常用覆盖物"><a href="#常用覆盖物" class="headerlink" title="常用覆盖物"></a>常用覆盖物</h2><h3 id="AMap-Marker"><a href="#AMap-Marker" class="headerlink" title="AMap.Marker"></a>AMap.Marker</h3><ul><li>构造：AMap.Marker({ markeroptions })  </li><li>常用选项<br><strong>map</strong>:marker所在的地图<br><strong>position</strong>: LngLat类型，点在地图上的位置<br><strong>offset</strong>: 像素类型(-75，-75)，marker距离左上角的偏移<br><strong>content</strong>: string/object  这里可以自定义marker显示的内容，图片，svg等都可以。<br><strong>bubble</strong>: 将覆盖物的事件冒泡到地图上，默认false<br><strong>zIndex</strong>: 叠加顺序<br><strong>title</strong>: 鼠标滑过时，点标记的文字提示。<br><strong>extData</strong>: 用户自定义属性<br><strong>draggable</strong>: 标记点是否可以拖拽移动</li><li>方法略多，这里就不写了，基本对应每个选项都会有个get，set方法。hide，show控制点标记的隐藏，还在map中。setMap比较有用，如果设为null，则在地图上移除当前Marker相关的div。还有一些移动类的应用，目前还没使用过，这里就不详述了，主要有：<code>moveAlong</code>, <code>moveTo</code>, <code>stopMove</code>, <code>pauseMove</code>, <code>resumeMove</code>。</li><li>事件与地图对象基本一致，少了个ready。多了一些move的行为，<a href="http://lbs.amap.com/api/javascript-api/reference/overlay#Marker" target="_blank" rel="noopener">具体可参考</a></li></ul><h3 id="AMap-Polygon"><a href="#AMap-Polygon" class="headerlink" title="AMap.Polygon"></a>AMap.Polygon</h3><ul><li>构造：AMap.Polygon({ options })  </li><li><p>常用选项<br><strong>map</strong>:marker所在的地图<br><strong>path</strong>: 参数为，包含经纬度数组的数组.  </p><pre><code>eg：[         [116.368904, 39.913423],        [116.382122, 39.901176],        [116.387271, 39.912501],        [116.398258, 39.904600]    ] </code></pre></li></ul><p>  <strong>bubble</strong>: 将覆盖物的事件冒泡到地图上，默认false。<br>  <strong>zIndex</strong>: 叠加顺序, 默认比marker低。<br>  <strong>类似svg的多边形属性</strong>: strokeColor，strokeOpacity， strokeWeight， fillColor， fillOpacity， strokeStyle， strokeDasharray。<br>  <strong>extData</strong>: 自定义属性</p><ul><li>方法。对应path，extData， options都会有个get，set方法。hide，show控制多边形的隐藏，多边形还在map中。setMap比较有用，如果设为null，则在地图上移除当前polygon相关的div。getBounds,矩形范围对象，返回Bounds类型。getArea,获取多边形面积。contains(point:LngLat)，点是否在polygon内。</li><li>事件很多，常用的又mouseover， click等。<a href="http://lbs.amap.com/api/javascript-api/reference/overlay#Polygon" target="_blank" rel="noopener">具体可参考</a>  </li></ul><h3 id="AMap-Circle"><a href="#AMap-Circle" class="headerlink" title="AMap.Circle"></a>AMap.Circle</h3><ul><li>构造：AMap.Circle({ options })  </li><li><p>常用选项<br><strong>map</strong>:marker所在的地图<br><strong>center</strong>: LngLat类型，圆心在地图上的位置<br><strong>radius</strong>: 半径，number类型，单位是米<br><strong>bubble</strong>: 将覆盖物的事件冒泡到地图上，默认false<br><strong>zIndex</strong>: 叠加顺序, 默认比marker低。<br><strong>extData</strong>: 用户自定义属性<br><strong>类似svg的多边形属性</strong>： 同上polygon</p></li><li><p>方法。对应center，extData， radius，options都会有个get，set方法。hide，show控制隐藏，还在map中。setMap同上。getBounds，圆外切矩形范围对象，返回Bounds类型。contains(point:LngLat)，点是否在圆内。</p></li><li>事件类型类似polygon  <a href="http://lbs.amap.com/api/javascript-api/reference/overlay#Circle" target="_blank" rel="noopener">具体可参考</a></li></ul><h3 id="AMap-Polyline"><a href="#AMap-Polyline" class="headerlink" title="AMap.Polyline"></a>AMap.Polyline</h3><ul><li>构造：AMap.Marker({ markeroptions })  </li><li>常用选项，与polygon差不多。多一些线条相关的内容，<a href="http://lbs.amap.com/api/javascript-api/reference/overlay#Polyline" target="_blank" rel="noopener">具体可参考</a></li><li>方法和事件与polygon差不多</li></ul><h2 id="常用图层"><a href="#常用图层" class="headerlink" title="常用图层"></a>常用图层</h2><p>图层是位于最底层的模块，他可能在地图上的其他物件还没加载完就已经生成了。图层都需要地图以plugin的形式引进。  </p><h3 id="AMap-Heatmap"><a href="#AMap-Heatmap" class="headerlink" title="AMap.Heatmap"></a>AMap.Heatmap</h3><p>heatmap是个plugin，需要添加plugin，在回调函数中生成AMap.Heatmap实例。</p><pre><code>const heatmap;map.plugin([&quot;AMap.Heatmap&quot;], function() {  heatmap = new AMap.Heatmap(map, {        radius: 25, //给定半径        opacity: [0, 0.8]    });});</code></pre><p>上面的config，包含<code>radius`</code>gradient<code>opacity</code>zooms`(支持的缩放级别，不在范围内，就不显示热力图了)<br>渐变可以按照如下设置  </p><pre><code>gradient: { 0.4: &apos;red&apos;, 0.8: &apos;yellow&apos;, 1: &apos;blue&apos;}</code></pre><p><strong>方法</strong><br>与覆盖物的差不多，除了，  </p><pre><code>addDataPoint(lng: Lng, lat: Lat, count: number)  setDataSet(data: obj, url:jsonp格式数据的服务地址，urlDataParser:可以传递函数进行数据转化) // 这两个可以配合zoom，不同的zoom，热力图对应的数据集不同。 </code></pre><p>其中，data格式为：</p><pre><code>{ max: number,  data: [  { lng: 116.7, lat: 39.9, count: 10 },   { lng: 116.7, lat: 39.9, count: 10 }],}</code></pre><h3 id="AMap-CustomLayer"><a href="#AMap-CustomLayer" class="headerlink" title="AMap.CustomLayer"></a>AMap.CustomLayer</h3><p>同样需要plugin来引入。</p><p>给出的属性和方法很少，但是功能强大，需要自己开发，<a href="http://lbs.amap.com/api/javascript-api/example/layers/custom-layer/" target="_blank" rel="noopener">参考实例</a>  </p><p>一般是自己做一些canvas，然后挂载在map上即可。<br>自定义图层有个render属性？使其等于绘制函数，就可以在地图上绘制出来。</p><h2 id="搜索服务"><a href="#搜索服务" class="headerlink" title="搜索服务"></a>搜索服务</h2><p>支持搜索服务脱离地图使用，即使用搜索服务不再需要先实例化地图。通过AMap.plugin方法，加载需要的服务</p><h3 id="AMap-Autocomplete"><a href="#AMap-Autocomplete" class="headerlink" title="AMap.Autocomplete"></a>AMap.Autocomplete</h3><ul><li><p>常用选项：<br><strong>city:</strong>输入提示被限定的城市<br><strong>citylimit:</strong> 是否强制限制在设置的城市内搜索<br><strong>input:</strong>指定一个输入框，内容则作为input的id，在input输入文字后，会自动生成一个下拉选择列表。</p></li><li><p>search方法，可以结合他的search方法，获取数据，然后自己render样式~~</p><p>AutocompleteResult对象： </p><pre><code>{ info： 状态说明,  count: 输入提示条数,  tips: [    { name: 名称, district: 所属区域, ,adcode: 区域编码},    { name: 名称, district: 所属区域, ,adcode: 区域编码}...  ]}</code></pre></li></ul><p>通常autocomplete配合placeSearch进行使用的</p><h3 id="AMap-PlaceSearch"><a href="#AMap-PlaceSearch" class="headerlink" title="AMap.PlaceSearch"></a>AMap.PlaceSearch</h3><ul><li><p>常用选项：<br><strong>city:</strong>输入提示被限定的城市<br><strong>citylimit:</strong> 是否强制限制在设置的城市内搜索<br><strong>type:</strong>兴趣点类别，可以通过setType设置<br><strong>pageSize:</strong>单页显示结果条数<br><strong>extensions:</strong> ‘all’ 返回基本+详细信息<br><strong>panel&amp;renderStyle</strong>结果列表的html容器id，或者容器元素，结果列表将在给出的容器中进行展示，自己可以render样式。</p></li><li><p>可用方法见<a href="http://lbs.amap.com/api/javascript-api/reference/search#m_AMap.PlaceSearch" target="_blank" rel="noopener">参考</a>吧</p></li></ul><p>上个search使用示例：  </p><pre><code>html： &lt;img  className={styles.searchIcon}  src={searchIcon}  alt=&quot;search&quot;  onClick={() =&gt; this.handleSearch()}/&gt;js:handleSearch() {// this.state.placeSearch是个AMap.Autocomplete实例    this.state.placeSearch.search(this.refs.searchInput.value,             this.handleSearchSelect); } handleSearchSelect(search, result) {    if (result.info === &apos;OK&apos;) {      // mapInstance是个封装了AMap的对象。      const mapIns = mapInstance.getter();      // 自定义搜索结果的marker样式。并绘制在地图上      this.generateSearchMarkers(result.poiList);      if (result.poiList.pois.length &gt; 0) {        const { lng, lat } = result.poiList.pois[0].location;        // 将map的中心定位到获取到的第一个poi的位置上。        mapIns.setCenter([lng, lat]);        mapIns.zoomIn();      }    }  }</code></pre><p> 如果查到结果searchResult有以下内容：<br> <img src="/Users/zcx/Desktop/屏幕快照 2017-05-18 下午2.38.49.png"></p><p>其他还有好多具体的搜索的服务。由于没有用到，就没看。。。</p><h2 id="信息窗体"><a href="#信息窗体" class="headerlink" title="信息窗体"></a>信息窗体</h2><h3 id="AMap-InfoWindow"><a href="#AMap-InfoWindow" class="headerlink" title="AMap.InfoWindow"></a>AMap.InfoWindow</h3><p>用于在地图上弹出一个详细信息展示窗体，地图上只允许同时展示1个信息窗体  </p><ul><li>属性<br><strong>isCustom：</strong> 是否自定义窗体，true 则完全按照content中的规定来显示<br><strong>autoMove：</strong> 将窗体完全展现在视图中。<br><strong>closeWhenClickMap: </strong>鼠标点击地图后是否关闭信息窗体<br><strong>position: </strong>信息窗体显示位置，类型为经纬度对象  </li><li>方法事件类似polygon，有一些属性的get，set方法，open，close方法。</li></ul><h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h2><h3 id="AMap-CitySearch"><a href="#AMap-CitySearch" class="headerlink" title="AMap.CitySearch"></a>AMap.CitySearch</h3><p>项目中用到这个api。它主要是根据ip返回对应的城市信息，根据输入ip或自动获取ip来获取城市信息。<br>该api也是个plugin，可以在初始loader地图的时候，就将其配置进去，将脚本加载时的代码。  </p><p>两个方法：<br>getLocalCity((status, citySearchResult) =&gt; {…})<br>getCityById(ip, (status, citySearchResult) =&gt; {})</p><p>例子：   </p><pre><code>// citysearch部分代码，省略地图实例了，用mapIns代替citysearch.getLocalCity((status, result) =&gt; {    if (status === &apos;complete&apos; &amp;&amp; result.info === &apos;OK&apos;) {      if (result &amp;&amp; result.city &amp;&amp; result.bounds) {        const city = R.slice(0, -1, result.city);        const cindex = R.indexOf(city, R.pluck(&apos;cityName&apos;, cityList));        const ccode = R.pluck(&apos;cityCode&apos;, cityList);        if (cindex !== -1 &amp;&amp; city !== &apos;北京&apos;) {          mapIns.setCity(city);          mapIns.setZoom(11);        }      }    }});</code></pre><p>citySearchResult 的属性：city， bounds</p><h2 id="位置解析"><a href="#位置解析" class="headerlink" title="位置解析"></a>位置解析</h2><h3 id="AMap-Geocoder"><a href="#AMap-Geocoder" class="headerlink" title="AMap.Geocoder"></a>AMap.Geocoder</h3><p>Geocoder是进行地址描述与地理坐标间的相互转换。也就是，给出一个地址名称，转换为地理坐标的经纬度等信息。或者给出一个经纬度，确定这个点的地址名称信息。  </p><p>相关方法：</p><ul><li><p>获取地理编码：<br>getLocation(address:String, (status:String,result:info/GeocodeResult) =&gt; {})</p></li><li><p>逆地理编码：<br>getAddress(location:LngLat|Array.<lnglat>,<br>(status:String,result:info/ReGeocodeResult) =&gt; {})<br>// 最多20个地址数组。</lnglat></p></li></ul><p>s<br>用的比较多的是逆地理编码，比如自己做一个在地图上点击，然后找出该位置的相关信息。<br>逆地理编码的返回结果属性：想展示什么，就从以下选择吧<br><img src="./pic3.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;常用的高德地图api&quot;&gt;&lt;a href=&quot;#常用的高德地图api&quot; class=&quot;headerlink&quot; title=&quot;常用的高德地图api&quot;&gt;&lt;/a&gt;常用的高德地图api&lt;/h1&gt;&lt;p&gt;关于appkey，分为两种，一个是api调用的key，一个是地图服务的key
      
    
    </summary>
    
    
      <category term="js" scheme="https://akijiangrou.github.io/tags/js/"/>
    
      <category term="地图api" scheme="https://akijiangrou.github.io/tags/%E5%9C%B0%E5%9B%BEapi/"/>
    
      <category term="总结" scheme="https://akijiangrou.github.io/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>css3实现3d效果</title>
    <link href="https://akijiangrou.github.io/2017/05/15/css3%E5%AE%9E%E7%8E%B03d%E6%95%88%E6%9E%9C/"/>
    <id>https://akijiangrou.github.io/2017/05/15/css3实现3d效果/</id>
    <published>2017-05-15T08:34:12.000Z</published>
    <updated>2017-05-18T07:11:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="css3实现3D效果"><a href="#css3实现3D效果" class="headerlink" title="css3实现3D效果"></a>css3实现3D效果</h2><h3 id="相关属性"><a href="#相关属性" class="headerlink" title="相关属性"></a>相关属性</h3><ul><li>transform: rotateX(…)</li><li>transfrom-origin: left center;</li><li>transform-style: preserve-3d;</li><li>perspective: 200px;</li><li>perpective-origin: left center;</li><li>backface-visibility: true;</li></ul><h3 id="3d效果基础知识"><a href="#3d效果基础知识" class="headerlink" title="3d效果基础知识"></a>3d效果基础知识</h3><p>一般是在旋转后才能表现出3d效果，css中规定的旋转规则如下：<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="./axis.png" alt="alt axis" title>                </div>                <div class="image-caption">alt axis</div>            </figure></p><p>rotateX是以屏幕的水平方向为轴旋转，rotateY是以屏幕的垂直方向为轴，rotateZ是以与屏幕平面垂直的方向为轴。<br>其实rotatex rotateY已经能实现3d效果了，但是不是很直观。搭配上perspective，perfect！</p><h3 id="perspective"><a href="#perspective" class="headerlink" title="perspective"></a>perspective</h3><p>含义：透视效果。指定了观察者与z=0平面的距离，使具有三维位置变换的元素产生透视效果。等同于绘画中的1点透视||平行透视。<br>一个物体如果z-index为正，那么我们在画布中实际看到的就要偏大。如下第一个图。如果一个物体的z-index为负，那么显示在画布视图中，则偏小，如第二个图<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="./view.png" alt="alt perspective" title>                </div>                <div class="image-caption">alt perspective</div>            </figure></p><p><strong>两种写法:</strong><br><code>a：perspective：300px;</code><br><code>b：transform: perspective(300px) rotateX(aa);</code>  </p><p><strong>区别</strong>：第一个需要写在一个父级元素上，他规定了这个父级元素的透视点位置，换个角度说，当为元素规定perspective 属性时，其直接子元素会获得透视效果，而不是元素本身。第二个可以直接作用在当前元素上，也可以结合其他transform属性，规定了当前元素的透视点位置，对其他元素无影响。<br>&nbsp;&nbsp;&nbsp;&nbsp;<strong>perspective</strong> 值越大，3d效果越不明显；越小越明显。想像成镜头到物体的距离，越近越能看出高低起伏，越远线条展示的越平缓。<br>两种写法以及perspective对比，<a href="https://codepen.io/akixiao/pen/wdwdgW" target="_blank" rel="noopener">查看示例</a></p><h3 id="webkit-perspective-origin"><a href="#webkit-perspective-origin" class="headerlink" title="-webkit-perspective-origin"></a>-webkit-perspective-origin</h3><p>消失点的位置，<br>语法：<code>-webkit-perspective-origin: xpos ypos</code><br>xpos,ypos 可以选择关键字，left|right|center     top|bottom|center 。如果是关键字，则是否对应xy无关紧要，浏览器会自己选择。如果是数值，百分比或者像素，则要按照x，y的顺序写。<br><a href="https://codepen.io/akixiao/pen/qmWeqj" target="_blank" rel="noopener">参考实例</a></p><h3 id="backface-visibility"><a href="#backface-visibility" class="headerlink" title="backface-visibility"></a>backface-visibility</h3><p><code>backface-visibility</code> 属性定义当元素不面向屏幕时是否可见。有些时候前面的div如果设置了透明度，就会看到后面的对象，这是可以将该属性设为hidden就可以了。默认：<code>visible</code></p><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h3><p>这里主要提和3d有关的几个属性  </p><ul><li>rotateX( angle )</li><li>rotateY( angle )</li><li>rotateZ( angle )</li><li>translateZ( tz )</li><li>scaleZ( sz )</li><li>translateZ，scaleZ会将对象在与屏幕平行的方向变化物体。会有失真。</li></ul><p>也有综合的写法：  </p><ul><li>translate3d( tx, ty, tz )</li><li>scale3d( sx, sy, sz )</li><li>rotate3d( rx, ry, rz, angle )</li></ul><p>rotate3d这里，前三个规定旋转轴在空间中的方向，比如x轴，就是（1，0，0）<br><code>rotate3d(1,0,0,90deg)   ===  rotateX(90deg)</code></p><h3 id="transform-origin"><a href="#transform-origin" class="headerlink" title="transform-origin"></a>transform-origin</h3><p>规定变化的中心点。一般都是对象的重心。可以修改成任意的值，以旋转为例:</p><pre><code>html&lt;div class=&quot;test1&quot;&gt;test&lt;/div&gt;&lt;div class=&quot;test2&quot;&gt;test2&lt;/div&gt;cssdiv {  width:200px;  height: 200px;  background: rgba(255, 0, 0,.5);  margin: 20px auto;  animation: mymove 3s infinite;}.test1{  transform: perspective(500px) rotateY(0deg);}.test2 {  transform-origin: left;  transform: perspective(500px) rotateY(0deg);}@keyframes mymove{  from {transform: perspective(500px) rotateY(0deg);}  to {transform:perspective(500px) rotateY(360deg);}}</code></pre><p>表现是：test1将沿着div的宽度的一半为轴旋转。test2则沿着最左边的边框为轴旋转。<br><a href="https://codepen.io/akixiao/pen/mmdKYJ?editors=0100" target="_blank" rel="noopener">参考实例</a></p><h3 id="实例一：翻牌效果"><a href="#实例一：翻牌效果" class="headerlink" title="实例一：翻牌效果"></a>实例一：翻牌效果</h3><pre><code>&lt;div class=&quot;container&quot;&gt;  &lt;div id=&quot;card&quot;&gt;    &lt;div class=&quot;front&quot;&gt;1&lt;/div&gt;    &lt;div class=&quot;back&quot;&gt;2&lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;//css,设置一个container，他是个具有3d效果的box.container {  width: 200px;  height: 200px;  position: relative;  perspective: 800px;  border: 1px solid #888;  margin: 40px auto;}#card {  width: 100%;  height: 100%;  position: absolute;  transform-style: preserve-3d;  animation: flip 2s infinite;  transform-origin: left center;}#card figure {  display: block;  width: 100%;  height: 100%;  position: absolute;  text-align: center;  color: white;  font-size: 40px;  line-height: 200px;  backface-visibility: hidden;}.front {  background: tomato;}.back {  background: lightblue;  transform: rotateY( 180deg );}@keyframes flip {  0% {    transform: rotateY( 0deg );  }  50% {    transform: rotateY( 180deg ) translateX(-100%);  }  100% {    transform: rotateY( 360deg )  }}</code></pre><p>container中的card div具有3d效果，如果想让card中的div等也有3d变化效果，可以通过对card设置： <code>transform-style: preserve-3d;</code> 将其父元素的3d透视集成下来，并使所有子元素保持在同一个3d空间中。背面那张牌需要翻到背面去，也就是<code>rotateY( 180deg );</code><br><a href="http://codepen.io/akixiao/pen/WjeWqQ" target="_blank" rel="noopener">参考示例</a></p><p>###实例二：旋转的正方体<br><a href="http://codepen.io/akixiao/pen/gWYNZo" target="_blank" rel="noopener">参考示例</a><br>六个div拼凑起来的。分别在xy方向上进行翻转，立到对应的方向。此时在添加一个<code>translateZ</code>才能显现出他们的效果。否则都是堆在zindex为0的位置，什么都看不见.  </p><p>别的配置及思想同上面的翻牌</p><p>###常见问题：<br>1.设了transfrom-style:preserve-3d为什么还不好使。  </p><p>这个时候需要查看父元素是否还设了，<code>overflow，filter，clip，isolation，clip-path，mask-image，mask-box-image-source， mix-blend-mode</code>，如果不是默认值的，会将transfrom-style:preserve-3d 失效。原因是前几个属性，会创造一个flatten的box，而preserve-3d是生成stacking context  的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;css3实现3D效果&quot;&gt;&lt;a href=&quot;#css3实现3D效果&quot; class=&quot;headerlink&quot; title=&quot;css3实现3D效果&quot;&gt;&lt;/a&gt;css3实现3D效果&lt;/h2&gt;&lt;h3 id=&quot;相关属性&quot;&gt;&lt;a href=&quot;#相关属性&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="css" scheme="https://akijiangrou.github.io/tags/css/"/>
    
      <category term="perspective" scheme="https://akijiangrou.github.io/tags/perspective/"/>
    
      <category term="3D效果" scheme="https://akijiangrou.github.io/tags/3D%E6%95%88%E6%9E%9C/"/>
    
  </entry>
  
  <entry>
    <title>读书笔记-闭包</title>
    <link href="https://akijiangrou.github.io/2017/05/08/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E9%97%AD%E5%8C%85/"/>
    <id>https://akijiangrou.github.io/2017/05/08/读书笔记-闭包/</id>
    <published>2017-05-08T03:11:08.000Z</published>
    <updated>2017-05-18T07:11:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="经典闭包"><a href="#经典闭包" class="headerlink" title="经典闭包"></a>经典闭包</h2><p>闭包是一个函数（引用），即使他是在当前词法作用域之外执行，他也可以记住并访问所在的词法作用域。就是用这个引用来访问。<br><a href="https://jsbin.com/duyotivalu/1/edit?js,console,output" target="_blank" rel="noopener">参考</a></p><pre><code>function foo () {  const a = 9;  const bar = () =&gt; {return a;}  return bar;}const aa = foo();console.log(aa());</code></pre><p>返回9；  </p><p><strong>解析</strong><br>在<code>foo()</code>执行后，其返回值赋值给变量aa，并执行<code>aa()</code>，其实是通过不同的标识符引用调用了内部函数<code>bar()</code>。bar在其词法作用域外被正常执行了。而且foo函数执行后，通常整个foo内部作用域都被销毁，但是由于bar的存在，是的内部作用域依然存在，组织了垃圾回收。<br><code>bar()</code> 拥有涵盖<code>foo()</code>内部作用域的闭包，使得该作用域能一直存活。<code>bar()</code>依然持有对该作用域的饮用，这个引用就叫做<strong>闭包</strong>。  </p><p>如果将函数当作第一级的值类型进行传递，其实就会有闭包的存在。<br>一些异步或者同步操作中，使用了回调函数，也是在使用闭包。  </p><p><em>无处不在</em></p><p>本质上无论何时何地，如果将函数(访问它们各自的词法作用域)当作第一 级的值类型并到处传递，你就会看到闭包在这些函数中的应用。在<code>定时器</code>、<code>事件监听器</code>、 <code>Ajax请求</code>、<code>跨窗口通信</code>、<code>Web Workers</code>或者<code>任何其他的异步(或者同步)任务</code>中，只要使用了<code>回调函数</code>，实际上就是在使用闭包.  </p><p>最常见的考题</p><pre><code>for (var i = 1; i&lt;= 5; i++) {  setTimeout(() =&gt;console.log(i), 1000*i);}</code></pre><p>输出是：五个6</p><p>原因：i是全局变量，setTimeout是等待执行。延迟函数的回调会在循环结束时才执行,执行的时候i已经跳出循环，第一个满足的值就是6.所以输出5个6.</p><p>修改：将var 改为let。只在当时的循环中生效。可以每秒输出12345</p><p>另外一个应用：<br>模块</p><p>从方便观察的角度看，一个从函数调用 所返回的，只有数据属性而没有闭包函数的对象并不是真正的模块。</p><p>实例：</p><pre><code>function CoolModule() {  var something = &quot;cool&quot;;  var another = [1, 2, 3];   function doSomething() { console.log( something ); }  function doAnother() {    console.log( another.join( &quot; ! &quot; ) );  }           return {    doSomething: doSomething, doAnother: doAnother  };}var foo = CoolModule(); foo.doSomething(); // coolfoo.doAnother(); // 1 ! 2 ! 3</code></pre><p>上一个示例代码中有一个叫作 CoolModule() 的独立的模块创建器，可以被调用任意多次， 每次调用都会创建一个新的模块实例。<br>如果想实现单例模式：<br>就是将coolmodule 转换为iife，并赋予一个标识符：</p><pre><code>var foo = (...)();foo.doSomething();foo.doAnother(); 结果同上</code></pre><p>  模块有两个主要特征:(1)为创建内部作用域而调用了一个包装函数;(2)包装函数的返回值必须至少包括一个对内部函数的引用，这样就会创建涵盖整个包装函数内部作用域的闭包。   </p><h4 id="词法作用域"><a href="#词法作用域" class="headerlink" title="词法作用域"></a>词法作用域</h4><pre><code>function foo() {  console.log( a ); // 2}function bar() {  var a = 3;  foo();}var a = 2;bar();</code></pre><p>输出结果：2。词法作用域，运行bar，到foo的时候，这里的a是全局变量的a，所以为2.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;经典闭包&quot;&gt;&lt;a href=&quot;#经典闭包&quot; class=&quot;headerlink&quot; title=&quot;经典闭包&quot;&gt;&lt;/a&gt;经典闭包&lt;/h2&gt;&lt;p&gt;闭包是一个函数（引用），即使他是在当前词法作用域之外执行，他也可以记住并访问所在的词法作用域。就是用这个引用来访问。&lt;br&gt;
      
    
    </summary>
    
    
      <category term="js" scheme="https://akijiangrou.github.io/tags/js/"/>
    
      <category term="闭包" scheme="https://akijiangrou.github.io/tags/%E9%97%AD%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>linux 目录结构</title>
    <link href="https://akijiangrou.github.io/2017/05/08/linux%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95/"/>
    <id>https://akijiangrou.github.io/2017/05/08/linux文件目录/</id>
    <published>2017-05-08T02:46:56.000Z</published>
    <updated>2017-05-08T03:11:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>原来学linux的时候，不上心，现在后悔莫及，开始补基础。<br>首先是最基本的目录结构。<br>linux是树状结构  </p><p><strong>标橘色为重要目录</strong></p><table><thead><tr><th>目录</th><th>描述</th></tr></thead><tbody><tr><td>／</td><td>根目录，整个文件系统层次结构的根目录，一般只放目录</td></tr><tr><td>/bin/</td><td>类似 <code>/usr/bin</code> 可执行的二进制文件的目录，常用的ls，tar，mv， cat等</td></tr><tr><td>/boot/</td><td>引导程序文件，放置linux系统启动时用到的一些文件</td></tr><tr><td><font color="orange">/dev/</font></td><td>存放linux系统下的设备文件，访问该目录下某个文件，相当于访问某个设备</td></tr><tr><td><font color="orange">/etc/</font></td><td>系统配置文件存放的目录,不建议在此目录下存放可执行文件，重要的配置文件</td></tr><tr><td><font color="orange">/home/</font></td><td>系统默认的用户家目录，新增用户账号时，用户的家目录都存放在此目录下, 建议单独分区，并设置较大的磁盘空间</td></tr><tr><td>/lib/,/usr/lib/, /usr/local/lib/</td><td>系统使用的函数库的目录，程序在执行过程中，需要调用一些额外的参数时需要函数库的协助，比较重要的目录为/lib/modules</td></tr><tr><td>/lost+fount/</td><td>系统异常产生错误时，会将一些遗失的片段放置于此目录下，通常这个目录会自动出现在装置目录下。</td></tr><tr><td>/mnt/</td><td>临时挂载的文件系统。比如cdrom,u盘等，直接插入光驱无法使用，要先挂载后使用</td></tr><tr><td>/opt/</td><td>给主机额外安装软件所摆放的目录, 可选应用软件包。</td></tr><tr><td><font color="orange">/proc/</font></td><td>此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间.比较重要的目录有/proc/cpuinfo、/proc/interrupts、/proc/dma、/proc/ioports、/proc/net/*等</td></tr><tr><td>/root/</td><td>超级权限用户的家目录</td></tr><tr><td><font color="orange">/sbin:/usr/sbin:/usr/local/sbin</font></td><td>放置系统管理员使用的可执行命令，如fdisk、shutdown、mount等。sbin目录下的命令，普通用户都执行不了。</td></tr><tr><td>/tmp/</td><td>一般用户或正在执行的程序临时存放文件的目录,任何人都可以访问,重要数据不可放置在此目录下,在系统重启时目录中文件不会被保留。</td></tr><tr><td>/srv/</td><td>服务启动之后需要访问的数据目录，如www服务需要访问的网页数据存放在/srv/www内</td></tr><tr><td><font color="orange">/usr/</font></td><td>默认软件都会存于该目录下。用于存储只读用户数据的第二层次；包含绝大多数的(多)用户工具和应用程序。</td></tr><tr><td><font color="orange">/var/</font></td><td>变量文件——在正常运行的系统中其内容不断变化的文件，如随时更改的日志文件 /var/log，/var/log/message： 所有的登录文件存放目录，/var/spool/mail： 邮件存放的目录， /var/run: 程序或服务启动</td></tr></tbody></table><h3 id="etc-目录"><a href="#etc-目录" class="headerlink" title="/etc/目录"></a>/etc/目录</h3><p>未完待续。。。<br><a href="http://yangrong.blog.51cto.com/6945369/1288072" target="_blank" rel="noopener">参考</a><br><a href="http://www.iteye.com/topic/1125162" target="_blank" rel="noopener">参考二</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;原来学linux的时候，不上心，现在后悔莫及，开始补基础。&lt;br&gt;首先是最基本的目录结构。&lt;br&gt;linux是树状结构  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标橘色为重要目录&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;目录&lt;/th&gt;
&lt;th&gt;描
      
    
    </summary>
    
    
      <category term="linux" scheme="https://akijiangrou.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>export相关</title>
    <link href="https://akijiangrou.github.io/2017/04/18/exports/"/>
    <id>https://akijiangrou.github.io/2017/04/18/exports/</id>
    <published>2017-04-18T03:01:45.000Z</published>
    <updated>2017-05-18T07:11:50.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="exports-和-module-exports-的区别"><a href="#exports-和-module-exports-的区别" class="headerlink" title="exports 和 module.exports 的区别"></a>exports 和 module.exports 的区别</h3><p><code>exports</code> 是引用 <code>module.exports</code> 的值。<code>module.exports</code> 被改变的时候，<code>exports</code>不会被改变，而模块导出的时候，真正导出的执行是<code>module.exports</code>，而不是<code>exports</code>。</p><p>有以几点需要记住：</p><p>module.exports 初始值为一个空对象 {}<br>exports 是指向的 module.exports 的引用<br>require() 返回的是 module.exports 而不是 exports<br>如果module.exports 当前没有任何属性的话，exports会把属性收集起来赋给module.exports。<br>如果module.exports 有属性的话, exports中的所有内容都会被忽略。</p><pre><code>foo.jsexports.a = function(){  console.log(&apos;a&apos;)}module.exports = {a: 2}exports.a = 1 test.jsvar x = require(&apos;./foo&apos;);console.log(x.a);输出 ：2如果：foo.js 为：exports.a = function(){  console.log(&apos;a&apos;)}exports.a = 1test.js 输出：1如果：foo.js为：exports.a = function(){  console.log(&apos;a&apos;)}test.js 输出：[Function]</code></pre><p>首先，node中的require 引进的是module.exports。。。见第一个实例。如果没有显式的写module.exports，则自动连接exports与module.exports。如果显示的写了module.exports，则会断开module.exports 与 exports 的联系。</p><p>应用的话，如果只是导出某个变量或者某个功能，用exports.属性|方法。<br>如果是导出多个属性或方法或使用对象构造方法，module.module 比较好。</p><h4 id="export-default-和-export-区别"><a href="#export-default-和-export-区别" class="headerlink" title="export default 和 export 区别"></a>export default 和 export 区别</h4><p>1.export与export default均可用于导出常量、函数、文件、模块等<br>2.你可以在其它文件或模块中通过import+(常量 | 函数 | 文件 | 模块)名的方式，将其导入，以便能够对其进行使用<br>3.在一个文件或模块中，export、import可以有多个，export default仅有一个<br>4.通过export方式导出，在导入时要加{ }，export default则不需要</p><p>引入时：<br>加了default的变量，可以起任意名字，<br>非default的需要与export时的名字相同。</p><h4 id="module-exports-vs-export"><a href="#module-exports-vs-export" class="headerlink" title="module.exports vs export"></a>module.exports vs export</h4><p>commonjs：module.exports   搭配的引入： require<br>es6: export               搭配的引入：  import</p><p>普通js环境下是不支持es6的语法的，如果想这么用，需要用babel等进行转译。</p><p>es6 <code>default</code> export 其实是与exports 等价的，只不过 <code>default</code> 只是一个保留的名称，可以想象为，exports 一个属性，属性名为default。所以如果是在node.js环境下，用的export default， 引用的时候用require的话，需要这么写：  </p><p>var bar = require(‘./input’).default;</p><p><code>export</code>  vs  <code>export default</code><br>这两个在import的时候，前者需要用{} 扩起来，有种解构的感觉。后者不需要{}扩。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;exports-和-module-exports-的区别&quot;&gt;&lt;a href=&quot;#exports-和-module-exports-的区别&quot; class=&quot;headerlink&quot; title=&quot;exports 和 module.exports 的区别&quot;&gt;&lt;/a&gt;ex
      
    
    </summary>
    
    
      <category term="node.js" scheme="https://akijiangrou.github.io/tags/node-js/"/>
    
      <category term="js" scheme="https://akijiangrou.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Visual-Formatting-Model</title>
    <link href="https://akijiangrou.github.io/2017/04/17/Visual-Formatting-Model/"/>
    <id>https://akijiangrou.github.io/2017/04/17/Visual-Formatting-Model/</id>
    <published>2017-04-17T04:00:00.000Z</published>
    <updated>2017-04-26T03:58:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-视觉格式化模型-introduction"><a href="#1-视觉格式化模型-introduction" class="headerlink" title="1.视觉格式化模型 introduction"></a>1.视觉格式化模型 introduction</h2><p>视觉格式化模型：<code>User Agent</code> 如何在 <code>Visual Media</code>下处理文档树。</p><p>视觉格式化模型中，文档树中的每一个元素根据盒模型 <code>Box Model</code> 产生零个或多个盒。这些盒的布局由以下内容控制：</p><ul><li>盒的尺寸和类型</li><li>定位体系 Positioning Scheme （常规流，浮动和绝对定位）</li><li>文档树中元素之间的关系</li><li>外部信息（如：视口大小，图片的固有尺寸等）</li></ul><h3 id="1-1-视口-viewport"><a href="#1-1-视口-viewport" class="headerlink" title="1.1 视口 viewport"></a>1.1 视口 viewport</h3><p>连续媒体 <code>Continuous Media</code> 上工作的<code>user agent</code>一般会向用户提供一个<code>viewport</code>（屏幕上的一个窗口或其它可视区域）来帮助用户访问文档。<code>user agent</code>可以在调整视口大小的同时改变文档的布局</p><h3 id="1-2-包含块-containing-blocks"><a href="#1-2-包含块-containing-blocks" class="headerlink" title="1.2 包含块 containing blocks"></a>1.2 包含块 containing blocks</h3><p>CSS2.1中，许多盒的定位和大小都根据一个名为包含块 <code>Containing Block</code> 的矩形盒的边缘来计算。生成的盒会充当其后代盒的包含块；我们称盒为其后代“创建”了包含块。说“盒的包含块”即是说“盒所处的包含块”，而不是盒所产生的包含块。</p><h2 id="2-盒的生成-Controlling-Box-Generation"><a href="#2-盒的生成-Controlling-Box-Generation" class="headerlink" title="2 盒的生成 Controlling Box Generation"></a>2 盒的生成 Controlling Box Generation</h2><p>display指定盒的类型</p><p>有几个概念：  </p><ul><li><code>block-level box</code>: display：block|table|list-item</li><li><code>block box</code>: 除了table块盒和可替换元素，其他的都是块容器盒。也是块盒。</li><li><code>block container box</code>: 一个块容器盒要么只包含块级盒，要么创建一个行内格式化上下文 <code>Inline Formatting Context</code> 并只包含行内级盒 <code>Inline-level Boxes</code>。不一定是block的才是，行内也是。所以和块级盒只是一部分有交集。</li></ul><h2 id="3-定位体系-Position-schemes"><a href="#3-定位体系-Position-schemes" class="headerlink" title="3 定位体系 Position schemes"></a>3 定位体系 Position schemes</h2><p>在<code>css2.1</code>中，一个<code>box</code>有三种机制来布局  </p><ul><li>normal flow：块级formatting, 行级formatting，相对定位</li><li>float：box先按照normal flow放置，然后从流中脱离出来，可能会对后面的排序有影响</li><li>absolute position：完全脱离出文档流，对之后的元素没有影响</li></ul><p>[<code>脱离文档流</code>] float， absolutely positioned， 根元素。</p><h3 id="3-1-position-属性"><a href="#3-1-position-属性" class="headerlink" title="3.1 position 属性"></a>3.1 position 属性</h3><p>属性：  </p><ul><li>static：<br>top right等并不生效</li><li>relative：<br>盒的定位根据常规流计算（盒被成为常规流内定位）。盒相对其常规位置移动。当B盒相对定位，B盒之后的盒定位时就当B没有移动一样来计算。table相关的内盒并没有relative属性</li><li>absolute：<br>位置大小通过top，right等定义。脱离文档流了，即便绝对定位盒有外边距，也不同其他任何外边距折叠。</li><li>fixed：<br>盒的定位根据 absolute 模型来计算，但除此之外，盒相对某些参照物保持固定。<br>【用户代理不可将固定盒的内容分页显示。注意用户代理可能用其他方法打印不可见内容。参见第13章“页盒外的内容”】</li></ul><h2 id="4-常规流-Normal-Flow"><a href="#4-常规流-Normal-Flow" class="headerlink" title="4 常规流 Normal Flow"></a>4 常规流 Normal Flow</h2><p>常规流中的盒子都属于某个<code>格式化上下文</code>，要么<code>块格式化上下文BFC</code>，要么<code>行内格式化上下文LFC</code>，总之不能二者得兼。</p><p>###4.1 bfc  </p><ul><li>浮动</li><li>绝对定位元素、</li><li>非块盒的块容器（如：行内块 inline-block 、表格单元格 table-cell 以及表格标题 table-caption ）</li><li>以及 overflow 属性不为 visible 的块盒（除了该值被传播到视口的情况）</li></ul><p>将为其内容创建一个新的块级格式化上下文。</p><p>在块格式化上下文中:</p><ul><li>盒从包含块顶部一个接一个地垂直摆放。</li><li>两个同胞盒间的垂直距离取决于 margin 属性。</li><li>同一个块格式化上下文中的相邻块级盒的垂直外边距将折叠。</li><li>每个盒的左外边缘紧贴包含块的左边缘。</li></ul><p>###4.2 lfc</p><p>盒从包含块顶部一个接一个的水平摆放。盒的垂直对齐方式则不一：可能按底部或者顶部对齐，又或者按它们内容文本的基线对齐。</p><ul><li>行盒的宽度取决于包含块以及浮动。</li><li>行盒的高总是足以容纳其包含的所有盒，当一个盒（ B ）的高度小于包含它的行盒的高度时， B 的垂直对齐方式由 vertical-align 属性决定。</li><li>当一行不能包含所有时，它们会被分配到两个或者多个垂直摆放的行盒中，变成垂直堆叠。行盒的堆叠没有垂直间距（除非有特别声明）并且从不重叠。</li><li>一般行内盒超过行盒宽度是，行内盒会被分在多个行盒中。</li><li>如果一个行内盒不可切割（比如，行内盒包含的是单个字符或者语言指定的断字规则不允许断字，又或者行内盒的 white-space 属性值为 nowrap 或 pre ），那么该【行内盒将溢出行盒】。</li></ul><p>###4.3 相对定位<br>对于相对定位而言，<code>left</code> 和<code>right</code>使其发生水平位移。而且满足：left = - right。所以如果两个都定义了，则必有一个被忽略。<br>top bottom同理，top胜。</p><h2 id="5-浮动-floats"><a href="#5-浮动-floats" class="headerlink" title="5 浮动 floats"></a>5 浮动 floats</h2><p>浮动盒将被移动至左侧或右侧直至其外侧紧贴包含盒的边缘或另外一个浮动的外边缘。如果存在行盒，浮动盒的顶部外边缘将与行盒的顶部对齐。</p><p>float内元素的margin不会与包含他的发生垂直边距折叠。</p><p>clear 清除浮动</p><p><a href="https://segmentfault.com/a/1190000003096320#articleHeader5" target="_blank" rel="noopener">https://segmentfault.com/a/1190000003096320#articleHeader5</a></p><p>[link]<a href="https://www.w3.org/TR/CSS2/visuren.html#block-formatting" target="_blank" rel="noopener">https://www.w3.org/TR/CSS2/visuren.html#block-formatting</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-视觉格式化模型-introduction&quot;&gt;&lt;a href=&quot;#1-视觉格式化模型-introduction&quot; class=&quot;headerlink&quot; title=&quot;1.视觉格式化模型 introduction&quot;&gt;&lt;/a&gt;1.视觉格式化模型 introducti
      
    
    </summary>
    
    
      <category term="css" scheme="https://akijiangrou.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>thinking-with-join</title>
    <link href="https://akijiangrou.github.io/2017/03/09/thinking-with-join/"/>
    <id>https://akijiangrou.github.io/2017/03/09/thinking-with-join/</id>
    <published>2017-03-09T14:16:48.000Z</published>
    <updated>2017-04-26T04:21:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>下面这段代码是我们最常用的，为每个数据生成一个circle，调用数据里的x，y来定位。但是我们selectAll的元素，此时并不存在，那d3是如何工作的呢?</p><blockquote><p>svg.selectAll(“circle”)<br>  .data(data)<br>  .enter().append(“circle”)<br>    .attr(“cx”, function(d) { return d.x; })<br>    .attr(“cy”, function(d) { return d.y; })<br>    .attr(“r”, 2.5);</p></blockquote><p>在d3中，告诉d3你想要什么，而不是告诉d3怎样做什么。对于上面这个需求，我们要做的就是，我想要circle对应于数据，每个circle对应于一个数据，而不是告诉d3，你应该给我创造一个circle，然后告诉d3选择的circle应该和数据对应好。<br>这个原则就叫做<strong>data join</strong></p><svg width="720" height="240" version="1.1" xmlns="http://www.w3.org/2000/svg"><br/>  <g transform="translate(0,128)"><br/>    <g transform="translate(300)"><br/>      <circle r="110" style="fill: rgba(49, 130, 189,.2);" stroke="black"/><br/>      <text y="-120" dy=".35em" text-anchor="middle" style="font-weight: bold;">Data</text><br/>      <text x="-50" dy=".35em" text-anchor="middle">Enter</text><br/>    </g><br/>    <text x="360" dy=".35em" text-anchor="middle">Update</text><br/>    <g transform="translate(420)"><br/>      &lt;circle r=”110” style=”fill: rgba(230, 85, 13,.2);”stroke=”black”&gt;<br/>      <text y="-120" dy=".35em" text-anchor="middle" style="font-weight: bold;">Elements</text><br/>      <text x="50" dy=".35em" text-anchor="middle">Exit</text><br/>    </g><br/>  </g><br/></svg><p>连接到现有元素的数据点生成update（内部）选择。剩余未绑定数据生成enter选择（左），表示缺少的元素。同样，任何剩余的未绑定元素会生成exit选择（右），表示要删除的元素。</p><p>现在，我们可以通过data join 来揭开enter-append序列的谜团了</p><ol><li><code>svg.selectAll(&quot;circle&quot;)</code> 返回一个新的空<code>selection</code>，因为SVG容器是空的，所以该<code>selection</code>的父节点是SVG容器</li><li>然后此<code>selection</code>连接到数据数组，生成三个新<code>selection</code>分别表示三种可能的状态：<code>enter</code>，<code>update</code>和<code>exit</code>。由于<code>selection</code>为空，所以<code>update</code>和<code>exit</code>选择为空，而<code>enter selection</code>包含每个新数据的占位符。</li><li><code>update selection</code>通过<a href="https://github.com/d3/d3-selection/blob/master/README.md#selection_data" target="_blank" rel="noopener">selection.data</a>返回,而<code>enter</code>和<code>exit selection</code>挂起<code>update selection</code>; <a href="https://github.com/d3/d3-selection/blob/master/README.md#selection_enter" target="_blank" rel="noopener">selection.enter</a>返回<code>enter selection</code>。</li><li>通过在<code>enter selection</code>上调用<a href="https://github.com/d3/d3-selection/blob/master/README.md#selection_append" target="_blank" rel="noopener">selection.append</a>，将缺少的元素添加到SVG容器。这会为每个数据点向SVG容器添加一个新圆。</li></ol><p><em>Thinking with joins</em> 意味着在一个selection和数据集中声明一种关系，然后通过<code>enter</code>, <code>update</code>, <code>exit</code>实现这个关系.</p><p>但是为什么会这么麻烦呢？为什么不一开始就创建多个元素呢？data join的美丽在于它的泛化。虽然上述代码只处理<code>enter selection</code>,这就可以处理静态可视化了，但是你可以将其扩展为支持动态可视化，只需对<code>update</code>和<code>exit</code>进行少量修改。这意味着您可以对<a href="https://bost.ocks.org/mike/path/" target="_blank" rel="noopener">实时数据</a>进行可视化，允许<a href="http://bl.ocks.org/mbostock/4063663" target="_blank" rel="noopener">交互式探索</a>，以及在数据集之间<a href="http://bl.ocks.org/mbostock/1256572" target="_blank" rel="noopener">平滑过渡</a>！</p><p>看下包含三个状态的例子：</p><blockquote><p>var circle = svg.selectAll(“circle”)<br>  .data(data);<br>circle.exit().remove();<br>circle.enter().append(“circle”)<br>  .attr(“r”, 2.5)<br>  .merge(circle)<br>  .attr(“cx”, function(d) { return d.x; })<br>  .attr(“cy”, function(d) { return d.y; });</p></blockquote><p>无论何时运行此代码，它都会重新计算数据连接并保持元素和数据之间的所需对应关系。如果新数据集小于旧数据集，则剩余元素将在退出选择中结束并被删除。如果新数据集较大，剩余数据将在输入选择中结束，并添加新节点。如果新数据集的大小完全相同，那么所有元素都将使用新位置进行更新，并且不会添加或删除任何元素。</p><p><code>thinking with join</code>用连接来思考意味着你的代码更具声明性：你处理这三个状态没有任何分支（if）或迭代（for）。而是描述元素应如何对应数据。如果给定的<code>enter</code>，<code>update</code>或<code>exit selection</code>恰好是空的，则相应的代码是无操作</p><p>连接还允许将操作定向到特定状态（如果需要）。例如，你可以在enter而不是update上设置常量属性（例如由“r”属性定义的圆的半径）。通过重新选择元素和最小化DOM更改，您大大提高了渲染性能！同样，您可以将动画过渡指定为特定状态。例如，在entering状态，加入动画<a href="https://jsbin.com/vubibuvaqo/1/edit?html,output" target="_blank" rel="noopener">圆圈展开</a></p><p>大致翻译自：<a href="https://bost.ocks.org/mike/join/" target="_blank" rel="noopener">thinking with join</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;下面这段代码是我们最常用的，为每个数据生成一个circle，调用数据里的x，y来定位。但是我们selectAll的元素，此时并不存在，那d3是如何工作的呢?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;svg.selectAll(“circle”)&lt;br&gt;  .data(dat
      
    
    </summary>
    
    
      <category term="d3" scheme="https://akijiangrou.github.io/tags/d3/"/>
    
      <category term="translate" scheme="https://akijiangrou.github.io/tags/translate/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建</title>
    <link href="https://akijiangrou.github.io/2016/10/27/blog-publish/"/>
    <id>https://akijiangrou.github.io/2016/10/27/blog-publish/</id>
    <published>2016-10-27T04:00:00.000Z</published>
    <updated>2019-11-13T07:26:48.945Z</updated>
    
    <content type="html"><![CDATA[<p>适用于macOS</p><h3 id="1-需要安装git，npm，node"><a href="#1-需要安装git，npm，node" class="headerlink" title="1.需要安装git，npm，node"></a>1.需要安装git，npm，node</h3><p>升级本地npm</p><pre><code>npm install npm@latest -g如果有权限问题，前面加上sudo就可以了</code></pre><h3 id="2-安装hexo"><a href="#2-安装hexo" class="headerlink" title="2.安装hexo"></a>2.安装hexo</h3><pre><code>sudo npm install -g hexo全局安装了</code></pre><h3 id="3-hexo管理一个网站"><a href="#3-hexo管理一个网站" class="headerlink" title="3.hexo管理一个网站"></a>3.hexo管理一个网站</h3><pre><code>hexo init blog名字随自己喜欢，这里起的事blog</code></pre><h3 id="4-进入该文件，进行管理"><a href="#4-进入该文件，进行管理" class="headerlink" title="4.进入该文件，进行管理"></a>4.进入该文件，进行管理</h3><pre><code>cd bloghexo server //启动你的本地网站，访问localhost:4000，就可以看到雏形了hexo new &quot;hello world&quot; //生成一个hello world.md文件，新新文章，添加到网站中</code></pre><h3 id="5-部署到github上"><a href="#5-部署到github上" class="headerlink" title="5.部署到github上"></a>5.部署到github上</h3><h4 id="git上建立仓库"><a href="#git上建立仓库" class="headerlink" title="git上建立仓库"></a>git上建立仓库</h4><p>先在自己的库里创建一个新的repo,作为网站的远端库，一般命名为自己的账号名，例如：</p><p>  我的账号<font color="purple"><code>missSweety</code></font>，新建的repo为<font color="purple"><code>Akijiangrou.github.io</code></font></p><h4 id="修改hexo配置文件"><a href="#修改hexo配置文件" class="headerlink" title="修改hexo配置文件"></a>修改hexo配置文件</h4><p>回到hexo中，为了部署到github上，我们需要修改<font color="purple"><code>_config.yml</code></font>文件如下：</p><pre><code>deploy:  type: git  repository: https://github.com/MissSweety/Akijiangrou.github.io.git  branch: master</code></pre><h4 id="安装hexo-deployer-git"><a href="#安装hexo-deployer-git" class="headerlink" title="安装hexo deployer git"></a>安装hexo deployer git</h4><pre><code>npm install hexo-deployer-git --save</code></pre><p>如果不安装这个，deploy的时候会报错的</p><h4 id="hexo-deploy"><a href="#hexo-deploy" class="headerlink" title="hexo deploy"></a>hexo deploy</h4><pre><code>hexo deploy</code></pre><p>如果没配过ssh，还是会报错的<br>解决方法：</p><pre><code>ssh-keygen -t rsa -b 4096 -C ‘email’</code></pre><p>按照提示，输入账号，密码，就会生成文件了<br>回到github网站，在setting中把公钥放进去  </p><pre><code>ssh -T git@github.com</code></pre><p>用该指令可以查看是否已经鉴权了</p><font color="lightblue">如果以上都好了，这次在用hexo deploy,就会自动push代码，并发布了，可以查看你的网站了</font><h3 id="大功告成"><a href="#大功告成" class="headerlink" title="大功告成!!!"></a>大功告成!!!</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;适用于macOS&lt;/p&gt;
&lt;h3 id=&quot;1-需要安装git，npm，node&quot;&gt;&lt;a href=&quot;#1-需要安装git，npm，node&quot; class=&quot;headerlink&quot; title=&quot;1.需要安装git，npm，node&quot;&gt;&lt;/a&gt;1.需要安装git，npm，no
      
    
    </summary>
    
    
      <category term="hexo" scheme="https://akijiangrou.github.io/tags/hexo/"/>
    
  </entry>
  
</feed>
